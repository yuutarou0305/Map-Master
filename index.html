<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>СИќуЋїтю░уљєсЃъсѓ╣сѓ┐сЃ╝</title>
  <link rel="stylesheet" href="learningStyles.css">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
      background: #f5f5f5; 
      margin: 0; 
      padding: 0; 
      transition: background 0.3s, color 0.3s;
      color: #333;
    }
    .container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 16px #ccd; padding: 32px; }
    h1 { 
      text-align: center; 
      font-size: 2.2rem; 
      margin-bottom: 32px;
      color: #2c3e50;
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .score { 
      font-weight: bold; 
      margin-top: 24px; 
      text-align: center; 
      font-size: 1.5rem; 
      background: linear-gradient(135deg, #fff 0%, #f8fbff 100%); 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 2px solid rgba(100, 151, 237, 0.2);
      color: #2c3e50;
    }
    #main-area { min-height: 300px; transition: color 0.3s; }
    button, .piece { 
      padding: 12px 28px; 
      font-size: 1.1rem; 
      border-radius: 8px; 
      border: none; 
      background: #4f8ef7; 
      color: #fff; 
      cursor: pointer; 
      margin: 8px 0; 
      transition: all 0.2s;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button:hover {
      background: #357ae8;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    button:disabled { 
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
    }
    
    /* сѓбсѓцсѓ│сЃ│сЂ«УдќУфЇТђДТћ╣тќё */
    .icon-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 8px 16px;
      margin: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-size: 1.2rem;
      min-width: 60px;
      min-height: 60px;
    }
    
    .icon-badge.streak {
      background: linear-gradient(135deg, #ff6b6b, #ff8787);
      color: white;
    }
    
    .icon-badge.stats {
      background: linear-gradient(135deg, #4ecdc4, #44a3aa);
      color: white;
    }
    
    .icon-badge.check {
      background: linear-gradient(135deg, #51cf66, #37b24d);
      color: white;
    }
    
    .icon-badge.trophy {
      background: linear-gradient(135deg, #ffd43b, #fab005);
      color: #333;
    }
    
    .icon-badge.detail {
      background: linear-gradient(135deg, #364fc7, #5c7cfa);
      color: white;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: 600;
    }
    
    /* AIУДБУфгсѓбсѓисѓ╣сЃѕ */
    .ai-assist-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      max-width: 350px;
      display: none;
      z-index: 1000;
    }
    
    .ai-assist-container.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .ai-assist-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .ai-assist-title {
      font-weight: bold;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-assist-close {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 4px;
      color: #666;
    }
    
    .ai-assist-content {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #555;
    }
    
    .highlight-text {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 4px;
      cursor: help;
      position: relative;
      transition: background 0.2s;
    }
    
    .highlight-text:hover {
      background: #ffe082;
    }
    
    .ai-assist-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      z-index: 999;
    }
    
    .ai-assist-btn:hover {
      transform: scale(1.1);
    }
    
    .ai-assist-btn.active {
      background: linear-gradient(135deg, #f093fb, #f5576c);
    }
    .mode-btns { text-align: center; margin: 24px 0; display: flex; flex-direction: column; align-items: center; gap: 24px; }
    .category-btns { display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; margin: 20px 0 24px 0; }
    .category-btns button { min-width: 140px; }
    .back-btn-area { text-align: center; margin-top: 16px; }
    .puzzle-pieces { display: flex; gap: 16px; justify-content: center; margin: 24px 0; flex-wrap: wrap; }
    .piece { background: #4f8ef7; color: #fff; border-radius: 8px; cursor: pointer; font-size: 1.1rem; user-select: none; min-width: 80px; text-align: center; }
    .piece.placed { background: #4CAF50; color: #fff; cursor: default; }
    .piece.selected { background: #ff9800; transform: scale(1.1); }
    .svg-map { display: block; margin: 0 auto; background: #eaf2ff; border-radius: 8px; }
    .dropzone { stroke: #333; stroke-width: 1; fill: #f0f0f0; transition: fill 0.2s; cursor: pointer; }
    .dropzone.active { fill: #ffe082; }
    .dropzone.placed { fill: #81c784; stroke-width: 2; }
    .pref-shape { fill: #b3e5fc; stroke: #333; stroke-width: 1; cursor: pointer; }
    .pref-shape.selected { fill: #ffe082; stroke-width: 2; }
    .pref-shape.placed { fill: #81c784; stroke-width: 2; }
    .label { font-size: 14px; text-anchor: middle; pointer-events: none; }
    .clear-btn { margin: 24px auto 0 auto; display: block; }
    /* сѓФсѓ╣сѓ┐сЃъсѓцсѓ║сЃюсѓ┐сЃ│тЈ│СИІтЏ║т«џ */
    #customize-fab {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 1000;
      background: #4f8ef7;
      color: #fff;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2rem;
      box-shadow: 0 2px 8px #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      transition: background 0.2s;
    }
    #customize-fab:hover { background: #357ae8; }
    
    /* Learning Features Toggle */
    .learning-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: #4f8ef7;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="streak-display" class="streak-display" style="display: none;"></div>
    <h1>СИќуЋїтю░уљєсЃъсѓ╣сѓ┐сЃ╝</h1>
    <div id="main-area"></div>
    <div class="score" id="score-area"></div>
  </div>
  <button class="learning-toggle" onclick="toggleLearningMode()" id="learning-toggle">­ЪЊі тГду┐њсЃбсЃ╝сЃЅ</button>
  <button id="customize-fab" title="сѓФсѓ╣сѓ┐сЃъсѓцсѓ║">РџЎ№ИЈ</button>
  
  <!-- AIУДБУфгсѓбсѓисѓ╣сЃѕ -->
  <button id="ai-assist-btn" class="ai-assist-btn" title="AIУДБУфгсѓбсѓисѓ╣сЃѕ">­Ъцќ</button>
  <div id="ai-assist-container" class="ai-assist-container">
    <div class="ai-assist-header">
      <div class="ai-assist-title">
        <span>­Ъцќ</span>
        <span>AIУДБУфгсѓбсѓисѓ╣сЃѕ</span>
      </div>
      <button class="ai-assist-close" onclick="closeAIAssist()">РюЋ</button>
    </div>
    <div class="ai-assist-content" id="ai-assist-content">
      сѓ»сѓцсѓ║сѓёсЃЉсѓ║сЃФсЂДсѓЈсЂІсѓЅсЂфсЂёжЃетѕєсѓњсѓ»сЃфсЃЃсѓ»сЂЎсѓІсЂесђЂAIсЂїУЕ│сЂЌсЂЈУДБУфгсЂЌсЂЙсЂЎсђѓ
    </div>
  </div>
  
  <audio id="bgm" loop></audio>
  <audio id="se-correct" src="se-correct.mp3" preload="auto"></audio>
  <audio id="se-wrong" src="se-wrong.mp3" preload="auto"></audio>
  <audio id="se-click" src="se-click.mp3" preload="auto"></audio>
  <script src="learningData.js"></script>
  <script src="learningUI.js"></script>
  <script src="activeRecall.js"></script>
  <script>
    // тГду┐њсЃбсЃ╝сЃЅсЂ«уіХТЁІ
    let learningModeEnabled = localStorage.getItem('learningModeEnabled') === 'true';
    
    // ті╣ТъюжЪ│УеГт«џ
    let seEnabled = true;
    
    // сѓ▓сЃ╝сЃаУеГт«џ
    let gameDifficulty = 'normal'; // 'easy', 'normal', 'hard'
    let questionCount = 10; // 5, 10, 15
    
    // сѓФсѓ╣сѓ┐сЃасѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    let customQuizzes = [];
    let customQuizIndex = 0;
    let customQuizScore = 0;
    let customQuizQuestions = [];
    let currentCustomQuiz = null;
    
    // тљёсЃбсЃ╝сЃЅсЂ«ТюђжФўсѓ╣сѓ│сѓбсѓњС┐ЮтГў
    let bestScores = {
      quiz: 0,
      sort: 0,
      timeattack: 0,
      map: 0,
      mascot: 0,
      dialect: 0,
      world: 0,
      prefectures: 0,
      mountains: 0,
      rivers: 0,
      plains: 0
    };
    
    // сЃГсЃ╝сѓФсЃФсѓ╣сЃѕсЃгсЃ╝сѓИсЂІсѓЅсѓ╣сѓ│сѓбсѓњУфГсЂ┐УЙ╝сЂ┐
    function loadScores() {
      const saved = localStorage.getItem('geoQuizScores');
      if (saved) {
        const savedScores = JSON.parse(saved);
        // ТЌбтГўсЂ«сѓ╣сѓ│сѓбсЂесЃъсЃ╝сѓИсЂЌсЂдсђЂТќ░сЂЌсЂёсЃЌсЃГсЃЉсЃєсѓБсѓѓуб║т«ЪсЂФтѕЮТюЪтїќ
        bestScores = {
          quiz: savedScores.quiz || 0,
          sort: savedScores.sort || 0,
          timeattack: savedScores.timeattack || 0,
          map: savedScores.map || 0,
          mascot: savedScores.mascot || 0,
          dialect: savedScores.dialect || 0,
          world: savedScores.world || 0,
          prefectures: savedScores.prefectures || 0,
          mountains: savedScores.mountains || 0,
          rivers: savedScores.rivers || 0,
          plains: savedScores.plains || 0
        };
      }
      updateTotalScore();
    }
    
    // сѓФсѓ╣сѓ┐сЃасѓ»сѓцсѓ║сЂ«у«АуљєТЕЪУЃй
    function loadCustomQuizzes() {
      const saved = localStorage.getItem('customQuizzes');
      if (saved) {
        customQuizzes = JSON.parse(saved);
      }
    }
    
    function saveCustomQuizzes() {
      localStorage.setItem('customQuizzes', JSON.stringify(customQuizzes));
    }
    
    // сѓ╣сѓ│сѓбсѓњС┐ЮтГў
    function saveScore(mode, score) {
      if (score > bestScores[mode]) {
        bestScores[mode] = score;
        localStorage.setItem('geoQuizScores', JSON.stringify(bestScores));
        updateTotalScore();
      }
    }
    
    // тљѕУеѕсѓ╣сѓ│сѓбсѓњТЏ┤Тќ░
    function updateTotalScore() {
      const total = Object.values(bestScores).reduce((sum, score) => sum + score, 0);
      
      let scoreHTML;
      if (learningModeEnabled) {
        const weekStats = learningData.getWeeklyStats();
        scoreHTML = `
          <div style="display:flex;justify-content:space-around;flex-wrap:wrap;gap:8px;">
            <div class="icon-badge streak">
              <div>
                <div style="font-size: 1.8rem;">­ЪћЦ</div>
                <div style="font-size: 0.9rem;">жђБуХџ</div>
                <div style="font-weight: bold;">${learningData.data.streak.current}ТЌЦ</div>
              </div>
            </div>
            <div class="icon-badge stats">
              <div>
                <div style="font-size: 1.8rem;">­ЪЊі</div>
                <div style="font-size: 0.9rem;">С╗іжђ▒</div>
                <div style="font-weight: bold;">${weekStats.totalMinutes}тѕє</div>
              </div>
            </div>
            <div class="icon-badge check">
              <div>
                <div style="font-size: 1.8rem;">РюЁ</div>
                <div style="font-size: 0.9rem;">ТГБуГћујЄ</div>
                <div style="font-weight: bold;">${weekStats.accuracy.toFixed(1)}%</div>
              </div>
            </div>
            <div class="icon-badge trophy">
              <div>
                <div style="font-size: 1.8rem;">­ЪЈє</div>
                <div style="font-size: 0.9rem;">сѓ╣сѓ│сѓб</div>
                <div style="font-weight: bold;">${total}уѓ╣</div>
              </div>
            </div>
            <button onclick="learningUI.showDashboard()" class="icon-badge detail">
              ­ЪЊѕ УЕ│у┤░
            </button>
          </div>
        `;
      } else {
        scoreHTML = `
          <div style="display:flex;justify-content:space-around;flex-wrap:wrap;gap:16px;">
            <div>­ЪЈє тљѕУеѕсѓ╣сѓ│сѓб: <b>${total}</b></div>
            <div>сѓ»сѓцсѓ║: ${bestScores.quiz}</div>
            <div>СИдсЂ╣ТЏ┐сЂѕ: ${bestScores.sort}</div>
            <div>сѓ┐сѓцсЃа: ${bestScores.timeattack}</div>
            <div>тю░тЏ│: ${bestScores.map}</div>
            <div>сЃъсѓ╣сѓ│сЃЃсЃѕ: ${bestScores.mascot}</div>
            <div>Тќ╣Уеђ: ${bestScores.dialect}</div>
            <div>уюїт║Ђ: ${bestScores.prefectures}</div>
            <div>т▒▒тю░: ${bestScores.mountains}</div>
            <div>тиЮ: ${bestScores.rivers}</div>
            <div>т╣│тю░: ${bestScores.plains}</div>
            ${total >= 100 ? '<div>СИќуЋї: ' + bestScores.world + '</div>' : ''}
          </div>
        `;
      }
      
      document.getElementById('score-area').innerHTML = scoreHTML;
      
      // 100уѓ╣С╗ЦСИісЂДСИќуЋїтю░уљєсѓ»сѓцсѓ║сѓњУДБТћЙ
      if (total >= 100) {
        const worldBtn = document.getElementById('btn-world');
        if (worldBtn) {
          worldBtn.style.display = 'block';
        }
      }
    }
    
    // ті╣ТъюжЪ│тєЇућЪ№╝ѕжЪ│тБ░сЃЋсѓАсѓцсЃФсЂїтГўтюесЂЌсЂфсЂёта┤тљѕсЂ»СйЋсѓѓсЂЌсЂфсЂё№╝Ѕ
    function playSE(id) {
      if (!seEnabled) return;
      const se = document.getElementById(id);
      if (se) { 
        se.currentTime = 0; 
        se.volume = 0.7; // жЪ│жЄЈсѓњУеГт«џ
        se.play().catch(e => {
          console.log(`ті╣ТъюжЪ│тєЇућЪсѓесЃЕсЃ╝ (${id}):`, e);
          // т░ЉсЂЌтЙЁсЂБсЂдсЂІсѓЅтєЇУЕдУАї
          setTimeout(() => {
            try {
              se.currentTime = 0;
              se.play().catch(err => console.log(`ті╣ТъюжЪ│тєЇУЕдУАїтц▒ТЋЌ (${id}):`, err));
            } catch (retryError) {
              console.log(`ті╣ТъюжЪ│тєЇУЕдУАїСИГсЂФсѓесЃЕсЃ╝ (${id}):`, retryError);
            }
          }, 100);
        });
      } else {
        console.log(`ті╣ТъюжЪ│УдЂу┤асЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊ: ${id}`);
      }
    }
    
    function toggleSE() {
      seEnabled = !seEnabled;
      alert(seEnabled ? 'ті╣ТъюжЪ│сѓњONсЂФсЂЌсЂЙсЂЌсЂЪ' : 'ті╣ТъюжЪ│сѓњOFFсЂФсЂЌсЂЙсЂЌсЂЪ');
    }

    // сЃЕсЃ│сЃђсЃасѓисЃБсЃЃсЃЋсЃФжќбТЋ░
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // сѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const quizData = [
      { question: 'ТЌЦТюгсЂДСИђуЋфжЮбуЕЇсЂїт║ЃсЂёжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'т▓ЕТЅІуюї', 'удЈт│Хуюї', 'жЋижЄјуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфС║║тЈБсЂїтцџсЂёжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['тцДжўфт║ю', 'ТёЏуЪЦуюї', 'ТЮ▒С║гжЃй', 'уЦътЦѕтиЮуюї'], answer: 2 },
      { question: 'ТЌЦТюгсЂ«ждќжЃйсЂ»№╝Ъ', choices: ['тцДжўфтИѓ', 'тљЇтЈцт▒ІтИѓ', 'ТЮ▒С║гжЃй', 'ТюГт╣їтИѓ'], answer: 2 },
      { question: 'ТЌЦТюгсЂДСИђуЋфтЇЌсЂФсЂѓсѓІжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['Т▓ќуИёуюї', 'ж╣┐тЁљт│Хуюї', 'жФўуЪЦуюї', 'т««т┤јуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфтїЌсЂФсЂѓсѓІжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'жЮњТБ«уюї', 'уДІућ░уюї', 'т▓ЕТЅІуюї'], answer: 0 },
      { question: 'ТЌЦТюгСИЅТЎ»сЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['ТЮЙт│Х', 'тцЕТЕІуФІ', 'т««т│Х', 'т»їтБФт▒▒'], answer: 3 },
      { question: 'ТЌЦТюгсЂДСИђуЋфжЮбуЕЇсЂїт░ЈсЂЋсЂёжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['ждЎтиЮуюї', 'тцДжўфт║ю', 'СйљУ│ђуюї', 'Т▓ќуИёуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфжФўсЂёт▒▒сЂ»№╝Ъ', choices: ['т»їтБФт▒▒', 'тїЌт▓│', 'ТДЇсЃХт▓│', 'уЕѓжФўт▓│'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфжЋисЂётиЮсЂ»№╝Ъ', choices: ['С┐АТ┐ЃтиЮ', 'тѕЕТа╣тиЮ', 'уЪ│уІЕтиЮ', 'тцЕуФютиЮ'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфтцДсЂЇсЂёТ╣ќсЂ»№╝Ъ', choices: ['уљхуљХТ╣ќ', 'жюъсЃХТхд', 'сѓхсЃГсЃъТ╣ќ', 'уїфУІЌС╗БТ╣ќ'], answer: 0 },
      { question: 'сЂ┐сЂІсѓЊсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['ТёЏтфЏуюї', 'тњїТГїт▒▒уюї', 'жЮЎт▓Ауюї', 'уєіТюгуюї'], answer: 1 },
      { question: 'сѓісѓЊсЂћсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['жЮњТБ«уюї', 'жЋижЄјуюї', 'т▒▒тйбуюї', 'удЈт│Хуюї'], answer: 0 },
      { question: 'у▒│сЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['Тќ░ТйЪуюї', 'тїЌТхижЂЊ', 'уДІућ░уюї', 'т▒▒тйбуюї'], answer: 0 },
      { question: 'СИќуЋїжЂ║ућБсђїуЎйуЦът▒▒тю░сђЇсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮњТБ«уюїсЃ╗уДІућ░уюї', 'т▓ЕТЅІуюїсЃ╗т««тЪјуюї', 'т▒▒тйбуюїсЃ╗удЈт│Хуюї', 'Тќ░ТйЪуюїсЃ╗т»їт▒▒уюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфТи▒сЂёТ╣ќсЂ»№╝Ъ', choices: ['ућ░Т▓бТ╣ќ', 'Тћ»угЈТ╣ќ', 'тЇЂтњїућ░Т╣ќ', 'ТЉЕтЉеТ╣ќ'], answer: 0 },
      { question: 'сЂЋсЂЈсѓЅсѓЊсЂ╝сЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['т▒▒Тбеуюї', 'т▒▒тйбуюї', 'удЈт│Хуюї', 'жЮњТБ«уюї'], answer: 1 },
      { question: 'сЂіУїХсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['жЮЎт▓Ауюї', 'С║гжЃйт║ю', 'ж╣┐тЁљт│Хуюї', 'СИЅжЄЇуюї'], answer: 0 },
      { question: 'сЂўсѓЃсЂїсЂёсѓѓсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'жЋит┤јуюї', 'ж╣┐тЁљт│Хуюї', 'УїетЪјуюї'], answer: 0 },
      { question: 'сЂфсЂЌсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['ж│ЦтЈќуюї', 'тЇЃУЉЅуюї', 'УїетЪјуюї', 'удЈт│Хуюї'], answer: 1 },
      { question: 'сЂХсЂЕсЂєсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['т▒▒Тбеуюї', 'жЋижЄјуюї', 'т▒▒тйбуюї', 'т▓Ат▒▒уюї'], answer: 0 },
      { question: 'сЂёсЂАсЂћсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['удЈт▓Ауюї', 'ТаЃТюеуюї', 'уєіТюгуюї', 'жЮЎт▓Ауюї'], answer: 1 },
      { question: 'уЅЏУѓЅсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'уєіТюгуюї'], answer: 0 },
      { question: 'У▒џУѓЅсЂ«ућЪућБжЄЈТЌЦТюгСИђсЂ»№╝Ъ', choices: ['ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'УїетЪјуюї', 'тЇЃУЉЅуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДтћ»СИђсђЂуюїтљЇсЂеуюїт║ЂТЅђтюетю░тљЇсЂїуЋ░сЂфсѓІуюїсЂ»№╝Ъ', choices: ['т│ХТа╣уюї', 'ТёЏтфЏуюї', 'ждЎтиЮуюї', 'жФўуЪЦуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂ«ТюђТЮ▒уФ»сЂ»№╝Ъ', choices: ['ТіъТЇЅт│Х', 'тЇЌж│Цт│Х', 'СИјжѓБтЏйт│Х', 'Т▓ќсЃјж│Цт│Х'], answer: 1 },
      { question: 'ТЌЦТюгсЂ«ТюђУЦ┐уФ»сЂ»№╝Ъ', choices: ['СИјжѓБтЏйт│Х', 'Т│буЁДжќЊт│Х', 'УЦ┐УАет│Х', 'уЪ│тъБт│Х'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфС║║тЈБт»єт║дсЂїжФўсЂёжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['ТЮ▒С║гжЃй', 'тцДжўфт║ю', 'уЦътЦѕтиЮуюї', 'тЪ╝ујЅуюї'], answer: 0 },
      { question: 'ТЌЦТюгсЂДСИђуЋфС║║тЈБт»єт║дсЂїСйјсЂёжЃйжЂЊт║юуюїсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'т▓ЕТЅІуюї', 'уДІућ░уюї', 'жФўуЪЦуюї'], answer: 0 },
      { question: 'Тќ░т╣╣уиџсЂїжђџсЂБсЂдсЂёсЂфсЂёуюїсЂ»№╝Ъ', choices: ['т│ХТа╣уюї', 'ТёЏтфЏуюї', 'жФўуЪЦуюї', 'тЁесЂджђџсЂБсЂдсЂёсѓІ'], answer: 2 },
      { question: 'уЕ║ТИ»сЂїсЂфсЂёуюїсЂ»№╝Ъ', choices: ['тЦѕУЅ»уюї', 'Т╗ІУ│ђуюї', 'С║гжЃйт║ю', 'тЁесЂдсЂФсЂѓсѓІ'], answer: 0 },
      { question: 'ТЌЦТюгСИЅтцДуЦГсѓісЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['уЦЄтюњуЦГ', 'тцЕуЦъуЦГ', 'уЦъућ░уЦГ', 'сЂГсЂХсЂЪуЦГ'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДУі▒уЂФтцДС╝џсЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['тцДТЏ▓Уі▒уЂФ', 'тюЪТхдУі▒уЂФ', 'жЋит▓АУі▒уЂФ', 'жџЁућ░тиЮУі▒уЂФ'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДсЂєсЂЕсѓЊсЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['У«Ѓт▓љсЂєсЂЕсѓЊ', 'уе▓т║ГсЂєсЂЕсѓЊ', 'Т░┤Т▓бсЂєсЂЕсѓЊ', 'сЂЇсЂЌсѓЂсѓЊ'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДсЂЮсЂ░сЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['сѓЈсѓЊсЂЊсЂЮсЂ░', 'ТѕИжџасЂЮсЂ░', 'тЄ║жЏ▓сЂЮсЂ░', 'С┐АтиъсЂЮсЂ░'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДсЃЕсЃ╝сЃАсЃ│сЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['ТюГт╣їсЃЕсЃ╝сЃАсЃ│', 'тЇџтцџсЃЕсЃ╝сЃАсЃ│', 'тќютцџТќ╣сЃЕсЃ╝сЃАсЃ│', 'ТефТхюсЃЕсЃ╝сЃАсЃ│'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДТИЕТ│ЅсЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['тѕЦт║юТИЕТ│Ѕ', 'уЎйТхюТИЕТ│Ѕ', 'ує▒ТхиТИЕТ│Ѕ', 'у«▒Та╣ТИЕТ│Ѕ'], answer: 3 },
      { question: 'ТЌЦТюгСИЅтцДтцюТЎ»сЂФтљФсЂЙсѓїсЂфсЂёсЂ«сЂ»№╝Ъ', choices: ['тЄйжце', 'уЦъТѕИ', 'жЋит┤ј', 'ТефТхю'], answer: 3 },
      { question: 'СИќуЋїжЂ║ућБсђїт▒ІС╣Ёт│ХсђЇсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'Т▓ќуИёуюї', 'жЋит┤јуюї'], answer: 0 },
      { question: 'СИќуЋїжЂ║ућБсђїт╣│Т│ЅсђЇсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▓ЕТЅІуюї', 'т««тЪјуюї', 'удЈт│Хуюї', 'т▒▒тйбуюї'], answer: 0 },
      { question: 'СИќуЋїжЂ║ућБсђїт»їтБФт▒▒сђЇсЂФжќбС┐ѓсЂфсЂёуюїсЂ»№╝Ъ', choices: ['т▒▒Тбеуюї', 'жЮЎт▓Ауюї', 'уЦътЦѕтиЮуюї', 'тЁесЂджќбС┐ѓсЂЎсѓІ'], answer: 2 },
      { question: 'СИќуЋїжЂ║ућБсђїуЎйтиЮжЃисђЇсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▓љжўюуюї', 'т»їт▒▒уюї', 'уЪ│тиЮуюї', 'удЈС║Ћуюї'], answer: 0 },
      { question: 'СИќуЋїжЂ║ућБсђїтј│т│ХуЦъуцЙсђЇсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т║Ѓт│Хуюї', 'т▓Ат▒▒уюї', 'т│ХТа╣уюї', 'т▒▒тЈБуюї'], answer: 0 },
      { question: 'ућ▓тГљтюњуљЃта┤сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тцДжўфт║ю', 'тЁхт║Фуюї', 'С║гжЃйт║ю', 'тЦѕУЅ»уюї'], answer: 1 },
      { question: 'ТЮ▒С║гсѓ╣сѓФсѓцсЃёсЃфсЃ╝сЂ«жФўсЂЋсЂ»№╝Ъ', choices: ['333m', '634m', '828m', '1000m'], answer: 1 },
      { question: 'USJсЂїсЂѓсѓІт║юуюїсЂ»№╝Ъ', choices: ['ТЮ▒С║гжЃй', 'тЇЃУЉЅуюї', 'тцДжўфт║ю', 'тЁхт║Фуюї'], answer: 2 },
      { question: 'ТЌЦТюгСИђжЋисЂёсЃѕсЃ│сЃЇсЃФсЂ»№╝Ъ', choices: ['жЮњтЄйсЃѕсЃ│сЃЇсЃФ', 'жќбУХісЃѕсЃ│сЃЇсЃФ', 'т▒▒ТЅІсЃѕсЃ│сЃЇсЃФ', 'Тќ░уЦъТѕИсЃѕсЃ│сЃЇсЃФ'], answer: 0 },
      { question: 'ТЌЦТюгСИђжЋисЂёТЕІсЂ»№╝Ъ', choices: ['ТўјуЪ│Тхит│АтцДТЕІ', 'уђгТѕИтцДТЕІ', 'сЃгсѓцсЃ│сЃюсЃ╝сЃќсЃфсЃЃсѓИ', 'жќбжќђТЕІ'], answer: 0 },
      { question: 'ТЌЦТюгсЂ«тЏйж│ЦсЂ»№╝Ъ', choices: ['сЃѕсѓГ', 'сЃёсЃФ', 'сѓГсѓИ', 'сЃ»сѓи'], answer: 2 },
      { question: 'ТЌЦТюгсЂ«тЏйУі▒сЂ»№╝Ъ', choices: ['ТАю', 'ТбЁ', 'УЈі', 'ТАюсЂеУЈі'], answer: 3 },
      { question: 'ТЌЦТюгсЂ«жђџУ▓етЇўСйЇсЂ»№╝Ъ', choices: ['тєє', 'сЃЅсЃФ', 'сЃдсЃ╝сЃГ', 'сѓдсѓЕсЃ│'], answer: 0 },
      { question: 'ТЌЦТюгсЂ«С║║тЈБсЂ»у┤ёСйЋС║║№╝Ъ', choices: ['1тёёС║║', '1тёё2тЇЃСИЄС║║', '1тёё5тЇЃСИЄС║║', '2тёёС║║'], answer: 1 },
      { question: 'ТЌЦТюгсЂ«т│ХсЂ«ТЋ░сЂ»у┤ёсЂёсЂЈсЂц№╝Ъ', choices: ['1000', '3000', '7000', '14000'], answer: 3 }
    ];

    // СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФсЃЄсЃ╝сѓ┐
    const sortData = [
      ['тїЌТхижЂЊ', 'жЮњТБ«уюї', 'т▓ЕТЅІуюї', 'т««тЪјуюї', 'уДІућ░уюї'],
      ['ТЮ▒С║гжЃй', 'уЦътЦѕтиЮуюї', 'тЇЃУЉЅуюї', 'тЪ╝ујЅуюї', 'УїетЪјуюї'],
      ['тцДжўфт║ю', 'тЁхт║Фуюї', 'С║гжЃйт║ю', 'Т╗ІУ│ђуюї', 'тЦѕУЅ»уюї'],
      ['ТёЏуЪЦуюї', 'т▓љжўюуюї', 'СИЅжЄЇуюї', 'жЮЎт▓Ауюї', 'жЋижЄјуюї'],
      ['удЈт▓Ауюї', 'СйљУ│ђуюї', 'жЋит┤јуюї', 'уєіТюгуюї', 'тцДтѕєуюї'],
      ['т║Ѓт│Хуюї', 'т▓Ат▒▒уюї', 'т▒▒тЈБуюї', 'т│ХТа╣уюї', 'ж│ЦтЈќуюї'],
      ['ждЎтиЮуюї', 'тЙ│т│Хуюї', 'ТёЏтфЏуюї', 'жФўуЪЦуюї', 'тњїТГїт▒▒уюї'],
      ['т»їт▒▒уюї', 'уЪ│тиЮуюї', 'удЈС║Ћуюї', 'Тќ░ТйЪуюї', 'т▒▒тйбуюї'],
      ['уЙцждгуюї', 'ТаЃТюеуюї', 'УїетЪјуюї', 'тЪ╝ујЅуюї', 'тЇЃУЉЅуюї'],
      ['т««т┤јуюї', 'ж╣┐тЁљт│Хуюї', 'Т▓ќуИёуюї', 'уєіТюгуюї', 'жЋит┤јуюї'],
      ['уДІућ░уюї', 'т▒▒тйбуюї', 'удЈт│Хуюї', 'т««тЪјуюї', 'т▓ЕТЅІуюї'],
      ['жЮЎт▓Ауюї', 'т▒▒Тбеуюї', 'жЋижЄјуюї', 'Тќ░ТйЪуюї', 'т»їт▒▒уюї'],
      ['т▓Ат▒▒уюї', 'т║Ѓт│Хуюї', 'т▒▒тЈБуюї', 'ТёЏтфЏуюї', 'ждЎтиЮуюї'],
      ['СИЅжЄЇуюї', 'Т╗ІУ│ђуюї', 'С║гжЃйт║ю', 'тцДжўфт║ю', 'тЦѕУЅ»уюї'],
      ['удЈС║Ћуюї', 'уЪ│тиЮуюї', 'т»їт▒▒уюї', 'Тќ░ТйЪуюї', 'жЋижЄјуюї']
    ];

    // тЁежЃйжЂЊт║юуюїСИдсЂ╣ТЏ┐сЂѕ№╝ѕС║ћтЇЂжЪ│жає№╝Ѕ
    const allPrefs = [
      'ТёЏуЪЦуюї','уДІућ░уюї','жЮњТБ«уюї','ТёЏтфЏуюї','уЪ│тиЮуюї','УїетЪјуюї','т▓ЕТЅІуюї','тцДтѕєуюї','тцДжўфт║ю','т▓Ат▒▒уюї','Т▓ќуИёуюї','ждЎтиЮуюї','ж╣┐тЁљт│Хуюї','уЦътЦѕтиЮуюї','т▓љжўюуюї','С║гжЃйт║ю','уєіТюгуюї','уЙцждгуюї','жФўуЪЦуюї','тЪ╝ујЅуюї','СйљУ│ђуюї','Т╗ІУ│ђуюї','жЮЎт▓Ауюї','т│ХТа╣уюї','тЇЃУЉЅуюї','ТЮ▒С║гжЃй','тЙ│т│Хуюї','ТаЃТюеуюї','ж│ЦтЈќуюї','т»їт▒▒уюї','жЋит┤јуюї','жЋижЄјуюї','тЦѕУЅ»уюї','Тќ░ТйЪуюї','тЁхт║Фуюї','т║Ѓт│Хуюї','удЈС║Ћуюї','удЈт▓Ауюї','удЈт│Хуюї','тїЌТхижЂЊ','СИЅжЄЇуюї','т««тЪјуюї','т««т┤јуюї','т▒▒тйбуюї','т▒▒тЈБуюї','т▒▒Тбеуюї','тњїТГїт▒▒уюї'
    ];
    let allSortCurrent = [];
    let allSortScore = 0;
    function showAllPrefSort() {
      allSortCurrent = shuffle([...allPrefs]);
      let html = `<h2>тЁежЃйжЂЊт║юуюїсѓњС║ћтЇЂжЪ│жаєсЂФСИдсЂ╣ТЏ┐сЂѕсѓѕ</h2><ul id="allsort-list" style="list-style:none;padding:0;max-height:400px;overflow:auto;">`;
      allSortCurrent.forEach((item, idx) => {
        html += `<li data-idx="${idx}" style="margin:4px 0;">
          <span>${item}</span>
          <button onclick="moveAllUp(${idx})">РєЉ</button>
          <button onclick="moveAllDown(${idx})">РєЊ</button>
        </li>`;
      });
      html += '</ul>';
      html += '<button onclick="checkAllSortAnswer()">уГћсЂѕтљѕсѓЈсЂЏ</button>';
      html += '<button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>';
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
    }
    window.moveAllUp = function(idx) {
      if (idx === 0) return;
      [allSortCurrent[idx - 1], allSortCurrent[idx]] = [allSortCurrent[idx], allSortCurrent[idx - 1]];
      showAllPrefSort();
    };
    window.moveAllDown = function(idx) {
      if (idx === allSortCurrent.length - 1) return;
      [allSortCurrent[idx + 1], allSortCurrent[idx]] = [allSortCurrent[idx], allSortCurrent[idx + 1]];
      showAllPrefSort();
    };
    window.checkAllSortAnswer = function() {
      const correct = allSortCurrent.join() === [...allPrefs].sort().join();
      let msg = correct ? 'ТГБУДБ№╝Ђ' : 'СИЇТГБУДБсђѓ';
      
      if (correct) {
        playSE('se-correct');
      } else {
        playSE('se-wrong');
      }
      
      // уЈЙтюесЂ«СИдсЂ│сЂеТГБУДБсѓњУАеуц║
      // уГћсЂѕсѓњСИГтц«сЂФтцДсЂЇсЂЈУАеуц║
      const resultDiv = document.createElement('div');
      resultDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:32px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.3);max-width:80%;max-height:80%;overflow:auto;z-index:1000;';
      resultDiv.innerHTML = `
        <h2 style="color:${correct ? 'green' : 'red'};text-align:center;">${msg}</h2>
        ${!correct ? `<div style="margin-top:16px;"><b>ТГБУДБ№╝џ</b><br>${[...allPrefs].sort().join(' Рєњ ')}</div>` : ''}
        <button onclick="this.parentElement.remove()" style="margin-top:16px;display:block;margin-left:auto;margin-right:auto;">жќЅсЂўсѓІ</button>
      `;
      document.body.appendChild(resultDiv);
      
      // сЃюсѓ┐сЃ│сѓњуёАті╣тїќ
      document.querySelector('button[onclick="checkAllSortAnswer()"]').disabled = true;
    };

    // уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const prefecturesQuizData = [
      { question: 'тїЌТхижЂЊсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ТюГт╣їтИѓ', 'тЄйжцетИѓ', 'ТЌГтиЮтИѓ', 'жЄДУи»тИѓ'], answer: 0 },
      { question: 'жЮњТБ«уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['т╝ўтЅЇтИѓ', 'тЁФТѕИтИѓ', 'жЮњТБ«тИѓ', 'СИЅТ▓бтИѓ'], answer: 2 },
      { question: 'т▓ЕТЅІуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['С╗ЎтЈ░тИѓ', 'уЏЏт▓АтИѓ', 'СИђжќбтИѓ', 'Уі▒ти╗тИѓ'], answer: 1 },
      { question: 'т««тЪјуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['С╗ЎтЈ░тИѓ', 'уЪ│ти╗тИѓ', 'тцДт┤јтИѓ', 'уЎ╗у▒│тИѓ'], answer: 0 },
      { question: 'уДІућ░уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['уДІућ░тИѓ', 'тцДжцетИѓ', 'ТефТЅІтИѓ', 'УЃйС╗БтИѓ'], answer: 0 },
      { question: 'т▒▒тйбуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['у▒│Т▓бтИѓ', 'жЁњућ░тИѓ', 'т▒▒тйбтИѓ', 'жХ┤т▓АтИѓ'], answer: 2 },
      { question: 'удЈт│ХуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жЃАт▒▒тИѓ', 'сЂёсѓЈсЂЇтИѓ', 'С╝џТ┤ЦУІЦТЮЙтИѓ', 'удЈт│ХтИѓ'], answer: 3 },
      { question: 'УїетЪјуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['сЂцсЂЈсЂ░тИѓ', 'сЂ▓сЂЪсЂАсЂфсЂІтИѓ', 'Т░┤ТѕИтИѓ', 'тюЪТхдтИѓ'], answer: 2 },
      { question: 'ТаЃТюеуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['т«ЄжЃйт««тИѓ', 'т░Јт▒▒тИѓ', 'УХ│тѕЕтИѓ', 'СйљжЄјтИѓ'], answer: 0 },
      { question: 'уЙцждгуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жФўт┤јтИѓ', 'С╝ітІбт┤јтИѓ', 'тцфућ░тИѓ', 'тЅЇТЕІтИѓ'], answer: 3 },
      { question: 'тЪ╝ујЅуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тиЮУХітИѓ', 'сЂЋсЂёсЂЪсЂЙтИѓ', 'тиЮтЈБтИѓ', 'ТЅђТ▓бтИѓ'], answer: 1 },
      { question: 'тЇЃУЉЅуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['Уѕ╣ТЕІтИѓ', 'ТЪЈтИѓ', 'тЇЃУЉЅтИѓ', 'тИѓтиЮтИѓ'], answer: 2 },
      { question: 'ТЮ▒С║гжЃйсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ТЮ▒С║гжЃй', 'Тќ░т«┐тї║', 'тЇЃС╗Бућ░тї║', 'ТИІУ░итї║'], answer: 0 },
      { question: 'уЦътЦѕтиЮуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тиЮт┤јтИѓ', 'уЏИТеАтјЪтИѓ', 'УЌцТ▓бтИѓ', 'ТефТхютИѓ'], answer: 3 },
      { question: 'Тќ░ТйЪуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жЋит▓АтИѓ', 'СИіУХітИѓ', 'Тќ░ТйЪтИѓ', 'СИЅТЮАтИѓ'], answer: 2 },
      { question: 'т»їт▒▒уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жФўт▓АтИѓ', 'т»їт▒▒тИѓ', 'т░ёТ░┤тИѓ', 'тЇЌуа║тИѓ'], answer: 1 },
      { question: 'уЪ│тиЮуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жЄЉТ▓бтИѓ', 'т░ЈТЮЙтИѓ', 'уЎйт▒▒тИѓ', 'СИЃт░ЙтИѓ'], answer: 0 },
      { question: 'удЈС║ЋуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тЮѓС║ЋтИѓ', 'УХітЅЇтИѓ', 'ТЋдУ│ђтИѓ', 'удЈС║ЋтИѓ'], answer: 3 },
      { question: 'т▒▒ТбеуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['т»їтБФтљЅућ░тИѓ', 'ућ▓т║ютИѓ', 'ућ▓ТќљтИѓ', 'тЇЌсѓбсЃФсЃЌсѓ╣тИѓ'], answer: 1 },
      { question: 'жЋижЄјуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ТЮЙТюгтИѓ', 'СИіућ░тИѓ', 'жЋижЄјтИѓ', 'жБ»ућ░тИѓ'], answer: 2 },
      { question: 'т▓љжўюуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тцДтъБтИѓ', 'т▓љжўютИѓ', 'жФўт▒▒тИѓ', 'тцџТ▓╗УдІтИѓ'], answer: 1 },
      { question: 'жЮЎт▓АуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ТхюТЮЙтИѓ', 'жЮЎт▓АтИѓ', 'Т▓╝Т┤ЦтИѓ', 'т»їтБФтИѓ'], answer: 1 },
      { question: 'ТёЏуЪЦуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тљЇтЈцт▒ІтИѓ', 'У▒іућ░тИѓ', 'т▓Ат┤јтИѓ', 'У▒іТЕІтИѓ'], answer: 0 },
      { question: 'СИЅжЄЇуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тЏЏТЌЦтИѓтИѓ', 'жѕ┤ж╣┐тИѓ', 'Т┤ЦтИѓ', 'ТЮЙжўфтИѓ'], answer: 2 },
      { question: 'Т╗ІУ│ђуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тйдТа╣тИѓ', 'УЇЅТ┤ЦтИѓ', 'тцДТ┤ЦтИѓ', 'жЋиТхютИѓ'], answer: 2 },
      { question: 'С║гжЃйт║юсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['т«ЄТ▓╗тИѓ', 'С║гжЃйтИѓ', 'УѕъжХ┤тИѓ', 'удЈуЪЦт▒▒тИѓ'], answer: 1 },
      { question: 'тцДжўфт║юсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['та║тИѓ', 'ТЮ▒тцДжўфтИѓ', 'тцДжўфтИѓ', 'У▒іСИГтИѓ'], answer: 2 },
      { question: 'тЁхт║ФуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тДФУи»тИѓ', 'уЦъТѕИтИѓ', 'УЦ┐т««тИѓ', 'т░╝т┤јтИѓ'], answer: 1 },
      { question: 'тЦѕУЅ»уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ТЕ┐тјЪтИѓ', 'ућЪжДњтИѓ', 'тЦѕУЅ»тИѓ', 'тцДтњїжЃАт▒▒тИѓ'], answer: 2 },
      { question: 'тњїТГїт▒▒уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ућ░УЙ║тИѓ', 'тњїТГїт▒▒тИѓ', 'ТхитЇЌтИѓ', 'Тќ░т««тИѓ'], answer: 1 },
      { question: 'ж│ЦтЈќуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['у▒│тГљтИѓ', 'тђЅтљЅтИѓ', 'ж│ЦтЈќтИѓ', 'тбЃТИ»тИѓ'], answer: 2 },
      { question: 'т│ХТа╣уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тЄ║жЏ▓тИѓ', 'Тхюућ░тИѓ', 'уЏіућ░тИѓ', 'ТЮЙТ▒ЪтИѓ'], answer: 3 },
      { question: 'т▓Ат▒▒уюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тђЅТЋитИѓ', 'Т┤Цт▒▒тИѓ', 'т▓Ат▒▒тИѓ', 'ујЅжЄјтИѓ'], answer: 2 },
      { question: 'т║Ѓт│ХуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['удЈт▒▒тИѓ', 'тЉЅтИѓ', 'т░ЙжЂЊтИѓ', 'т║Ѓт│ХтИѓ'], answer: 3 },
      { question: 'т▒▒тЈБуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['СИІжќбтИѓ', 'т«ЄжЃетИѓ', 'т▒▒тЈБтИѓ', 'жў▓т║ютИѓ'], answer: 2 },
      { question: 'тЙ│т│ХуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ж│┤жќђтИѓ', 'жў┐тЇЌтИѓ', 'тЙ│т│ХтИѓ', 'тљЅжЄјтиЮтИѓ'], answer: 2 },
      { question: 'ждЎтиЮуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['СИИС║ђтИѓ', 'жФўТЮЙтИѓ', 'тЮѓтЄ║тИѓ', 'Уд│жЪ│т»║тИѓ'], answer: 1 },
      { question: 'ТёЏтфЏуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['С╗іТ▓╗тИѓ', 'Тќ░т▒ЁТхютИѓ', 'ТЮЙт▒▒тИѓ', 'УЦ┐ТЮАтИѓ'], answer: 2 },
      { question: 'жФўуЪЦуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тЇЌтЏйтИѓ', 'тЏЏСИЄтЇЂтИѓ', 'жФўуЪЦтИѓ', 'т«ЅУіИтИѓ'], answer: 2 },
      { question: 'удЈт▓АуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тїЌС╣ЮтиътИѓ', 'удЈт▓АтИѓ', 'С╣ЁуЋЎу▒│тИѓ', 'тцДуЅЪућ░тИѓ'], answer: 1 },
      { question: 'СйљУ│ђуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тћљТ┤ЦтИѓ', 'ж│ЦТаќтИѓ', 'СйљУ│ђтИѓ', 'С╝іСИЄжЄїтИѓ'], answer: 2 },
      { question: 'жЋит┤јуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['СйљСИќС┐ЮтИѓ', 'УФФТЌЕтИѓ', 'жЋит┤јтИѓ', 'тцДТЮЉтИѓ'], answer: 2 },
      { question: 'уєіТюгуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тЁФС╗БтИѓ', 'уєіТюгтИѓ', 'тцЕУЇЅтИѓ', 'УЇњт░ЙтИѓ'], answer: 1 },
      { question: 'тцДтѕєуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['тѕЦт║ютИѓ', 'СИГТ┤ЦтИѓ', 'тцДтѕєтИѓ', 'ТЌЦућ░тИѓ'], answer: 2 },
      { question: 'т««т┤јуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жЃйтЪјтИѓ', 'т╗Хт▓АтИѓ', 'т««т┤јтИѓ', 'ТЌЦтљЉтИѓ'], answer: 2 },
      { question: 'ж╣┐тЁљт│ХуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['ж╣┐т▒ІтИѓ', 'ж╣┐тЁљт│ХтИѓ', 'УќЕТЉЕтиЮтєЁтИѓ', 'жюДт│ХтИѓ'], answer: 1 },
      { question: 'Т▓ќуИёуюїсЂ«уюїт║ЂТЅђтюетю░сЂ»№╝Ъ', choices: ['жѓБУдЄтИѓ', 'Т▓ќуИётИѓ', 'ТхдТи╗тИѓ', 'т«южЄјТ╣ЙтИѓ'], answer: 0 }
    ];
    
    // т▒▒тю░т▒▒Уёѕсѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const mountainsQuizData = [
      { question: 'ТЌЦТюгсѓбсЃФсЃЌсѓ╣сЂФтљФсЂЙсѓїсЂфсЂёт▒▒УёѕсЂ»№╝Ъ', choices: ['тїЌсѓбсЃФсЃЌсѓ╣', 'СИГтц«сѓбсЃФсЃЌсѓ╣', 'тЇЌсѓбсЃФсЃЌсѓ╣', 'тЦЦуЙйт▒▒Уёѕ'], answer: 3 },
      { question: 'т»їтБФт▒▒сЂїсЂѓсѓІт▒▒тю░сЂ»№╝Ъ', choices: ['у«▒Та╣т▒▒тю░', 'С╝іУ▒єтЇіт│Х', 'т»їтБФуЂФт▒▒тИ»', 'СИ╣Т▓бт▒▒тю░'], answer: 2 },
      { question: 'ТЌЦТюгсЂДС║їуЋфуЏ«сЂФжФўсЂёт▒▒сЂ»№╝Ъ', choices: ['тїЌт▓│', 'жќЊсЃјт▓│', 'тЦЦуЕѓжФўт▓│', 'ТДЇсЃХт▓│'], answer: 0 },
      { question: 'ТюгтиъСИГтц«жЃесѓњтЇЌтїЌсЂФУх░сѓІт▒▒УёѕсЂ»№╝Ъ', choices: ['СИГтц«т▒▒Уёѕ', 'ТЌЦТюгТхит▒▒Уёѕ', 'тцфт╣│Т┤Іт▒▒Уёѕ', 'сЃЋсѓЕсЃЃсѓхсЃъсѓ░сЃі'], answer: 0 },
      { question: 'С╣ЮтиъТюђжФўт│░сЂ«т▒▒сЂ»№╝Ъ', choices: ['жў┐УўЄт▒▒', 'С╣ЮжЄЇт▒▒', 'уЦќТ»Їт▒▒', 'т««С╣ІТхдт▓│'], answer: 3 },
      { question: 'СИГтЏйт▒▒тю░сЂ«ТюђжФўт│░сЂ»№╝Ъ', choices: ['тцДт▒▒', 'Уњют▒▒', 'Т░исЃјт▒▒', 'тцДт▒▒'], answer: 0 },
      { question: 'тїЌТхижЂЊсЂ«ТюђжФўт│░сЂ»№╝Ъ', choices: ['тѕЕт░╗т▓│', 'уЙЁУЄ╝т▓│', 'ТЌГт▓│', 'тЇЂтІЮт▓│'], answer: 2 },
      { question: 'ТЮ▒тїЌтю░Тќ╣сЂ«УЃїжфесЂесѓѓтЉ╝сЂ░сѓїсѓІт▒▒УёѕсЂ»№╝Ъ', choices: ['тЦЦуЙйт▒▒Уёѕ', 'жў┐ТГджџѕт▒▒тю░', 'тїЌСИіт▒▒тю░', 'тЄ║уЙйт▒▒тю░'], answer: 0 },
      { question: 'жќбТЮ▒т▒▒тю░сЂ«ТюђжФўт│░сЂ»№╝Ъ', choices: ['жЏ▓тЈќт▒▒', 'ућ▓ТГдС┐АсЃХт▓│', 'жЄЉт│░т▒▒', 'тцДУЈЕУќЕтХ║'], answer: 0 },
      { question: 'тЏЏтЏйт▒▒тю░сЂ«ТюђжФўт│░сЂ»№╝Ъ', choices: ['уЪ│жјџт▒▒', 'тЅБт▒▒', 'СИЅтХ║', 'ТЮ▒УхцуЪ│т▒▒'], answer: 0 },
      { question: 'ТЌЦТюгСИЅтцДТђЦТхЂсЂФтљФсЂЙсѓїсЂфсЂётиЮсЂ»№╝Ъ', choices: ['ТюђСИітиЮ', 'т»їтБФтиЮ', 'уљЃуБетиЮ', 'тцЕуФютиЮ'], answer: 3 },
      { question: 'уФІт▒▒жђБт│░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюї', 'т▓љжўюуюї', 'т»їт▒▒уюї', 'Тќ░ТйЪуюї'], answer: 2 },
      { question: 'уЎйт▒▒сЂїсЂѓсѓІуюїтбЃсЂ»№╝Ъ', choices: ['уЪ│тиЮуюїсЃ╗удЈС║Ћуюї', 'уЪ│тиЮуюїсЃ╗т»їт▒▒уюї', 'удЈС║ЋуюїсЃ╗т▓љжўюуюї', 'уЪ│тиЮуюїсЃ╗т▓љжўюуюї'], answer: 0 },
      { question: 'уГЉТ│бт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ТаЃТюеуюї', 'уЙцждгуюї', 'УїетЪјуюї', 'тЪ╝ујЅуюї'], answer: 2 },
      { question: 'жюДт│Хт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['уєіТюгуюїсЃ╗т««т┤јуюї', 'т««т┤јуюїсЃ╗ж╣┐тЁљт│Хуюї', 'ж╣┐тЁљт│ХуюїсЃ╗уєіТюгуюї', 'тцДтѕєуюїсЃ╗т««т┤јуюї'], answer: 1 },
      { question: 'тЁФсЃХт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▒▒Тбеуюї', 'жЋижЄјуюїсЃ╗уЙцждгуюї', 'т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'уЙцждгуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'ТхЁжќЊт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗уЙцждгуюї', 'уЙцждгуюїсЃ╗Тќ░ТйЪуюї', 'жЋижЄјуюїсЃ╗т▒▒Тбеуюї', 'уЙцждгуюїсЃ╗ТаЃТюеуюї'], answer: 0 },
      { question: 'У░итиЮт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['уЙцждгуюїсЃ╗Тќ░ТйЪуюї', 'Тќ░ТйЪуюїсЃ╗жЋижЄјуюї', 'уЙцждгуюїсЃ╗ТаЃТюеуюї', 'Тќ░ТйЪуюїсЃ╗т»їт▒▒уюї'], answer: 0 },
      { question: 'УћхујІт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒тйбуюїсЃ╗т««тЪјуюї', 'т««тЪјуюїсЃ╗удЈт│Хуюї', 'т▒▒тйбуюїсЃ╗удЈт│Хуюї', 'т▒▒тйбуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'Тюѕт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒тйбуюї', 'Тќ░ТйЪуюї', 'удЈт│Хуюї', 'уДІућ░уюї'], answer: 0 },
      { question: 'ж│ЦТхит▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒тйбуюїсЃ╗уДІућ░уюї', 'уДІућ░уюїсЃ╗жЮњТБ«уюї', 'т▒▒тйбуюїсЃ╗Тќ░ТйЪуюї', 'уДІућ░уюїсЃ╗т▓ЕТЅІуюї'], answer: 0 },
      { question: 'т▓ЕТюет▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮњТБ«уюї', 'уДІућ░уюї', 'т▓ЕТЅІуюї', 'т▒▒тйбуюї'], answer: 0 },
      { question: 'т▓ЕТЅІт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▓ЕТЅІуюї', 'т««тЪјуюї', 'уДІућ░уюї', 'жЮњТБ«уюї'], answer: 0 },
      { question: 'ТЂљт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮњТБ«уюї', 'уДІућ░уюї', 'т▓ЕТЅІуюї', 'т▒▒тйбуюї'], answer: 0 },
      { question: 'тЙАтХйт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▓љжўюуюї', 'т▓љжўюуюїсЃ╗ТёЏуЪЦуюї', 'жЋижЄјуюїсЃ╗т▒▒Тбеуюї', 'т▓љжўюуюїсЃ╗т»їт▒▒уюї'], answer: 0 },
      { question: 'С╣ЌжъЇт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▓љжўюуюї', 'т▓љжўюуюїсЃ╗т»їт▒▒уюї', 'жЋижЄјуюїсЃ╗т▒▒Тбеуюї', 'т▓љжўюуюїсЃ╗уЪ│тиЮуюї'], answer: 0 },
      { question: 'ТДЇсЃХт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▓љжўюуюї', 'жЋижЄјуюїсЃ╗т»їт▒▒уюї', 'т▓љжўюуюїсЃ╗т»їт▒▒уюї', 'жЋижЄјуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'уЕѓжФўт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▓љжўюуюї', 'жЋижЄјуюїсЃ╗т»їт▒▒уюї', 'т▓љжўюуюїсЃ╗т»їт▒▒уюї', 'жЋижЄјуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'УхцуЪ│т▒▒УёѕсЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['тїЌсѓбсЃФсЃЌсѓ╣', 'СИГтц«сѓбсЃФсЃЌсѓ╣', 'тЇЌсѓбсЃФсЃЌсѓ╣', 'ТЌЦТюгсѓбсЃФсЃЌсѓ╣'], answer: 2 },
      { question: 'жБЏжеет▒▒УёѕсЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['тїЌсѓбсЃФсЃЌсѓ╣', 'СИГтц«сѓбсЃФсЃЌсѓ╣', 'тЇЌсѓбсЃФсЃЌсѓ╣', 'ТЌЦТюгсѓбсЃФсЃЌсѓ╣'], answer: 0 },
      { question: 'ТюеТЏйт▒▒УёѕсЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['тїЌсѓбсЃФсЃЌсѓ╣', 'СИГтц«сѓбсЃФсЃЌсѓ╣', 'тЇЌсѓбсЃФсЃЌсѓ╣', 'ТЌЦТюгсѓбсЃФсЃЌсѓ╣'], answer: 1 },
      { question: 'жЄЉт│░т▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒ТбеуюїсЃ╗жЋижЄјуюї', 'жЋижЄјуюїсЃ╗уЙцждгуюї', 'т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'жЋижЄјуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'ућ▓ТќљжДњсЃХт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒ТбеуюїсЃ╗жЋижЄјуюї', 'т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'жЋижЄјуюїсЃ╗т▓љжўюуюї', 'т▒▒ТбеуюїсЃ╗тЪ╝ујЅуюї'], answer: 0 },
      { question: 'тїЌт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒Тбеуюї', 'жЋижЄјуюї', 'жЮЎт▓Ауюї', 'уЙцждгуюї'], answer: 0 },
      { question: 'жќЊсЃјт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'т▒▒ТбеуюїсЃ╗жЋижЄјуюї', 'жЮЎт▓АуюїсЃ╗жЋижЄјуюї', 'т▒▒ТбеуюїсЃ╗уЦътЦѕтиЮуюї'], answer: 0 },
      { question: 'Ухцт▓│сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗т▒▒Тбеуюї', 'жЋижЄјуюїсЃ╗уЙцждгуюї', 'т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'жЋижЄјуюїсЃ╗Тќ░ТйЪуюї'], answer: 0 },
      { question: 'тдЎжФўт▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['Тќ░ТйЪуюї', 'жЋижЄјуюї', 'уЙцждгуюї', 'т»їт▒▒уюї'], answer: 0 },
      { question: 'УІЌта┤т▒▒сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['Тќ░ТйЪуюїсЃ╗жЋижЄјуюї', 'Тќ░ТйЪуюїсЃ╗уЙцждгуюї', 'жЋижЄјуюїсЃ╗уЙцждгуюї', 'Тќ░ТйЪуюїсЃ╗т»їт▒▒уюї'], answer: 0 }
    ];
    
    // тиЮсѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const riversQuizData = [
      { question: 'ТЌЦТюгсЂДСИђуЋфжЋисЂётиЮсЂ»№╝Ъ', choices: ['С┐АТ┐ЃтиЮ', 'тѕЕТа╣тиЮ', 'уЪ│уІЕтиЮ', 'тїЌСИітиЮ'], answer: 0 },
      { question: 'ТЌЦТюгсЂДС║їуЋфуЏ«сЂФжЋисЂётиЮсЂ»№╝Ъ', choices: ['тѕЕТа╣тиЮ', 'уЪ│уІЕтиЮ', 'тцЕуФютиЮ', 'тїЌСИітиЮ'], answer: 0 },
      { question: 'жќбТЮ▒т╣│жЄјсѓњТхЂсѓїсѓІтцДТ▓│сЂ»№╝Ъ', choices: ['тцџТЉЕтиЮ', 'УЇњтиЮ', 'тѕЕТа╣тиЮ', 'Т▒ЪТѕИтиЮ'], answer: 2 },
      { question: 'С╣ЮтиъТюђтцДсЂ«тиЮсЂ»№╝Ъ', choices: ['уГЉтЙїтиЮ', 'уљЃуБетиЮ', 'тцДТиђтиЮ', 'жЂаУ│ђтиЮ'], answer: 0 },
      { question: 'тЏЏтЏйТюђтцДсЂ«тиЮсЂ»№╝Ъ', choices: ['тљЅжЄјтиЮ', 'тЏЏСИЄтЇЂтиЮ', 'жѓБУ│ђтиЮ', 'жЄЇС┐АтиЮ'], answer: 0 },
      { question: 'СИГтЏйтю░Тќ╣ТюђтцДсЂ«тиЮсЂ»№╝Ъ', choices: ['Т▒ЪсЂ«тиЮ', 'ТЌГтиЮ', 'тљЅС║ЋтиЮ', 'жФўТбЂтиЮ'], answer: 0 },
      { question: 'ТЮ▒тїЌтю░Тќ╣ТюђтцДсЂ«тиЮсЂ»№╝Ъ', choices: ['тїЌСИітиЮ', 'ТюђСИітиЮ', 'жў┐ТГджџѕтиЮ', 'у▒│С╗БтиЮ'], answer: 0 },
      { question: 'тїЌТхижЂЊТюђтцДсЂ«тиЮсЂ»№╝Ъ', choices: ['уЪ│уІЕтиЮ', 'тЇЂтІЮтиЮ', 'тцЕтАЕтиЮ', 'жЄДУи»тиЮ'], answer: 0 },
      { question: 'ТЌЦТюгСИЅтцДТђЦТхЂсЂ«СИђсЂцсЂ»№╝Ъ', choices: ['тцЕуФютиЮ', 'т»їтБФтиЮ', 'ТюеТЏйтиЮ', 'тцДС║ЋтиЮ'], answer: 1 },
      { question: 'уљхуљХТ╣ќсЂІсѓЅТхЂсѓїтЄ║сѓІтиЮсЂ»№╝Ъ', choices: ['ТиђтиЮ', 'т«ЄТ▓╗тиЮ', 'ТАѓтиЮ', 'ТюеТ┤ЦтиЮ'], answer: 0 },
      { question: 'т»їт▒▒Т╣ЙсЂФТ│есЂљтиЮсЂ»№╝Ъ', choices: ['уЦъжђџтиЮ', 'ТЅІтЈќтиЮ', 'С╣ЮжаГуФютиЮ', 'т║ётиЮ'], answer: 0 },
      { question: 'ТЌЦТюгТхисЂФТ│есЂљтиЮсЂ»№╝Ъ', choices: ['жў┐У│ђжЄјтиЮ', 'С╣ЁТЁѕтиЮ', 'жѓБуЈѓтиЮ', 'уЏИТеАтиЮ'], answer: 0 },
      { question: 'тцфт╣│Т┤ІсЂФТ│есЂљтиЮсЂ»№╝Ъ', choices: ['С┐АТ┐ЃтиЮ', 'жў┐У│ђжЄјтиЮ', 'ТюђСИітиЮ', 'С╣ЁТЁѕтиЮ'], answer: 3 },
      { question: 'уђгТѕИтєЁТхисЂФТ│есЂљтиЮсЂ»№╝Ъ', choices: ['ТиђтиЮ', 'у┤ђсЂ«тиЮ', 'жѓБУ│ђтиЮ', 'жЂаУ│ђтиЮ'], answer: 0 },
      { question: 'Тџ┤сѓїтиЮсЂесЂЌсЂдТюЅтљЇсЂасЂБсЂЪтиЮсЂ»№╝Ъ', choices: ['тѕЕТа╣тиЮ', 'УЇњтиЮ', 'тцџТЉЕтиЮ', 'уЏИТеАтиЮ'], answer: 0 },
      { question: 'ТюеТЏйСИЅтиЮсЂФтљФсЂЙсѓїсЂфсЂётиЮсЂ»№╝Ъ', choices: ['ТюеТЏйтиЮ', 'жЋиУЅ»тиЮ', 'ТЈќТќљтиЮ', 'уЪбСйютиЮ'], answer: 3 },
      { question: 'тцџТЉЕтиЮсЂїТхЂсѓїсѓІжЃйуюїсЂ»№╝Ъ', choices: ['ТЮ▒С║гжЃйсЃ╗уЦътЦѕтиЮуюї', 'ТЮ▒С║гжЃйсЃ╗тЪ╝ујЅуюї', 'ТЮ▒С║гжЃйсЃ╗тЇЃУЉЅуюї', 'ТЮ▒С║гжЃйсЃ╗т▒▒Тбеуюї'], answer: 0 },
      { question: 'УЇњтиЮсЂїТхЂсѓїсѓІжЃйуюїсЂ»№╝Ъ', choices: ['тЪ╝ујЅуюїсЃ╗ТЮ▒С║гжЃй', 'ТЮ▒С║гжЃйсЃ╗тЇЃУЉЅуюї', 'тЪ╝ујЅуюїсЃ╗уЙцждгуюї', 'ТЮ▒С║гжЃйсЃ╗уЦътЦѕтиЮуюї'], answer: 0 },
      { question: 'уЏИТеАтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['уЦътЦѕтиЮуюїсЃ╗т▒▒Тбеуюї', 'уЦътЦѕтиЮуюїсЃ╗жЮЎт▓Ауюї', 'уЦътЦѕтиЮуюїсЃ╗ТЮ▒С║гжЃй', 'уЦътЦѕтиЮуюїсЃ╗тЇЃУЉЅуюї'], answer: 0 },
      { question: 'ТиђтиЮсЂ«СИіТхЂсЂФсЂѓсѓІтиЮсЂ»№╝Ъ', choices: ['т«ЄТ▓╗тиЮсЃ╗ТюеТ┤ЦтиЮсЃ╗ТАѓтиЮ', 'тцДтњїтиЮсЃ╗уЪ│тиЮсЃ╗СйљС┐ЮтиЮ', 'ТГдт║ФтиЮсЃ╗уїфтљЇтиЮсЃ╗УЌ╗тиЮ', 'тіатЈцтиЮсЃ╗тИѓтиЮсЃ╗тцбтЅЇтиЮ'], answer: 0 },
      { question: 'уљхуљХТ╣ќсЂІсѓЅТхЂсѓїтЄ║сѓІтиЮсЂ»№╝Ъ', choices: ['уђгућ░тиЮ', 'т«ЅТЏЄтиЮ', 'жЄјТ┤▓тиЮ', 'тДЅтиЮ'], answer: 0 },
      { question: 'у┤ђсЂ«тиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['тЦѕУЅ»уюїсЃ╗тњїТГїт▒▒уюї', 'СИЅжЄЇуюїсЃ╗тњїТГїт▒▒уюї', 'тцДжўфт║юсЃ╗тњїТГїт▒▒уюї', 'тЁхт║ФуюїсЃ╗тњїТГїт▒▒уюї'], answer: 0 },
      { question: 'уєіжЄјтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['СИЅжЄЇуюїсЃ╗тњїТГїт▒▒уюїсЃ╗тЦѕУЅ»уюї', 'СИЅжЄЇуюїсЃ╗тњїТГїт▒▒уюї', 'тЦѕУЅ»уюїсЃ╗тњїТГїт▒▒уюї', 'тњїТГїт▒▒уюїсЃ╗тцДжўфт║ю'], answer: 0 },
      { question: 'тцДтњїтиЮсЂїТхЂсѓїсѓІт║юуюїсЂ»№╝Ъ', choices: ['тЦѕУЅ»уюїсЃ╗тцДжўфт║ю', 'С║гжЃйт║юсЃ╗тцДжўфт║ю', 'тЁхт║ФуюїсЃ╗тцДжўфт║ю', 'Т╗ІУ│ђуюїсЃ╗тцДжўфт║ю'], answer: 0 },
      { question: 'ТЌГтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т▓Ат▒▒уюї', 'т║Ѓт│Хуюї', 'ж│ЦтЈќуюї', 'т│ХТа╣уюї'], answer: 0 },
      { question: 'тцфућ░тиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т║Ѓт│Хуюї', 'т▓Ат▒▒уюї', 'т▒▒тЈБуюї', 'т│ХТа╣уюї'], answer: 0 },
      { question: 'Т▒ЪсЂ«тиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т║Ѓт│ХуюїсЃ╗т│ХТа╣уюї', 'т▓Ат▒▒уюїсЃ╗ж│ЦтЈќуюї', 'т▒▒тЈБуюїсЃ╗т│ХТа╣уюї', 'т║Ѓт│ХуюїсЃ╗т▒▒тЈБуюї'], answer: 0 },
      { question: 'жФўТбЂтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т▓Ат▒▒уюї', 'т║Ѓт│Хуюї', 'ж│ЦтЈќуюї', 'т│ХТа╣уюї'], answer: 0 },
      { question: 'тљЅС║ЋтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т▓Ат▒▒уюї', 'т║Ѓт│Хуюї', 'тЁхт║Фуюї', 'ж│ЦтЈќуюї'], answer: 0 },
      { question: 'тЇЃС╗БтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['ж│ЦтЈќуюї', 'т│ХТа╣уюї', 'т▓Ат▒▒уюї', 'тЁхт║Фуюї'], answer: 0 },
      { question: 'ТЌЦжЄјтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['ж│ЦтЈќуюї', 'т│ХТа╣уюї', 'удЈС║Ћуюї', 'СИАТќ╣сЂФсЂѓсѓІ'], answer: 3 },
      { question: 'ТќљС╝ітиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т│ХТа╣уюї', 'ж│ЦтЈќуюї', 'т║Ѓт│Хуюї', 'т▒▒тЈБуюї'], answer: 0 },
      { question: 'тцЕуФютиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюїсЃ╗жЮЎт▓АуюїсЃ╗ТёЏуЪЦуюї', 'жЋижЄјуюїсЃ╗жЮЎт▓Ауюї', 'жЮЎт▓АуюїсЃ╗ТёЏуЪЦуюї', 'жЋижЄјуюїсЃ╗ТёЏуЪЦуюї'], answer: 0 },
      { question: 'т»їтБФтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'жЮЎт▓АуюїсЃ╗уЦътЦѕтиЮуюї', 'т▒▒ТбеуюїсЃ╗жЋижЄјуюї', 'жЮЎт▓АуюїсЃ╗ТёЏуЪЦуюї'], answer: 0 },
      { question: 'тцДС║ЋтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['жЮЎт▓Ауюї', 'ТёЏуЪЦуюї', 'т▒▒Тбеуюї', 'жЋижЄјуюї'], answer: 0 },
      { question: 'уІЕжЄјтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['жЮЎт▓Ауюї', 'уЦътЦѕтиЮуюї', 'т▒▒Тбеуюї', 'ТёЏуЪЦуюї'], answer: 0 },
      { question: 'уЪбСйютиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['ТёЏуЪЦуюї', 'т▓љжўюуюї', 'СИЅжЄЇуюї', 'жЮЎт▓Ауюї'], answer: 0 },
      { question: 'У▒ітиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['ТёЏуЪЦуюї', 'жЮЎт▓Ауюї', 'жЋижЄјуюї', 'т▓љжўюуюї'], answer: 0 },
      { question: 'т║ётєЁтиЮсЂїТхЂсѓїсѓІуюїсЂ»№╝Ъ', choices: ['т▓љжўюуюїсЃ╗ТёЏуЪЦуюї', 'ТёЏуЪЦуюїсЃ╗СИЅжЄЇуюї', 'т▓љжўюуюїсЃ╗СИЅжЄЇуюї', 'ТёЏуЪЦуюїсЃ╗жЮЎт▓Ауюї'], answer: 0 }
    ];
    
    // т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const plainsQuizData = [
      { question: 'ТЌЦТюгТюђтцДсЂ«т╣│жЄјсЂ»№╝Ъ', choices: ['жќбТЮ▒т╣│жЄј', 'Т┐Ѓт░Йт╣│жЄј', 'тцДжўфт╣│жЄј', 'УХітЙїт╣│жЄј'], answer: 0 },
      { question: 'ТЌЦТюгсЂДС║їуЋфуЏ«сЂФтцДсЂЇсЂёт╣│жЄјсЂ»№╝Ъ', choices: ['уЪ│уІЕт╣│жЄј', 'С╗ЎтЈ░т╣│жЄј', 'Т┐Ѓт░Йт╣│жЄј', 'тцДжўфт╣│жЄј'], answer: 0 },
      { question: 'ућ▓т║юуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюї', 'т▒▒Тбеуюї', 'жЮЎт▓Ауюї', 'т▓љжўюуюї'], answer: 1 },
      { question: 'тЦѕУЅ»уЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тЦѕУЅ»уюї', 'С║гжЃйт║ю', 'тцДжўфт║ю', 'тњїТГїт▒▒уюї'], answer: 0 },
      { question: 'С╝џТ┤ЦуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒тйбуюї', 'Тќ░ТйЪуюї', 'удЈт│Хуюї', 'ТаЃТюеуюї'], answer: 2 },
      { question: 'Т┤ЦУ╗йт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮњТБ«уюї', 'уДІућ░уюї', 'т▓ЕТЅІуюї', 'т▒▒тйбуюї'], answer: 0 },
      { question: 'т║ётєЁт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['Тќ░ТйЪуюї', 'т▒▒тйбуюї', 'уДІућ░уюї', 'удЈт│Хуюї'], answer: 1 },
      { question: 'уГЉу┤Фт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['удЈт▓АуюїсЃ╗СйљУ│ђуюї', 'уєіТюгуюїсЃ╗тцДтѕєуюї', 'жЋит┤јуюїсЃ╗СйљУ│ђуюї', 'т««т┤јуюїсЃ╗ж╣┐тЁљт│Хуюї'], answer: 0 },
      { question: 'У«Ѓт▓љт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ТёЏтфЏуюї', 'ждЎтиЮуюї', 'тЙ│т│Хуюї', 'жФўуЪЦуюї'], answer: 1 },
      { question: 'тЄ║жЏ▓т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ж│ЦтЈќуюї', 'т│ХТа╣уюї', 'т▓Ат▒▒уюї', 'т║Ѓт│Хуюї'], answer: 1 },
      { question: 'ТГдУћхжЄјтЈ░тю░сЂїсЂѓсѓІтю░тЪЪсЂ»№╝Ъ', choices: ['жќбТЮ▒тю░Тќ╣', 'СИГжЃетю░Тќ╣', 'У┐ЉуЋ┐тю░Тќ╣', 'СИГтЏйтю░Тќ╣'], answer: 0 },
      { question: 'Та╣жЄДтЈ░тю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'жЮњТБ«уюї', 'т▓ЕТЅІуюї', 'т««тЪјуюї'], answer: 0 },
      { question: 'жў┐УўЄсѓФсЃФсЃЄсЃЕсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тцДтѕєуюї', 'т««т┤јуюї', 'уєіТюгуюї', 'ж╣┐тЁљт│Хуюї'], answer: 2 },
      { question: 'тЇЂтІЮт╣│жЄјсЂїсЂѓсѓІтю░тЪЪсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'ТЮ▒тїЌтю░Тќ╣', 'жќбТЮ▒тю░Тќ╣', 'СИГжЃетю░Тќ╣'], answer: 0 },
      { question: 'т««т┤јт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тцДтѕєуюї', 'уєіТюгуюї', 'т««т┤јуюї', 'ж╣┐тЁљт│Хуюї'], answer: 2 },
      { question: 'Та╣жЄДтЈ░тю░сЂїсЂѓсѓІтю░тЪЪсЂ»№╝Ъ', choices: ['тїЌТхижЂЊ', 'жЮњТБ«уюї', 'т▓ЕТЅІуюї', 'уДІућ░уюї'], answer: 0 },
      { question: 'уДІућ░т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮњТБ«уюї', 'уДІућ░уюї', 'т▒▒тйбуюї', 'т▓ЕТЅІуюї'], answer: 1 },
      { question: 'т║ётєЁт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒тйбуюї', 'Тќ░ТйЪуюї', 'уДІућ░уюї', 'удЈт│Хуюї'], answer: 0 },
      { question: 'Тќ░ТйЪт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['Тќ░ТйЪуюї', 'т»їт▒▒уюї', 'жЋижЄјуюї', 'удЈт│Хуюї'], answer: 0 },
      { question: 'УХітЙїт╣│жЄјсЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['Тќ░ТйЪт╣│жЄј', 'жФўућ░т╣│жЄј', 'жЋит▓Ат╣│жЄј', 'ТЪЈт┤јт╣│жЄј'], answer: 0 },
      { question: 'т»їт▒▒т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т»їт▒▒уюї', 'уЪ│тиЮуюї', 'Тќ░ТйЪуюї', 'удЈС║Ћуюї'], answer: 0 },
      { question: 'удЈС║Ћт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['удЈС║Ћуюї', 'уЪ│тиЮуюї', 'т»їт▒▒уюї', 'Т╗ІУ│ђуюї'], answer: 0 },
      { question: 'ућ▓т║юуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▒▒Тбеуюї', 'жЋижЄјуюї', 'уЙцждгуюї', 'жЮЎт▓Ауюї'], answer: 0 },
      { question: 'ТЮЙТюгуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюї', 'т▒▒Тбеуюї', 'т▓љжўюуюї', 'Тќ░ТйЪуюї'], answer: 0 },
      { question: 'СИіућ░уЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюї', 'уЙцждгуюї', 'Тќ░ТйЪуюї', 'т▒▒Тбеуюї'], answer: 0 },
      { question: 'УФЈУефуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЋижЄјуюї', 'т▒▒Тбеуюї', 'т▓љжўюуюї', 'жЮЎт▓Ауюї'], answer: 0 },
      { question: 'жЋижЄјуЏєтю░сЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['тќётЁЅт»║т╣│', 'ТЮЙТюгт╣│', 'С╝іжѓБУ░и', 'СйљС╣Ёт╣│'], answer: 0 },
      { question: 'т▓љжўют╣│жЄјсЂ«тѕЦтљЇсЂ»№╝Ъ', choices: ['Т┐Ѓт░Йт╣│жЄј', 'уЙјТ┐Ѓт╣│жЄј', 'жБЏжеет╣│жЄј', 'ТюеТЏйт╣│жЄј'], answer: 0 },
      { question: 'жЮЎт▓Ат╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮЎт▓Ауюї', 'ТёЏуЪЦуюї', 'т▒▒Тбеуюї', 'уЦътЦѕтиЮуюї'], answer: 0 },
      { question: 'ТхюТЮЙт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жЮЎт▓Ауюї', 'ТёЏуЪЦуюї', 'т▓љжўюуюї', 'СИЅжЄЇуюї'], answer: 0 },
      { question: 'У▒іТЕІт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ТёЏуЪЦуюї', 'жЮЎт▓Ауюї', 'СИЅжЄЇуюї', 'т▓љжўюуюї'], answer: 0 },
      { question: 'С╝ітІбт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['СИЅжЄЇуюї', 'ТёЏуЪЦуюї', 'т▓љжўюуюї', 'Т╗ІУ│ђуюї'], answer: 0 },
      { question: 'У┐ЉТ▒ЪуЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['Т╗ІУ│ђуюї', 'С║гжЃйт║ю', 'СИЅжЄЇуюї', 'удЈС║Ћуюї'], answer: 0 },
      { question: 'С║гжЃйуЏєтю░сЂїсЂѓсѓІт║юсЂ»№╝Ъ', choices: ['С║гжЃйт║ю', 'тцДжўфт║ю', 'Т╗ІУ│ђуюї', 'тЦѕУЅ»уюї'], answer: 0 },
      { question: 'тЦѕУЅ»уЏєтю░сЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тЦѕУЅ»уюї', 'тцДжўфт║ю', 'С║гжЃйт║ю', 'тњїТГїт▒▒уюї'], answer: 0 },
      { question: 'ТњГуБет╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тЁхт║Фуюї', 'т▓Ат▒▒уюї', 'тцДжўфт║ю', 'С║гжЃйт║ю'], answer: 0 },
      { question: 'т▓Ат▒▒т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т▓Ат▒▒уюї', 'т║Ѓт│Хуюї', 'тЁхт║Фуюї', 'ж│ЦтЈќуюї'], answer: 0 },
      { question: 'тЄ║жЏ▓т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['т│ХТа╣уюї', 'ж│ЦтЈќуюї', 'т║Ѓт│Хуюї', 'т▒▒тЈБуюї'], answer: 0 },
      { question: 'У«Ѓт▓љт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ждЎтиЮуюї', 'тЙ│т│Хуюї', 'ТёЏтфЏуюї', 'жФўуЪЦуюї'], answer: 0 },
      { question: 'ТЮЙт▒▒т╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ТёЏтфЏуюї', 'ждЎтиЮуюї', 'жФўуЪЦуюї', 'тЙ│т│Хуюї'], answer: 0 },
      { question: 'жФўуЪЦт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['жФўуЪЦуюї', 'ТёЏтфЏуюї', 'тЙ│т│Хуюї', 'ждЎтиЮуюї'], answer: 0 },
      { question: 'уГЉтЙїт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['удЈт▓АуюїсЃ╗СйљУ│ђуюї', 'удЈт▓АуюїсЃ╗тцДтѕєуюї', 'СйљУ│ђуюїсЃ╗жЋит┤јуюї', 'удЈт▓АуюїсЃ╗уєіТюгуюї'], answer: 0 },
      { question: 'СйљУ│ђт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['СйљУ│ђуюї', 'жЋит┤јуюї', 'удЈт▓Ауюї', 'уєіТюгуюї'], answer: 0 },
      { question: 'уєіТюгт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['уєіТюгуюї', 'т««т┤јуюї', 'ж╣┐тЁљт│Хуюї', 'тцДтѕєуюї'], answer: 0 },
      { question: 'тцДтѕєт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['тцДтѕєуюї', 'т««т┤јуюї', 'уєіТюгуюї', 'удЈт▓Ауюї'], answer: 0 },
      { question: 'ж╣┐тЁљт│Хт╣│жЄјсЂїсЂѓсѓІуюїсЂ»№╝Ъ', choices: ['ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'уєіТюгуюї', 'Т▓ќуИёуюї'], answer: 0 },
      { question: 'сѓисЃЕсѓ╣тЈ░тю░сЂїт║ЃсЂїсѓІуюїсЂ»№╝Ъ', choices: ['ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'уєіТюгуюї', 'тцДтѕєуюї'], answer: 0 }
    ];

    // СИќуЋїтю░уљєсѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const worldQuizData = [
      { question: 'СИќуЋїсЂДСИђуЋфтцДсЂЇсЂётЏйсЂ»№╝Ъ', choices: ['сЃГсѓисѓб', 'сѓФсЃісЃђ', 'СИГтЏй', 'сѓбсЃАсЃфсѓФ'], answer: 0 },
      { question: 'СИќуЋїсЂДСИђуЋфС║║тЈБсЂїтцџсЂётЏйсЂ»№╝Ъ', choices: ['сѓцсЃ│сЃЅ', 'СИГтЏй', 'сѓбсЃАсЃфсѓФ', 'сѓцсЃ│сЃЅсЃЇсѓисѓб'], answer: 0 },
      { question: 'сѓесЃЃсЃЋсѓДсЃФтАћсЂїсЂѓсѓІтЏйсЂ»№╝Ъ', choices: ['сЃЋсЃЕсЃ│сѓ╣', 'сѓцсѓ┐сЃфсѓб', 'сѓ╣сЃџсѓцсЃ│', 'сЃЅсѓцсЃё'], answer: 0 },
      { question: 'СИќуЋїСИђжЋисЂётиЮсЂ»№╝Ъ', choices: ['сЃісѓцсЃФтиЮ', 'сѓбсЃъсѓЙсЃ│тиЮ', 'сЃЪсѓисѓисЃЃсЃћтиЮ', 'жЋиТ▒Ъ'], answer: 0 },
      { question: 'СИќуЋїСИђжФўсЂёт▒▒сЂ»№╝Ъ', choices: ['сѓесЃЎсЃгсѓ╣сЃѕ', 'K2', 'сЃъсЃЃсѓГсЃ│сЃфсЃ╝', 'сѓбсѓ│сЃ│сѓФсѓ░сѓб'], answer: 0 },
      { question: 'сЃћсЃЕсЃЪсЃЃсЃЅсЂїсЂѓсѓІтЏйсЂ»№╝Ъ', choices: ['сѓесѓИсЃЌсЃѕ', 'сЃАсѓГсѓисѓ│', 'сЃџсЃФсЃ╝', 'сѓцсЃ│сЃЅ'], answer: 0 },
      { question: 'сЃЉсЃ│сЃђсЂ«ТЋЁжЃисЂ»№╝Ъ', choices: ['СИГтЏй', 'ТЌЦТюг', 'сѓцсЃ│сЃЅ', 'сѓфсЃ╝сѓ╣сЃѕсЃЕсЃфсѓб'], answer: 0 },
      { question: 'сѓфсЃфсЃ│сЃћсЃЃсѓ»уЎ║уЦЦсЂ«тЏйсЂ»№╝Ъ', choices: ['сѓ«сЃфсѓисЃБ', 'сѓцсѓ┐сЃфсѓб', 'сЃЋсЃЕсЃ│сѓ╣', 'сѓцсѓ«сЃфсѓ╣'], answer: 0 },
      { question: 'СИќуЋїСИђт░ЈсЂЋсЂётЏйсЂ»№╝Ъ', choices: ['сЃљсЃЂсѓФсЃ│тИѓтЏй', 'сЃбсЃісѓ│', 'сѓхсЃ│сЃъсЃфсЃј', 'сЃфсЃњсЃєсЃ│сѓисЃЦсѓ┐сѓцсЃ│'], answer: 0 },
      { question: 'сѓхсѓ░сЃЕсЃђсЃ╗сЃЋсѓАсЃЪсЃфсѓбсЂїсЂѓсѓІтЏйсЂ»№╝Ъ', choices: ['сѓ╣сЃџсѓцсЃ│', 'сѓцсѓ┐сЃфсѓб', 'сЃЋсЃЕсЃ│сѓ╣', 'сЃЮсЃФсЃѕсѓгсЃФ'], answer: 0 },
      { question: 'сѓФсЃ│сѓгсЃФсЃ╝сЂ«тЏйсЂ»№╝Ъ', choices: ['сѓфсЃ╝сѓ╣сЃѕсЃЕсЃфсѓб', 'сЃІсЃЦсЃ╝сѓИсЃ╝сЃЕсЃ│сЃЅ', 'тЇЌсѓбсЃЋсЃфсѓФ', 'сѓцсЃ│сЃЅ'], answer: 0 },
      { question: 'сЃЋсѓБсЃесЃФсЃЅсЂїтцџсЂётЏйсЂ»№╝Ъ', choices: ['сЃјсЃФсѓдсѓДсЃ╝', 'сѓ╣сѓдсѓДсЃ╝сЃЄсЃ│', 'сЃЋсѓБсЃ│сЃЕсЃ│сЃЅ', 'сЃЄсЃ│сЃъсЃ╝сѓ»'], answer: 0 },
      { question: 'сЃъсЃЂсЃЦсЃћсЃЂсЃЦсЂїсЂѓсѓІтЏйсЂ»№╝Ъ', choices: ['сЃџсЃФсЃ╝', 'сЃюсЃфсЃЊсѓб', 'сѓесѓ»сѓбсЃЅсЃФ', 'сЃЂсЃф'], answer: 0 },
      { question: 'сѓхсЃЃсѓФсЃ╝сЃ»сЃ╝сЃФсЃЅсѓФсЃЃсЃЌтёфтІЮтЏъТЋ░ТюђтцџсЂ«тЏйсЂ»№╝Ъ', choices: ['сЃќсЃЕсѓИсЃФ', 'сЃЅсѓцсЃё', 'сѓцсѓ┐сЃфсѓб', 'сѓбсЃФсѓ╝сЃ│сЃЂсЃ│'], answer: 0 },
      { question: 'сЃісѓцсѓбсѓгсЃЕсЂ«Т╗ЮсЂїсЂѓсѓІтЏйсЂ»№╝Ъ', choices: ['сѓФсЃісЃђсЃ╗сѓбсЃАсЃфсѓФ', 'сЃќсЃЕсѓИсЃФ', 'сѓбсЃФсѓ╝сЃ│сЃЂсЃ│', 'сЃАсѓГсѓисѓ│'], answer: 0 }
    ];
    
    // СИќуЋїтю░уљєсѓ»сѓцсѓ║
    let worldQuizIndex = 0;
    let worldQuizScore = 0;
    let worldQuizQuestions = [];
    function showWorldQuiz() {
      if (worldQuizIndex === 0) {
        let shuffledData = shuffle([...worldQuizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          const easyCountries = ['сѓбсЃАсЃфсѓФ', 'СИГтЏй', 'сѓцсѓ«сЃфсѓ╣', 'сЃЋсЃЕсЃ│сѓ╣', 'сЃЅсѓцсЃё', 'сѓцсѓ┐сЃфсѓб', 'сѓФсЃісЃђ', 'сѓфсЃ╝сѓ╣сЃѕсЃЕсЃфсѓб', 'сЃќсЃЕсѓИсЃФ', 'сѓцсЃ│сЃЅ'];
          const easyQuestions = shuffledData.filter(q => easyCountries.some(country => q.question.includes(country) || q.choices.some(choice => choice.includes(country))));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          const hardCountries = ['сЃФсЃ»сЃ│сЃђ', 'сЃќсЃ╝сѓ┐сЃ│', 'сѓесѓ╣сЃѕсЃІсѓб', 'сѓ╣сЃГсЃЎсЃІсѓб', 'сѓдсЃФсѓ░сѓбсѓц', 'сЃѕсЃ│сѓг', 'сЃљсЃїсѓбсЃё', 'сЃЋсѓБсѓИсЃ╝', 'сЃЉсЃЕсѓф', 'сЃбсЃФсЃЄсѓБсЃќ'];
          const hardQuestions = shuffledData.filter(q => hardCountries.some(country => q.question.includes(country) || q.choices.some(choice => choice.includes(country))));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        const questionNum = Math.min(questionCount, shuffledData.length);
        worldQuizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        worldQuizScore = 0;
      }
      if (worldQuizIndex >= worldQuizQuestions.length) {
        saveScore('world', worldQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>СИќуЋїтю░уљєсѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${worldQuizScore} / ${worldQuizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        worldQuizIndex = 0;
        return;
      }
      const q = worldQuizQuestions[worldQuizIndex];
      let html = `<h2>­ЪїЇ СИќуЋїтю░уљєсѓ»сѓцсѓ║ угг${worldQuizIndex + 1}тЋЈ</h2><div style="font-size:1.2em;margin:16px 0;">${q.question}</div><form id="world-quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:8px 0;font-size:1.1em;"><input type="radio" name="choice" value="${i}"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:16px;">тЏъуГћ</button></form><div id="world-quiz-feedback"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('world-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('world-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:green;">ТГБУДБ№╝Ђ</span>' : `<span style="color:red;">СИЇТГБУДБсђѓТГБУДБсЂ» ${q.choices[q.answer]} сЂДсЂЎсђѓ</span>`;
        if (isCorrect) worldQuizScore++;
        worldQuizIndex++;
        setTimeout(showWorldQuiz, 1200);
      };
    }
    
    // Тќ╣Уеђсѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const dialectQuizData = [
      { question: 'сђїсЂфсѓЊсЂЌсѓѕсѓЊ№╝ЪсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['ждЎтиЮуюї', 'жЮњТБ«уюї', 'тцДжўфт║ю', 'Т▓ќуИёуюї'], answer: 0 },
      { question: 'сђїсЂасЂ╣сђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['тїЌТхижЂЊсЃ╗ТЮ▒тїЌ', 'жќбУЦ┐', 'С╣Ютиъ', 'тЏЏтЏй'], answer: 0 },
      { question: 'сђїсѓЂсЂБсЂАсѓЃсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['жќбУЦ┐', 'жќбТЮ▒', 'ТЮ▒тїЌ', 'С╣Ютиъ'], answer: 0 },
      { question: 'сђїсЂ░сЂБсЂдсѓЊсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['уєіТюгуюї', 'удЈт▓Ауюї', 'СйљУ│ђуюї', 'жЋит┤јуюї'], answer: 0 },
      { question: 'сђїсЂўсѓЃсѓЊсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['уЦътЦѕтиЮуюї', 'ТЮ▒С║гжЃй', 'тЇЃУЉЅуюї', 'тЪ╝ујЅуюї'], answer: 0 },
      { question: 'сђїсЂ╗сѓЊсЂЙсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['жќбУЦ┐', 'СИГтЏй', 'тЏЏтЏй', 'С╣Ютиъ'], answer: 0 },
      { question: 'сђїсЂфсЂЙсѓЅсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['тїЌТхижЂЊ', 'жЮњТБ«уюї', 'уДІућ░уюї', 'т▓ЕТЅІуюї'], answer: 0 },
      { question: 'сђїсЂєсЂАсЂфсЃ╝сђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['Т▓ќуИёуюї', 'ж╣┐тЁљт│Хуюї', 'т««т┤јуюї', 'уєіТюгуюї'], answer: 0 },
      { question: 'сђїсЂџсѓЅсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['т▒▒ТбеуюїсЃ╗жЮЎт▓Ауюї', 'жЋижЄјуюї', 'Тќ░ТйЪуюї', 'уЙцждгуюї'], answer: 0 },
      { question: 'сђїсѓёсЂЉсѓЊсђЇсЂ»сЂЕсЂЊсЂ«Тќ╣Уеђ№╝Ъ', choices: ['т║Ѓт│ХуюїсЃ╗т▒▒тЈБуюї', 'т▓Ат▒▒уюї', 'ТёЏтфЏуюї', 'ждЎтиЮуюї'], answer: 0 }
    ];

    // сѓ»сѓцсѓ║
    let quizIndex = 0;
    let quizScore = 0;
    let quizQuestions = [];
    
    // тГду┐њті╣ујЄсѓбсЃЃсЃЌТЕЪУЃйућесЂ«тцЅТЋ░
    let wrongQuestions = JSON.parse(localStorage.getItem('wrongQuestions') || '[]');
    let categoryScores = JSON.parse(localStorage.getItem('categoryScores') || '{}');
    let isTimedMode = false;
    let timeLimit = 30; // уДњ
    let timerInterval = null;
    let remainingTime = 0;
    function showQuiz() {
      if (quizIndex === 0) {
        // Т»јтЏът«їтЁесЂФТќ░сЂЌсЂёсЃЕсЃ│сЃђсЃажаєт║ЈсѓњућЪТѕљ
        let shuffledData = shuffle([...quizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          // у░АтЇў№╝џтЪ║ТюгуџёсЂфтю░уљєуЪЦУГўсЂ«тЋЈжАїсѓњтёфтЁѕ
          const easyKeywords = ['ждќжЃй', 'СИђуЋфжЮбуЕЇсЂїт║ЃсЂё', 'СИђуЋфС║║тЈБсЂїтцџсЂё', 'СИђуЋфжФўсЂёт▒▒', 'СИђуЋфжЋисЂётиЮ', 'СИђуЋфтцДсЂЇсЂёТ╣ќ', 'СИЅТЎ»', 'т»їтБФт▒▒', 'тїЌТхижЂЊ', 'ТЮ▒С║г', 'тцДжўф'];
          const easyQuestions = shuffledData.filter(q => easyKeywords.some(keyword => q.question.includes(keyword) || q.choices.some(choice => choice.includes(keyword))));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          // жЏБсЂЌсЂё№╝џсѓѕсѓітЁиСйЊуџёсЂДУЕ│у┤░сЂфуЪЦУГўсЂїт┐ЁУдЂсЂфтЋЈжАї
          const hardKeywords = ['уЅ╣ућБ', 'уюїт║ЂТЅђтюетю░', 'Тќ╣Уеђ', 'уЦГсѓі', 'жЃитюЪТќЎуљє', 'тиЦТЦГ', 'УЙ▓ТЦГ', 'Т╝ЂТЦГ', 'ТИЕТ│Ѕ'];
          const hardQuestions = shuffledData.filter(q => hardKeywords.some(keyword => q.question.includes(keyword)));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        // тЋЈжАїТЋ░УеГт«џсѓњжЂЕуће
        const questionNum = Math.min(questionCount, shuffledData.length);
        
        // жЂИТіъУѓбсѓѓсЃЕсЃ│сЃђсЃасЂФСИдсЂ│ТЏ┐сЂѕ
        quizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        quizScore = 0;
      }
      if (quizIndex >= quizQuestions.length) {
        saveScore('quiz', quizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>сѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${quizScore} / ${quizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        quizIndex = 0;
        return;
      }
      const q = quizQuestions[quizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">угг${quizIndex + 1}тЋЈ</h2><div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div><form id="quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="quiz-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) quizScore++;
        quizIndex++;
        setTimeout(showQuiz, 1200);
      };
      applyMenuBtnColors && applyMenuBtnColors();
    }

    // уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║
    let prefecturesQuizIndex = 0;
    let prefecturesQuizScore = 0;
    let prefecturesQuizQuestions = [];
    function showPrefecturesQuiz() {
      if (prefecturesQuizIndex === 0) {
        let shuffledData = shuffle([...prefecturesQuizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          const easyPrefectures = ['ТЮ▒С║г', 'тцДжўф', 'тїЌТхижЂЊ', 'уЦътЦѕтиЮ', 'ТёЏуЪЦ', 'тЪ╝ујЅ', 'тЇЃУЉЅ', 'тЁхт║Ф', 'удЈт▓А', 'С║гжЃй'];
          const easyQuestions = shuffledData.filter(q => easyPrefectures.some(pref => q.question.includes(pref)));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          const hardPrefectures = ['ж│ЦтЈќ', 'т│ХТа╣', 'тЙ│т│Х', 'жФўуЪЦ', 'СйљУ│ђ', 'удЈС║Ћ', 'т▒▒Тбе', 'тњїТГїт▒▒', 'ж╣┐тЁљт│Х', 'т««т┤ј'];
          const hardQuestions = shuffledData.filter(q => hardPrefectures.some(pref => q.question.includes(pref)));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        const questionNum = Math.min(questionCount, shuffledData.length);
        prefecturesQuizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        prefecturesQuizScore = 0;
      }
      if (prefecturesQuizIndex >= prefecturesQuizQuestions.length) {
        saveScore('prefectures', prefecturesQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${prefecturesQuizScore} / ${prefecturesQuizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        prefecturesQuizIndex = 0;
        return;
      }
      const q = prefecturesQuizQuestions[prefecturesQuizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">­ЪЈЏ№ИЈ уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║ угг${prefecturesQuizIndex + 1}тЋЈ</h2><div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div><form id="prefectures-quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="prefectures-quiz-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('prefectures-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('prefectures-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) prefecturesQuizScore++;
        prefecturesQuizIndex++;
        setTimeout(showPrefecturesQuiz, 1200);
      };
    }

    // т▒▒тю░т▒▒Уёѕсѓ»сѓцсѓ║
    let mountainsQuizIndex = 0;
    let mountainsQuizScore = 0;
    let mountainsQuizQuestions = [];
    function showMountainsQuiz() {
      if (mountainsQuizIndex === 0) {
        let shuffledData = shuffle([...mountainsQuizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          const easyMountains = ['т»їтБФт▒▒', 'тїЌсѓбсЃФсЃЌсѓ╣', 'тЇЌсѓбсЃФсЃЌсѓ╣', 'СИГтц«сѓбсЃФсЃЌсѓ╣', 'жў┐УўЄт▒▒', 'жюДт│Хт▒▒'];
          const easyQuestions = shuffledData.filter(q => easyMountains.some(mountain => q.question.includes(mountain) || q.choices.some(choice => choice.includes(mountain))));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          const hardMountains = ['тцДжЏфт▒▒', 'уЎйт▒▒', 'тЅБт▒▒', 'уЪ│жјџт▒▒', 'С╣ЮжЄЇт▒▒', 'уГЉТ│бт▒▒'];
          const hardQuestions = shuffledData.filter(q => hardMountains.some(mountain => q.question.includes(mountain) || q.choices.some(choice => choice.includes(mountain))));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        const questionNum = Math.min(questionCount, shuffledData.length);
        mountainsQuizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        mountainsQuizScore = 0;
      }
      if (mountainsQuizIndex >= mountainsQuizQuestions.length) {
        saveScore('mountains', mountainsQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>т▒▒тю░сЃ╗т▒▒Уёѕсѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${mountainsQuizScore} / ${mountainsQuizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        mountainsQuizIndex = 0;
        return;
      }
      const q = mountainsQuizQuestions[mountainsQuizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЏ░№ИЈ т▒▒тю░сЃ╗т▒▒Уёѕсѓ»сѓцсѓ║ угг${mountainsQuizIndex + 1}тЋЈ</h2><div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div><form id="mountains-quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="mountains-quiz-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('mountains-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('mountains-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) mountainsQuizScore++;
        mountainsQuizIndex++;
        setTimeout(showMountainsQuiz, 1200);
      };
    }

    // тиЮсѓ»сѓцсѓ║
    let riversQuizIndex = 0;
    let riversQuizScore = 0;
    let riversQuizQuestions = [];
    function showRiversQuiz() {
      if (riversQuizIndex === 0) {
        let shuffledData = shuffle([...riversQuizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          const easyRivers = ['С┐АТ┐ЃтиЮ', 'тѕЕТа╣тиЮ', 'уЪ│уІЕтиЮ', 'тїЌСИітиЮ', 'жў┐ТГджџѕтиЮ', 'ТюђСИітиЮ'];
          const easyQuestions = shuffledData.filter(q => easyRivers.some(river => q.question.includes(river) || q.choices.some(choice => choice.includes(river))));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          const hardRivers = ['жЏёуЅЕтиЮ', 'у▒│С╗БтиЮ', 'тГљтљЅтиЮ', 'УхцтиЮ', 'т░ЈуЪбжЃетиЮ', 'ТЅІтЈќтиЮ'];
          const hardQuestions = shuffledData.filter(q => hardRivers.some(river => q.question.includes(river) || q.choices.some(choice => choice.includes(river))));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        const questionNum = Math.min(questionCount, shuffledData.length);
        riversQuizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        riversQuizScore = 0;
      }
      if (riversQuizIndex >= riversQuizQuestions.length) {
        saveScore('rivers', riversQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>тиЮсѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${riversQuizScore} / ${riversQuizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        riversQuizIndex = 0;
        return;
      }
      const q = riversQuizQuestions[riversQuizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">­ЪЈъ№ИЈ тиЮсѓ»сѓцсѓ║ угг${riversQuizIndex + 1}тЋЈ</h2><div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div><form id="rivers-quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="rivers-quiz-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('rivers-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('rivers-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) riversQuizScore++;
        riversQuizIndex++;
        setTimeout(showRiversQuiz, 1200);
      };
    }

    // т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║
    let plainsQuizIndex = 0;
    let plainsQuizScore = 0;
    let plainsQuizQuestions = [];
    function showPlainsQuiz() {
      if (plainsQuizIndex === 0) {
        let shuffledData = shuffle([...plainsQuizData]);
        
        // жЏБТўЊт║дсЂФт┐юсЂўсЂдтЋЈжАїсѓњухъсѓіУЙ╝сЂ┐
        if (gameDifficulty === 'easy') {
          const easyPlains = ['жќбТЮ▒т╣│жЄј', 'Т┐Ѓт░Йт╣│жЄј', 'тцДжўфт╣│жЄј', 'уГЉу┤Фт╣│жЄј', 'уЪ│уІЕт╣│жЄј', 'С╗ЎтЈ░т╣│жЄј'];
          const easyQuestions = shuffledData.filter(q => easyPlains.some(plain => q.question.includes(plain) || q.choices.some(choice => choice.includes(plain))));
          shuffledData = easyQuestions.length >= questionCount ? easyQuestions : shuffledData;
        } else if (gameDifficulty === 'hard') {
          const hardPlains = ['Т┤ЦУ╗йт╣│жЄј', 'т║ётєЁт╣│жЄј', 'С╝џТ┤ЦуЏєтю░', 'ућ▓т║юуЏєтю░', 'ТЮЙТюгуЏєтю░', 'жБЏжеежФўтю░'];
          const hardQuestions = shuffledData.filter(q => hardPlains.some(plain => q.question.includes(plain) || q.choices.some(choice => choice.includes(plain))));
          shuffledData = hardQuestions.length >= questionCount ? hardQuestions : shuffledData;
        }
        
        const questionNum = Math.min(questionCount, shuffledData.length);
        plainsQuizQuestions = shuffledData.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        plainsQuizScore = 0;
      }
      if (plainsQuizIndex >= plainsQuizQuestions.length) {
        saveScore('plains', plainsQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${plainsQuizScore} / ${plainsQuizQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('back-btn').onclick = showTopMenu;
        plainsQuizIndex = 0;
        return;
      }
      const q = plainsQuizQuestions[plainsQuizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">­ЪЈћ№ИЈ т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║ угг${plainsQuizIndex + 1}тЋЈ</h2><div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div><form id="plains-quiz-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="plains-quiz-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      document.getElementById('plains-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('plains-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) plainsQuizScore++;
        plainsQuizIndex++;
        setTimeout(showPlainsQuiz, 1200);
      };
    }

    // СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФ
    let sortIndex = 0;
    let sortScore = 0;
    let sortCurrent = [];
    let sortQuestions = [];
    function showSortPuzzle() {
      if (sortIndex === 0) {
        // Т»јтЏът«їтЁесЂФТќ░сЂЌсЂёсЃЕсЃ│сЃђсЃажаєт║ЈсѓњућЪТѕљ
        sortQuestions = shuffle([...sortData]).slice(0, 10);
        sortScore = 0;
      }
      if (sortIndex >= sortQuestions.length) {
        saveScore('sort', sortScore);
        document.getElementById('main-area').innerHTML =
          `<h2>СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФухѓС║є№╝Ђ</h2><div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${sortScore} / ${sortQuestions.length}</b> сЂДсЂЎ</div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        document.getElementById('score-area').textContent = '';
        document.getElementById('back-btn').onclick = showTopMenu;
        sortIndex = 0;
        return;
      }
      sortCurrent = shuffle([...sortQuestions[sortIndex]]);
      let html = `<h2>угг${sortIndex + 1}тЋЈ№╝џС║ћтЇЂжЪ│жаєсЂФСИдсЂ╣ТЏ┐сЂѕсѓѕ</h2><ul id="sort-list" style="list-style:none;padding:0;">`;
      sortCurrent.forEach((item, idx) => {
        html += `<li data-idx="${idx}" style="margin:8px 0;">
          <span>${item}</span>
          <button onclick="moveUp(${idx})">РєЉ</button>
          <button onclick="moveDown(${idx})">РєЊ</button>
        </li>`;
      });
      html += '</ul>';
      html += '<button onclick="checkSortAnswer()">уГћсЂѕтљѕсѓЈсЂЏ</button>';
      html += '<button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>';
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      applyMenuBtnColors();
    }
    window.moveUp = function(idx) {
      if (idx === 0) return;
      [sortCurrent[idx - 1], sortCurrent[idx]] = [sortCurrent[idx], sortCurrent[idx - 1]];
      showSortPuzzle();
    };
    window.moveDown = function(idx) {
      if (idx === sortCurrent.length - 1) return;
      [sortCurrent[idx + 1], sortCurrent[idx]] = [sortCurrent[idx], sortCurrent[idx + 1]];
      showSortPuzzle();
    };
    window.checkSortAnswer = function() {
      const correct = [...sortCurrent].join() === [...sortCurrent].sort().join();
      const correctOrder = [...sortCurrent].sort().join(' Рєњ ');
      
      if (correct) {
        sortScore++;
        playSE('se-correct');
        // уГћсЂѕсѓњСИГтц«сЂФУАеуц║
        const resultDiv = document.createElement('div');
        resultDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:24px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:1000;';
        resultDiv.innerHTML = '<h2 style="color:green;text-align:center;">ТГБУДБ№╝Ђ</h2>';
        document.body.appendChild(resultDiv);
        setTimeout(() => resultDiv.remove(), 1500);
      } else {
        playSE('se-wrong');
        // уГћсЂѕсѓњСИГтц«сЂФУАеуц║
        const resultDiv = document.createElement('div');
        resultDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:24px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.3);max-width:80%;z-index:1000;';
        resultDiv.innerHTML = `<h2 style="color:red;text-align:center;">СИЇТГБУДБ</h2><div style="margin-top:16px;"><b>ТГБУДБ№╝џ</b><br>${correctOrder}</div>`;
        document.body.appendChild(resultDiv);
        setTimeout(() => resultDiv.remove(), 2000);
      }
      
      setTimeout(() => {
        sortIndex++;
        showSortPuzzle();
      }, 2000);
    };

    // сѓ┐сѓцсЃасѓбсѓ┐сЃЃсѓ»
    let timeIndex = 0;
    let timeScore = 0;
    let timeLeft = 60;
    let timeTimer = null;
    let timeQuestions = [];
    function showTimeAttack() {
      if (timeIndex === 0) {
        timeQuestions = shuffle([...quizData]);
        timeLeft = 60;
        timeScore = 0;
        if (timeTimer) clearInterval(timeTimer);
        timeTimer = setInterval(() => {
          timeLeft--;
          document.getElementById('score-area').textContent = `Т«ІсѓіТЎѓжќЊ: ${timeLeft}уДњ | сѓ╣сѓ│сѓб: ${timeScore}`;
          if (timeLeft <= 0) {
            clearInterval(timeTimer);
            saveScore('timeattack', timeScore);
            document.getElementById('main-area').innerHTML = `<h2>сѓ┐сѓцсЃасѓбсѓ┐сЃЃсѓ»ухѓС║є№╝Ђ</h2><p>сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${timeScore} / ${timeQuestions.length}</b> сЂДсЂЎсђѓ</p><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
            updateTotalScore();
            document.getElementById('back-btn').onclick = function() {
              timeIndex = 0;
              showTopMenu();
            };
          }
        }, 1000);
      }
      if (timeIndex >= timeQuestions.length || timeLeft <= 0) {
        return;
      }
      const q = timeQuestions[timeIndex];
      let html = `<h2>угг${timeIndex + 1}тЋЈ</h2><div>${q.question}</div><form id="time-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label><input type="radio" name="choice" value="${i}"> ${choice}</label><br>`;
      });
      html += `<button type="submit">тЏъуГћ</button></form><div id="time-feedback"></div>`;
      html += '<button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>';
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('score-area').textContent = `Т«ІсѓіТЎѓжќЊ: ${timeLeft}уДњ | сѓ╣сѓ│сѓб: ${timeScore}`;
      document.getElementById('back-btn').onclick = function() {
        if (timeTimer) {
          clearInterval(timeTimer);
          timeTimer = null;
        }
        timeIndex = 0;
        document.getElementById('score-area').textContent = '';
        showTopMenu();
      };
      applyMenuBtnColors();
      document.getElementById('time-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        document.getElementById('time-feedback').innerHTML =
          isCorrect ? '<span style="color:green;">ТГБУДБ№╝Ђ</span>' : `<span style="color:red;">СИЇТГБУДБсђѓТГБУДБсЂ» ${q.choices[q.answer]} сЂДсЂЎсђѓ</span>`;
        if (isCorrect) timeScore++;
        timeIndex++;
        setTimeout(showTimeAttack, 1000);
      };
    }

    // тю░тЏ│сЃЉсѓ║сЃФ№╝ѕ47жЃйжЂЊт║юуюї№╝Ѕ
    const mapPuzzlePieces = [
      { id: 'hokkaido', label: 'тїЌТхижЂЊ', x: 350, y: 50, w: 80, h: 60 },
      { id: 'aomori', label: 'жЮњТБ«уюї', x: 340, y: 130, w: 40, h: 40 },
      { id: 'iwate', label: 'т▓ЕТЅІуюї', x: 350, y: 170, w: 40, h: 50 },
      { id: 'miyagi', label: 'т««тЪјуюї', x: 340, y: 220, w: 40, h: 40 },
      { id: 'akita', label: 'уДІућ░уюї', x: 330, y: 170, w: 40, h: 50 },
      { id: 'yamagata', label: 'т▒▒тйбуюї', x: 320, y: 220, w: 40, h: 40 },
      { id: 'fukushima', label: 'удЈт│Хуюї', x: 330, y: 260, w: 50, h: 40 },
      { id: 'ibaraki', label: 'УїетЪјуюї', x: 340, y: 300, w: 40, h: 40 },
      { id: 'tochigi', label: 'ТаЃТюеуюї', x: 320, y: 300, w: 40, h: 30 },
      { id: 'gunma', label: 'уЙцждгуюї', x: 300, y: 300, w: 40, h: 30 },
      { id: 'saitama', label: 'тЪ╝ујЅуюї', x: 320, y: 330, w: 40, h: 30 },
      { id: 'chiba', label: 'тЇЃУЉЅуюї', x: 350, y: 340, w: 40, h: 40 },
      { id: 'tokyo', label: 'ТЮ▒С║гжЃй', x: 320, y: 360, w: 30, h: 30 },
      { id: 'kanagawa', label: 'уЦътЦѕтиЮуюї', x: 310, y: 380, w: 40, h: 30 },
      { id: 'niigata', label: 'Тќ░ТйЪуюї', x: 300, y: 240, w: 50, h: 50 },
      { id: 'toyama', label: 'т»їт▒▒уюї', x: 280, y: 280, w: 40, h: 30 },
      { id: 'ishikawa', label: 'уЪ│тиЮуюї', x: 260, y: 280, w: 40, h: 40 },
      { id: 'fukui', label: 'удЈС║Ћуюї', x: 250, y: 320, w: 40, h: 30 },
      { id: 'yamanashi', label: 'т▒▒Тбеуюї', x: 290, y: 350, w: 40, h: 30 },
      { id: 'nagano', label: 'жЋижЄјуюї', x: 280, y: 320, w: 40, h: 40 },
      { id: 'gifu', label: 'т▓љжўюуюї', x: 260, y: 340, w: 40, h: 40 },
      { id: 'shizuoka', label: 'жЮЎт▓Ауюї', x: 280, y: 380, w: 50, h: 30 },
      { id: 'aichi', label: 'ТёЏуЪЦуюї', x: 260, y: 380, w: 40, h: 30 },
      { id: 'mie', label: 'СИЅжЄЇуюї', x: 240, y: 380, w: 40, h: 40 },
      { id: 'shiga', label: 'Т╗ІУ│ђуюї', x: 230, y: 360, w: 30, h: 30 },
      { id: 'kyoto', label: 'С║гжЃйт║ю', x: 220, y: 340, w: 40, h: 40 },
      { id: 'osaka', label: 'тцДжўфт║ю', x: 220, y: 380, w: 30, h: 30 },
      { id: 'hyogo', label: 'тЁхт║Фуюї', x: 200, y: 360, w: 40, h: 40 },
      { id: 'nara', label: 'тЦѕУЅ»уюї', x: 230, y: 400, w: 30, h: 40 },
      { id: 'wakayama', label: 'тњїТГїт▒▒уюї', x: 210, y: 410, w: 40, h: 40 },
      { id: 'tottori', label: 'ж│ЦтЈќуюї', x: 180, y: 340, w: 40, h: 30 },
      { id: 'shimane', label: 'т│ХТа╣уюї', x: 160, y: 340, w: 40, h: 30 },
      { id: 'okayama', label: 'т▓Ат▒▒уюї', x: 180, y: 370, w: 40, h: 30 },
      { id: 'hiroshima', label: 'т║Ѓт│Хуюї', x: 160, y: 370, w: 40, h: 30 },
      { id: 'yamaguchi', label: 'т▒▒тЈБуюї', x: 140, y: 370, w: 40, h: 30 },
      { id: 'tokushima', label: 'тЙ│т│Хуюї', x: 180, y: 410, w: 40, h: 30 },
      { id: 'kagawa', label: 'ждЎтиЮуюї', x: 180, y: 400, w: 40, h: 20 },
      { id: 'ehime', label: 'ТёЏтфЏуюї', x: 160, y: 410, w: 40, h: 30 },
      { id: 'kochi', label: 'жФўуЪЦуюї', x: 160, y: 440, w: 50, h: 30 },
      { id: 'fukuoka', label: 'удЈт▓Ауюї', x: 120, y: 380, w: 40, h: 30 },
      { id: 'saga', label: 'СйљУ│ђуюї', x: 100, y: 390, w: 30, h: 30 },
      { id: 'nagasaki', label: 'жЋит┤јуюї', x: 80, y: 390, w: 40, h: 40 },
      { id: 'kumamoto', label: 'уєіТюгуюї', x: 110, y: 420, w: 40, h: 40 },
      { id: 'oita', label: 'тцДтѕєуюї', x: 130, y: 410, w: 40, h: 30 },
      { id: 'miyazaki', label: 'т««т┤јуюї', x: 130, y: 440, w: 40, h: 40 },
      { id: 'kagoshima', label: 'ж╣┐тЁљт│Хуюї', x: 110, y: 460, w: 40, h: 50 },
      { id: 'okinawa', label: 'Т▓ќуИёуюї', x: 60, y: 480, w: 40, h: 30 }
    ];
    let mapPlaced = {};
    let mapPuzzleMode = 0; // 0: тїЌТЌЦТюг, 1: ТЮ▒ТЌЦТюг, 2: УЦ┐ТЌЦТюг, 3: С╣ЮтиъсЃ╗Т▓ќуИё
    let mapScore = 0;
    let selectedPref = null;
    
    function showMapPuzzle() {
      mapPlaced = {};
      mapScore = 0;
      selectedPref = null;
      let html = `<h2>тю░тЏ│сЃЉсѓ║сЃФ</h2>
        <div class="category-btns">
          <button onclick="setMapMode(0)">тїЌТЌЦТюг</button>
          <button onclick="setMapMode(1)">ТЮ▒ТЌЦТюг</button>
          <button onclick="setMapMode(2)">УЦ┐ТЌЦТюг</button>
          <button onclick="setMapMode(3)">С╣ЮтиъсЃ╗Т▓ќуИё</button>
        </div>
        <div style="margin:16px 0;font-size:1.2em;text-align:center;">сѓ╣сѓ│сѓб: <span id="map-score">0</span> / <span id="map-total">0</span></div>
        <div style="display:flex;gap:20px;justify-content:center;">
          <div style="flex:1;max-width:300px;">
            <h3 style="text-align:center;">жЃйжЂЊт║юуюї</h3>
            <div id="pref-list" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;"></div>
          </div>
          <div style="flex:1;">
            <svg id="japan-map" class="svg-map" width="500" height="550" viewBox="0 0 500 550">`;
      
      mapPuzzlePieces.forEach(piece => {
        html += `<rect class="dropzone" id="drop-${piece.id}" data-pref="${piece.id}" x="${piece.x}" y="${piece.y}" width="${piece.w}" height="${piece.h}" />`;
      });
      
      html += `</svg></div></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button><div id="puzzle-message" style="text-align:center;margin-top:16px;font-weight:bold;"></div>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('back-btn').onclick = showTopMenu;
      setMapMode(0);
    }
    
    window.setMapMode = function(mode) {
      mapPuzzleMode = mode;
      mapPlaced = {};
      mapScore = 0;
      renderMapPuzzlePieces();
      setupMapPuzzleDropzones();
      document.getElementById('puzzle-message').textContent = '';
    };
    
    function getRegionPieces(mode) {
      const regions = [
        ['hokkaido', 'aomori', 'iwate', 'miyagi', 'akita', 'yamagata', 'fukushima'],
        ['ibaraki', 'tochigi', 'gunma', 'saitama', 'chiba', 'tokyo', 'kanagawa', 'niigata', 'toyama', 'ishikawa', 'fukui', 'yamanashi', 'nagano', 'gifu', 'shizuoka', 'aichi'],
        ['mie', 'shiga', 'kyoto', 'osaka', 'hyogo', 'nara', 'wakayama', 'tottori', 'shimane', 'okayama', 'hiroshima', 'yamaguchi', 'tokushima', 'kagawa', 'ehime', 'kochi'],
        ['fukuoka', 'saga', 'nagasaki', 'kumamoto', 'oita', 'miyazaki', 'kagoshima', 'okinawa']
      ];
      return mapPuzzlePieces.filter(p => regions[mode].includes(p.id));
    }
    
    function renderMapPuzzlePieces() {
      const area = document.getElementById('pref-list');
      area.innerHTML = '';
      const pieces = getRegionPieces(mapPuzzleMode);
      pieces.forEach(piece => {
        if (!mapPlaced[piece.id]) {
          const btn = document.createElement('button');
          btn.className = 'piece' + (selectedPref === piece.id ? ' selected' : '');
          btn.textContent = piece.label;
          btn.dataset.prefId = piece.id;
          btn.onclick = () => selectPrefecture(piece.id);
          area.appendChild(btn);
        }
      });
      updateMapScore();
    }
    
    function selectPrefecture(prefId) {
      selectedPref = selectedPref === prefId ? null : prefId;
      renderMapPuzzlePieces();
      
      // жЂИТіъсЃюсѓ┐сЃ│сЂ«сЃЈсѓцсЃЕсѓцсЃѕ
      document.querySelectorAll('.piece').forEach(btn => {
        if (btn.dataset.prefId === prefId) {
          btn.classList.add('selected');
        } else {
          btn.classList.remove('selected');
        }
      });
    }
    
    function updateMapScore() {
      const pieces = getRegionPieces(mapPuzzleMode);
      const placed = pieces.filter(p => mapPlaced[p.id]).length;
      mapScore = placed;
      document.getElementById('map-score').textContent = mapScore;
      document.getElementById('map-total').textContent = pieces.length;
    }
    
    function setupMapPuzzleDropzones() {
      const pieces = getRegionPieces(mapPuzzleMode);
      pieces.forEach(piece => {
        const zone = document.getElementById(`drop-${piece.id}`);
        if (!zone) return;
        
        zone.classList.remove('placed', 'active');
        if (mapPlaced[piece.id]) {
          zone.classList.add('placed');
        }
        
        zone.onclick = function() {
          if (selectedPref && selectedPref === piece.id && !mapPlaced[piece.id]) {
            mapPlaced[piece.id] = true;
            zone.classList.add('placed');
            selectedPref = null;
            renderMapPuzzlePieces();
            setupMapPuzzleDropzones();
            checkMapPuzzleClear();
            
            // ТГБУДБжЪ│
            playSE('se-correct');
          } else if (selectedPref && selectedPref !== piece.id && !mapPlaced[piece.id]) {
            // СИЇТГБУДБжЪ│
            playSE('se-wrong');
          }
        };
        
        zone.onmouseover = function() {
          if (selectedPref && !mapPlaced[piece.id]) {
            zone.classList.add('active');
          }
        };
        
        zone.onmouseout = function() {
          zone.classList.remove('active');
        };
      });
    }
    
    function checkMapPuzzleClear() {
      const pieces = getRegionPieces(mapPuzzleMode);
      if (pieces.every(p => mapPlaced[p.id])) {
        const regionNames = ['тїЌТЌЦТюг', 'ТЮ▒ТЌЦТюг', 'УЦ┐ТЌЦТюг', 'С╣ЮтиъсЃ╗Т▓ќуИё'];
        document.getElementById('puzzle-message').textContent = `${regionNames[mapPuzzleMode]}сѓ»сЃфсѓб№╝ЂсЂісѓЂсЂДсЂесЂє№╝Ђ сѓ╣сѓ│сѓб: ${mapScore}`;
        saveScore('map', mapScore);
      } else {
        document.getElementById('puzzle-message').textContent = '';
      }
    }

    // сЃъсѓ╣сѓ│сЃЃсЃѕсѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐
    const mascotQuizData = [
      { name: 'сЂЈсЂЙсЃбсЃ│', emoji: '­Ъљ╗', choices: ['уєіТюгуюї', 'тїЌТхижЂЊ', 'ТёЏтфЏуюї', 'тЪ╝ујЅуюї'], answer: 0 },
      { name: 'сЂхсЂБсЂІсЂАсѓЃсѓЊ', emoji: '­Ъдї', choices: ['тЪ╝ујЅуюї', 'уєіТюгуюї', 'уДІућ░уюї', 'тцДжўфт║ю'], answer: 0 },
      { name: 'сЃљсЃфсѓБсЂЋсѓЊ', emoji: '­ЪљЦ', choices: ['ТёЏтфЏуюї', 'удЈт▓Ауюї', 'жЋижЄјуюї', 'т««тЪјуюї'], answer: 0 },
      { name: 'сЂЏсѓЊсЂесЂЈсѓЊ', emoji: '­Ъдї', choices: ['тЦѕУЅ»уюї', 'С║гжЃйт║ю', 'тцДжўфт║ю', 'тЁхт║Фуюї'], answer: 0 },
      { name: 'сЃЂсЃ╝сЃљсЂЈсѓЊ', emoji: '­ЪљХ', choices: ['тЇЃУЉЅуюї', 'уЦътЦѕтиЮуюї', 'жЮЎт▓Ауюї', 'т▒▒Тбеуюї'], answer: 0 },
      { name: 'сЂљсѓЊсЂЙсЂАсѓЃсѓЊ', emoji: '­Ъљ┤', choices: ['уЙцждгуюї', 'ТаЃТюеуюї', 'УїетЪјуюї', 'тЪ╝ујЅуюї'], answer: 0 },
      { name: 'сЂ▓сЂЊсЂФсѓЃсѓЊ', emoji: '­Ъљ▒', choices: ['Т╗ІУ│ђуюї', 'С║гжЃйт║ю', 'тцДжўфт║ю', 'тЦѕУЅ»уюї'], answer: 0 },
      { name: 'сѓФсЃЉсЃФ', emoji: '­Ъдє', choices: ['тЪ╝ујЅуюї', 'тЇЃУЉЅуюї', 'ТЮ▒С║гжЃй', 'уЦътЦѕтиЮуюї'], answer: 0 },
      { name: 'сЂ┐сЂЇсѓЃсѓЊ', emoji: '­ЪЇі', choices: ['ТёЏтфЏуюї', 'ждЎтиЮуюї', 'тЙ│т│Хуюї', 'жФўуЪЦуюї'], answer: 0 },
      { name: 'сѓбсЃФсѓ»сЃъ', emoji: '­Ъљ╗', choices: ['жЋижЄјуюї', 'Тќ░ТйЪуюї', 'т»їт▒▒уюї', 'уЪ│тиЮуюї'], answer: 0 }
    ];
    let mascotQuizIndex = 0;
    let mascotQuizScore = 0;
    let mascotQuestions = [];
    function showMascotMode() {
      if (mascotQuizIndex === 0) {
        // Т»јтЏът«їтЁесЂФТќ░сЂЌсЂёсЃЕсЃ│сЃђсЃажаєт║ЈсѓњућЪТѕљ
        const shuffledData = shuffle([...mascotQuizData]);
        // жЂИТіъУѓбсѓѓсЃЕсЃ│сЃђсЃасЂФСИдсЂ│ТЏ┐сЂѕ
        mascotQuestions = shuffledData.slice(0, 10).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        mascotQuizScore = 0;
      }
      if (mascotQuizIndex >= mascotQuestions.length) {
        saveScore('mascot', mascotQuizScore);
        document.getElementById('main-area').innerHTML =
          `<h2>сЃъсѓ╣сѓ│сЃЃсЃѕсѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2>
           <div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${mascotQuizScore} / ${mascotQuestions.length}</b> сЂДсЂЎ</div>
           <button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        mascotQuizIndex = 0;
        document.querySelectorAll('#back-btn').forEach(btn => btn.onclick = showTopMenu);
        return;
      }
      const q = mascotQuestions[mascotQuizIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">­Ъјє сЂЊсЂ«сЃъсѓ╣сѓ│сЃЃсЃѕсЂ»сЂЕсЂЊсЂ«уюї№╝Ъ</h2>
        <div style="text-align:center;font-size:3em;margin:20px 0;background:rgba(255,255,255,0.9);border-radius:16px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">${q.emoji}</div>
        <div style="text-align:center;font-size:1.4em;margin-bottom:20px;color:#2c3e50;font-weight:600;text-shadow: 0 1px 1px rgba(0,0,0,0.05);"><b>${q.name}</b></div>
        <form id="mascot-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="mascot-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('mascot-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('mascot-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) mascotQuizScore++;
        mascotQuizIndex++;
        setTimeout(showMascotMode, 1200);
      };
      document.querySelectorAll('#back-btn').forEach(btn => btn.onclick = showTopMenu);
    }

    // Тќ╣УеђсЃбсЃ╝сЃЅ
    let dialectIndex = 0;
    let dialectScore = 0;
    let dialectQuestions = [];
    function showDialectMode() {
      if (dialectIndex === 0) {
        // Т»јтЏът«їтЁесЂФТќ░сЂЌсЂёсЃЕсЃ│сЃђсЃажаєт║ЈсѓњућЪТѕљ
        const shuffledData = shuffle([...dialectQuizData]);
        // жЂИТіъУѓбсѓѓсЃЕсЃ│сЃђсЃасЂФСИдсЂ│ТЏ┐сЂѕ
        dialectQuestions = shuffledData.map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        dialectScore = 0;
      }
      if (dialectIndex >= dialectQuestions.length) {
        saveScore('dialect', dialectScore);
        document.getElementById('main-area').innerHTML =
          `<h2>Тќ╣Уеђсѓ»сѓцсѓ║ухѓС║є№╝Ђ</h2>
           <div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${dialectScore} / ${dialectQuestions.length}</b> сЂДсЂЎ</div>
           <button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
        dialectIndex = 0;
        document.querySelectorAll('#back-btn').forEach(btn => btn.onclick = showTopMenu);
        return;
      }
      const q = dialectQuestions[dialectIndex];
      let html = `<h2 style="color: #2c3e50; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">­ЪЌЙ Тќ╣Уеђсѓ»сѓцсѓ║ угг${dialectIndex + 1}тЋЈ</h2>
        <div style="font-size:1.3em;margin:20px 0;color:#2c3e50;font-weight:500;line-height:1.6;text-shadow: 0 1px 1px rgba(0,0,0,0.05);">${q.question}</div>
        <form id="dialect-form">`;
      q.choices.forEach((choice, i) => {
        html += `<label style="display:block;margin:12px 0;font-size:1.15em;padding:12px 16px;background:rgba(255,255,255,0.8);border:2px solid #e0e6ed;border-radius:8px;cursor:pointer;transition:all 0.2s;color:#2c3e50;font-weight:500;" onmouseover="this.style.background='rgba(79,142,247,0.1)';this.style.borderColor='#4f8ef7';" onmouseout="this.style.background='rgba(255,255,255,0.8)';this.style.borderColor='#e0e6ed';"><input type="radio" name="choice" value="${i}" style="margin-right:12px;"> ${choice}</label>`;
      });
      html += `<button type="submit" style="margin-top:20px;font-size:1.2em;padding:14px 32px;font-weight:600;">тЏъуГћ</button></form><div id="dialect-feedback" style="margin:16px 0;font-size:1.2em;font-weight:600;"></div><button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>`;
      document.getElementById('main-area').innerHTML = html;
      document.getElementById('dialect-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('dialect-feedback').innerHTML =
          isCorrect ? '<span style="color:#28a745;font-weight:bold;font-size:1.3em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РюЁ ТГБУДБ№╝Ђ</span>' : `<span style="color:#dc3545;font-weight:bold;font-size:1.1em;text-shadow: 0 1px 2px rgba(0,0,0,0.1);">РЮї СИЇТГБУДБсђѓТГБУДБсЂ» <strong style="color:#2c3e50;">${q.choices[q.answer]}</strong> сЂДсЂЎсђѓ</span>`;
        if (isCorrect) dialectScore++;
        dialectIndex++;
        setTimeout(showDialectMode, 1200);
      };
      document.querySelectorAll('#back-btn').forEach(btn => btn.onclick = showTopMenu);
    }

    // сЃѕсЃЃсЃЌсЃАсЃІсЃЦсЃ╝тљёсЃюсѓ┐сЃ│сЂ«УЅ▓у«Ауљє
    const menuBtnColors = {
      quiz: '#4f8ef7',
      sort: '#4f8ef7',
      allsort: '#4f8ef7',
      timeattack: '#4f8ef7',
      map: '#4f8ef7',
      mascot: '#4f8ef7',
      dialect: '#4f8ef7',
      prefectures: '#4f8ef7',
      mountains: '#4f8ef7',
      rivers: '#4f8ef7',
      plains: '#4f8ef7'
    };

    function setMenuBtnColor(key, color) {
      menuBtnColors[key] = color;
      showTopMenu();
      showCustomize();
    }
    
    // сѓ▓сЃ╝сЃаУеГт«џжќбТЋ░
    function setDifficulty(level) {
      gameDifficulty = level;
      showSettings();
    }
    
    function setQuestionCount(count) {
      questionCount = count;
      showSettings();
    }
    
    // УеГт«џућ╗жЮбсѓњУАеуц║
    function showSettings() {
      document.getElementById('main-area').innerHTML = `
        <h2>сѓ▓сЃ╝сЃаУеГт«џ</h2>
        <div style="margin:20px 0;">
          <h3>жЏБТўЊт║джЂИТіъ</h3>
          <button onclick="setDifficulty('easy')" style="background:${gameDifficulty === 'easy' ? '#4CAF50' : '#ddd'}; color:${gameDifficulty === 'easy' ? '#fff' : '#333'}">у░АтЇў</button>
          <button onclick="setDifficulty('normal')" style="background:${gameDifficulty === 'normal' ? '#4CAF50' : '#ddd'}; color:${gameDifficulty === 'normal' ? '#fff' : '#333'}">ТЎ«жђџ</button>
          <button onclick="setDifficulty('hard')" style="background:${gameDifficulty === 'hard' ? '#4CAF50' : '#ddd'}; color:${gameDifficulty === 'hard' ? '#fff' : '#333'}">жЏБсЂЌсЂё</button>
        </div>
        <div style="margin:20px 0;">
          <h3>тЋЈжАїТЋ░жЂИТіъ</h3>
          <button onclick="setQuestionCount(5)" style="background:${questionCount === 5 ? '#4CAF50' : '#ddd'}; color:${questionCount === 5 ? '#fff' : '#333'}">5тЋЈ</button>
          <button onclick="setQuestionCount(10)" style="background:${questionCount === 10 ? '#4CAF50' : '#ddd'}; color:${questionCount === 10 ? '#fff' : '#333'}">10тЋЈ</button>
          <button onclick="setQuestionCount(15)" style="background:${questionCount === 15 ? '#4CAF50' : '#ddd'}; color:${questionCount === 15 ? '#fff' : '#333'}">15тЋЈ</button>
        </div>
        <div style="margin:20px 0;">
          <button onclick="showTopMenu()">сЃАсЃІсЃЦсЃ╝сЂФТѕ╗сѓІ</button>
          <button onclick="showCustomize()">сѓФсѓ╣сѓ┐сЃъсѓцсѓ║ућ╗жЮб</button>
          <button onclick="showQuizCreator()">сѓ»сѓцсѓ║СйюТѕљ</button>
          <button onclick="showCustomQuizManager()">сЃъсѓцсѓ»сѓцсѓ║у«Ауљє</button>
        </div>
      `;
    }
    
    // сѓ»сѓцсѓ║СйюТѕљућ╗жЮб
    function showQuizCreator() {
      document.getElementById('main-area').innerHTML = `
        <h2>сѓ»сѓцсѓ║СйюТѕљ</h2>
        <div style="margin:20px 0;">
          <h3>сѓ»сѓцсѓ║сѓ╗сЃЃсЃѕтљЇ</h3>
          <input type="text" id="quiz-title" placeholder="СЙІ: уДЂсЂ«тю░уљєсѓ»сѓцсѓ║" style="width:100%;max-width:400px;padding:8px;font-size:1rem;" />
        </div>
        <div id="questions-container">
          <h3>тЋЈжАї1</h3>
          <div class="question-form">
            <input type="text" id="question-1" placeholder="тЋЈжАїТќЄсѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё" style="width:100%;max-width:400px;padding:8px;margin:8px 0;font-size:1rem;" />
            <div>
              <input type="text" id="choice1-1" placeholder="жЂИТіъУѓб1" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
              <input type="text" id="choice2-1" placeholder="жЂИТіъУѓб2" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
            </div>
            <div>
              <input type="text" id="choice3-1" placeholder="жЂИТіъУѓб3" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
              <input type="text" id="choice4-1" placeholder="жЂИТіъУѓб4" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
            </div>
            <div style="margin:8px 0;">
              <label>ТГБУДБ№╝џ</label>
              <select id="answer-1" style="padding:8px;font-size:1rem;">
                <option value="0">жЂИТіъУѓб1</option>
                <option value="1">жЂИТіъУѓб2</option>
                <option value="2">жЂИТіъУѓб3</option>
                <option value="3">жЂИТіъУѓб4</option>
              </select>
            </div>
          </div>
        </div>
        <div style="margin:20px 0;">
          <button onclick="addQuestion()">тЋЈжАїсѓњУ┐йтіа</button>
          <button onclick="removeLastQuestion()">ТюђтЙїсЂ«тЋЈжАїсѓњтЅіжЎц</button>
        </div>
        <div style="margin:20px 0;">
          <button onclick="saveCustomQuiz()">сѓ»сѓцсѓ║сѓњС┐ЮтГў</button>
          <button onclick="showSettings()">УеГт«џсЂФТѕ╗сѓІ</button>
        </div>
      `;
    }
    
    let questionCounter = 1;
    
    function addQuestion() {
      questionCounter++;
      const container = document.getElementById('questions-container');
      const questionDiv = document.createElement('div');
      questionDiv.innerHTML = `
        <h3>тЋЈжАї${questionCounter}</h3>
        <div class="question-form">
          <input type="text" id="question-${questionCounter}" placeholder="тЋЈжАїТќЄсѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё" style="width:100%;max-width:400px;padding:8px;margin:8px 0;font-size:1rem;" />
          <div>
            <input type="text" id="choice1-${questionCounter}" placeholder="жЂИТіъУѓб1" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
            <input type="text" id="choice2-${questionCounter}" placeholder="жЂИТіъУѓб2" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
          </div>
          <div>
            <input type="text" id="choice3-${questionCounter}" placeholder="жЂИТіъУѓб3" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
            <input type="text" id="choice4-${questionCounter}" placeholder="жЂИТіъУѓб4" style="width:48%;padding:8px;margin:4px 1%;font-size:1rem;" />
          </div>
          <div style="margin:8px 0;">
            <label>ТГБУДБ№╝џ</label>
            <select id="answer-${questionCounter}" style="padding:8px;font-size:1rem;">
              <option value="0">жЂИТіъУѓб1</option>
              <option value="1">жЂИТіъУѓб2</option>
              <option value="2">жЂИТіъУѓб3</option>
              <option value="3">жЂИТіъУѓб4</option>
            </select>
          </div>
        </div>
      `;
      container.appendChild(questionDiv);
    }
    
    function removeLastQuestion() {
      if (questionCounter > 1) {
        const container = document.getElementById('questions-container');
        container.removeChild(container.lastElementChild);
        questionCounter--;
      }
    }
    
    function saveCustomQuiz() {
      const title = document.getElementById('quiz-title').value.trim();
      if (!title) {
        alert('сѓ»сѓцсѓ║сѓ╗сЃЃсЃѕтљЇсѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё');
        return;
      }
      
      const questions = [];
      for (let i = 1; i <= questionCounter; i++) {
        const question = document.getElementById(`question-${i}`)?.value.trim();
        const choice1 = document.getElementById(`choice1-${i}`)?.value.trim();
        const choice2 = document.getElementById(`choice2-${i}`)?.value.trim();
        const choice3 = document.getElementById(`choice3-${i}`)?.value.trim();
        const choice4 = document.getElementById(`choice4-${i}`)?.value.trim();
        const answer = parseInt(document.getElementById(`answer-${i}`)?.value);
        
        if (!question || !choice1 || !choice2 || !choice3 || !choice4) {
          alert(`тЋЈжАї${i}сЂ«тЁЦтіЏсЂїСИЇт«їтЁесЂДсЂЎ`);
          return;
        }
        
        questions.push({
          question: question,
          choices: [choice1, choice2, choice3, choice4],
          answer: answer
        });
      }
      
      const customQuiz = {
        id: Date.now(),
        title: title,
        questions: questions,
        createdAt: new Date().toLocaleDateString()
      };
      
      customQuizzes.push(customQuiz);
      saveCustomQuizzes();
      
      alert(`сђї${title}сђЇсѓњС┐ЮтГўсЂЌсЂЙсЂЌсЂЪ№╝Ђ№╝ѕ${questions.length}тЋЈ№╝Ѕ`);
      questionCounter = 1;
      showCustomQuizManager();
    }
    
    // сѓФсѓ╣сѓ┐сЃасѓ»сѓцсѓ║у«Ауљєућ╗жЮб
    function showCustomQuizManager() {
      let html = `
        <h2>сЃъсѓцсѓ»сѓцсѓ║у«Ауљє</h2>
        <div style="margin:20px 0;">
          <button onclick="showQuizCreator()">Тќ░сЂЌсЂёсѓ»сѓцсѓ║сѓњСйюТѕљ</button>
          <button onclick="showSettings()">УеГт«џсЂФТѕ╗сѓІ</button>
        </div>
      `;
      
      if (customQuizzes.length === 0) {
        html += '<p>сЂЙсЂасѓ»сѓцсѓ║сЂїСйюТѕљсЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊсђѓсђїТќ░сЂЌсЂёсѓ»сѓцсѓ║сѓњСйюТѕљсђЇсЃюсѓ┐сЃ│сЂІсѓЅСйюТѕљсЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ</p>';
      } else {
        html += '<div style="margin:20px 0;">';
        customQuizzes.forEach(quiz => {
          html += `
            <div style="border:1px solid #ddd;border-radius:8px;padding:16px;margin:16px 0;background:white;">
              <h3>${quiz.title}</h3>
              <p>тЋЈжАїТЋ░: ${quiz.questions.length}тЋЈ | СйюТѕљТЌЦ: ${quiz.createdAt}</p>
              <div>
                <button onclick="playCustomQuiz(${quiz.id})" style="background:#4CAF50;">сЃЌсЃгсѓц</button>
                <button onclick="editCustomQuiz(${quiz.id})" style="background:#FF9800;">уиежЏє</button>
                <button onclick="deleteCustomQuiz(${quiz.id})" style="background:#F44336;">тЅіжЎц</button>
              </div>
            </div>
          `;
        });
        html += '</div>';
      }
      
      document.getElementById('main-area').innerHTML = html;
    }
    
    function playCustomQuiz(quizId) {
      currentCustomQuiz = customQuizzes.find(q => q.id === quizId);
      if (!currentCustomQuiz) {
        alert('сѓ»сѓцсѓ║сЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊ');
        return;
      }
      customQuizIndex = 0;
      customQuizScore = 0;
      showCustomQuiz();
    }
    
    function editCustomQuiz(quizId) {
      const quiz = customQuizzes.find(q => q.id === quizId);
      if (!quiz) {
        alert('сѓ»сѓцсѓ║сЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊ');
        return;
      }
      
      // уиежЏєућ╗жЮбсѓњУАеуц║№╝ѕСйюТѕљућ╗жЮбсѓњТхЂуће№╝Ѕ
      showQuizCreator();
      
      // сЃЄсЃ╝сѓ┐сѓњтЁЦтіЏсЃЋсѓБсЃ╝сЃФсЃЅсЂФУеГт«џ
      setTimeout(() => {
        document.getElementById('quiz-title').value = quiz.title;
        
        // ТЌбтГўсЂ«тЋЈжАїТЋ░сЂФтљѕсѓЈсЂЏсЂдтЋЈжАїсЃЋсѓБсЃ╝сЃФсЃЅсѓњУ┐йтіа
        while (questionCounter < quiz.questions.length) {
          addQuestion();
        }
        
        // тљётЋЈжАїсЂ«сЃЄсЃ╝сѓ┐сѓњУеГт«џ
        quiz.questions.forEach((q, index) => {
          const i = index + 1;
          document.getElementById(`question-${i}`).value = q.question;
          document.getElementById(`choice1-${i}`).value = q.choices[0];
          document.getElementById(`choice2-${i}`).value = q.choices[1];
          document.getElementById(`choice3-${i}`).value = q.choices[2];
          document.getElementById(`choice4-${i}`).value = q.choices[3];
          document.getElementById(`answer-${i}`).value = q.answer;
        });
        
        // С┐ЮтГўсЃюсѓ┐сЃ│сѓњуиежЏєућесЂФтцЅТЏ┤
        document.querySelector('button[onclick="saveCustomQuiz()"]').onclick = () => updateCustomQuiz(quizId);
        document.querySelector('button[onclick="saveCustomQuiz()"]').textContent = 'сѓ»сѓцсѓ║сѓњТЏ┤Тќ░';
      }, 100);
    }
    
    function updateCustomQuiz(quizId) {
      const title = document.getElementById('quiz-title').value.trim();
      if (!title) {
        alert('сѓ»сѓцсѓ║сѓ╗сЃЃсЃѕтљЇсѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё');
        return;
      }
      
      const questions = [];
      for (let i = 1; i <= questionCounter; i++) {
        const question = document.getElementById(`question-${i}`)?.value.trim();
        const choice1 = document.getElementById(`choice1-${i}`)?.value.trim();
        const choice2 = document.getElementById(`choice2-${i}`)?.value.trim();
        const choice3 = document.getElementById(`choice3-${i}`)?.value.trim();
        const choice4 = document.getElementById(`choice4-${i}`)?.value.trim();
        const answer = parseInt(document.getElementById(`answer-${i}`)?.value);
        
        if (!question || !choice1 || !choice2 || !choice3 || !choice4) {
          alert(`тЋЈжАї${i}сЂ«тЁЦтіЏсЂїСИЇт«їтЁесЂДсЂЎ`);
          return;
        }
        
        questions.push({
          question: question,
          choices: [choice1, choice2, choice3, choice4],
          answer: answer
        });
      }
      
      const quizIndex = customQuizzes.findIndex(q => q.id === quizId);
      if (quizIndex !== -1) {
        customQuizzes[quizIndex].title = title;
        customQuizzes[quizIndex].questions = questions;
        saveCustomQuizzes();
        
        alert(`сђї${title}сђЇсѓњТЏ┤Тќ░сЂЌсЂЙсЂЌсЂЪ№╝Ђ№╝ѕ${questions.length}тЋЈ№╝Ѕ`);
        questionCounter = 1;
        showCustomQuizManager();
      }
    }
    
    function deleteCustomQuiz(quizId) {
      const quiz = customQuizzes.find(q => q.id === quizId);
      if (!quiz) {
        alert('сѓ»сѓцсѓ║сЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊ');
        return;
      }
      
      if (confirm(`сђї${quiz.title}сђЇсѓњтЅіжЎцсЂЌсЂЙсЂЎсЂІ№╝ЪсЂЊсЂ«ТЊЇСйюсЂ»тЈќсѓіТХѕсЂЏсЂЙсЂЏсѓЊсђѓ`)) {
        customQuizzes = customQuizzes.filter(q => q.id !== quizId);
        saveCustomQuizzes();
        showCustomQuizManager();
        alert('сѓ»сѓцсѓ║сѓњтЅіжЎцсЂЌсЂЙсЂЌсЂЪ');
      }
    }
    
    // сѓФсѓ╣сѓ┐сЃасѓ»сѓцсѓ║сЃЌсЃгсѓцТЕЪУЃй
    function showCustomQuiz() {
      if (!currentCustomQuiz) {
        alert('сѓ»сѓцсѓ║сЃЄсЃ╝сѓ┐сЂїсЂѓсѓісЂЙсЂЏсѓЊ');
        showCustomQuizManager();
        return;
      }
      
      if (customQuizIndex === 0) {
        // сѓ»сѓцсѓ║жќІтДІТЎѓсЂФтЋЈжАїсѓњсѓисЃБсЃЃсЃЋсЃФ
        let shuffledQuestions = shuffle([...currentCustomQuiz.questions]);
        const questionNum = Math.min(questionCount, shuffledQuestions.length);
        
        customQuizQuestions = shuffledQuestions.slice(0, questionNum).map(q => {
          const shuffledChoices = shuffle([...q.choices]);
          const newAnswer = shuffledChoices.indexOf(q.choices[q.answer]);
          return { ...q, choices: shuffledChoices, answer: newAnswer };
        });
        customQuizScore = 0;
      }
      
      if (customQuizIndex >= customQuizQuestions.length) {
        // сѓ»сѓцсѓ║ухѓС║є
        document.getElementById('main-area').innerHTML =
          `<h2>сђї${currentCustomQuiz.title}сђЇухѓС║є№╝Ђ</h2>
           <div class="score">сЂѓсЂфсЂЪсЂ«сѓ╣сѓ│сѓбсЂ» <b>${customQuizScore} / ${customQuizQuestions.length}</b> сЂДсЂЎ</div>
           <button onclick="showCustomQuizManager()">сЃъсѓцсѓ»сѓцсѓ║у«АуљєсЂФТѕ╗сѓІ</button>`;
        customQuizIndex = 0;
        return;
      }
      
      const q = customQuizQuestions[customQuizIndex];
      document.getElementById('main-area').innerHTML = `
        <h2>сђї${currentCustomQuiz.title}сђЇ</h2>
        <div class="question">тЋЈжАї ${customQuizIndex + 1}/${customQuizQuestions.length}</div>
        <div class="question">${q.question}</div>
        <form id="custom-quiz-form">
          <div class="choices">
            ${q.choices.map((choice, i) => `
              <div class="choice">
                <label>
                  <input type="radio" name="choice" value="${i}">
                  ${choice}
                </label>
              </div>
            `).join('')}
          </div>
          <button type="submit">тЏъуГћ</button>
        </form>
        <div id="custom-quiz-feedback" class="feedback"></div>
        <button id="back-btn" onclick="showCustomQuizManager()">сЃъсѓцсѓ»сѓцсѓ║у«АуљєсЂФТѕ╗сѓІ</button>
      `;
      
      document.getElementById('custom-quiz-form').onsubmit = function(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="choice"]:checked');
        if (!selected) return;
        const isCorrect = Number(selected.value) === q.answer;
        playSE(isCorrect ? 'se-correct' : 'se-wrong');
        document.getElementById('custom-quiz-feedback').innerHTML =
          isCorrect ? '<span style="color:green;">ТГБУДБ№╝Ђ</span>' : `<span style="color:red;">СИЇТГБУДБсђѓТГБУДБсЂ» ${q.choices[q.answer]} сЂДсЂЎсђѓ</span>`;
        if (isCorrect) customQuizScore++;
        customQuizIndex++;
        setTimeout(showCustomQuiz, 1200);
      };
    }

    function setBgPattern(type, color) {
      if (type === 'plain') {
        document.body.style.background = color;
        document.body.style.backgroundImage = '';
      } else if (type === 'gradient1') {
        document.body.style.background = '';
        document.body.style.backgroundImage = 'linear-gradient(135deg, #4f8ef7 0%, #FF9800 50%, #4CAF50 100%)';
      } else if (type === 'gradient2') {
        document.body.style.background = '';
        document.body.style.backgroundImage = 'linear-gradient(135deg, #E91E63 0%, #9C27B0 50%, #4f8ef7 100%)';
      } else if (type === 'stripes') {
        document.body.style.background = '';
        document.body.style.backgroundImage = 'repeating-linear-gradient(45deg, #eaf2ff, #eaf2ff 20px, #f8f8ff 20px, #f8f8ff 40px)';
      } else if (type === 'dots') {
        document.body.style.background = '';
        document.body.style.backgroundImage = 'radial-gradient(#eaf2ff 2px, transparent 2px), radial-gradient(#eaf2ff 2px, #f8f8ff 2px)';
        document.body.style.backgroundSize = '20px 20px';
        document.body.style.backgroundPosition = '0 0, 10px 10px';
      }
      // ТќЄтГЌУЅ▓сЂ»тИИсЂФж╗њ
      document.body.style.color = '#222';
      document.getElementById('main-area').style.color = '#222';
      document.getElementById('score-area').style.color = '#222';
      document.querySelectorAll('#main-area, #main-area *').forEach(el => {
        if (el.tagName === 'LABEL' || el.tagName === 'H2' || el.tagName === 'DIV' || el.tagName === 'SPAN') {
          el.style.color = '#222';
        }
      });
    }

    // BGMТЏ▓сЃфсѓ╣сЃѕ
    const bgmList = [
      'Glass_City_Glow.mp3',
      'Lemon_Days.mp3', 
      'Tears_in_the_Quiet_Rain.mp3',
      'The_clearest_soda_in_the_world.mp3',
      'Afternoon_Meandering.mp3'
    ];
    let currentBgmIndex = 0;

    function playBGM() {
      const audio = document.getElementById('bgm');
      if (audio) {
        // сЃЕсЃ│сЃђсЃасЂфТЏ▓сѓњжЂИТіъ
        currentBgmIndex = Math.floor(Math.random() * bgmList.length);
        audio.src = bgmList[currentBgmIndex];
        audio.volume = 0.3;
        audio.play().catch(e => {
          console.log('BGMсЃЋсѓАсѓцсЃФсЂїтГўтюесЂЌсЂфсЂёсЂІсђЂтєЇућЪсЂДсЂЇсЂЙсЂЏсѓЊ:', e);
          alert('BGMсЃЋсѓАсѓцсЃФсЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊсђѓсЃЋсѓАсѓцсЃФсѓњсЃђсѓдсЃ│сЃГсЃ╝сЃЅсЃЋсѓЕсЃФсЃђсЂІсѓЅсѓ│сЃћсЃ╝сЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ');
        });
      } else {
        alert('BGMсЃЋсѓАсѓцсЃФсЂїУеГт«џсЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊ');
      }
    }

    function pauseBGM() {
      const audio = document.getElementById('bgm');
      if (audio) {
        audio.pause();
      }
    }

    // сѓФсѓ╣сѓ┐сЃъсѓцсѓ║сЃюсѓ┐сЃ│
    function showCustomize() {
      document.getElementById('main-area').innerHTML = `
        <h2>сѓФсѓ╣сѓ┐сЃъсѓцсѓ║ућ╗жЮб</h2>
        <div style="margin:16px 0;">УЃїТЎ»№╝џ
          <button onclick="setBgPattern('plain', '#f8f8ff')">уЎй</button>
          <button onclick="setBgPattern('plain', '#222')">ж╗њ</button>
          <button onclick="setBgPattern('plain', '#eaf2ff')">Т░┤УЅ▓</button>
          <button onclick="setBgPattern('gradient1')">сЃќсЃФсЃ╝РєњсѓфсЃгсЃ│сѓИРєњсѓ░сЃфсЃ╝сЃ│</button>
          <button onclick="setBgPattern('gradient2')">сЃћсЃ│сѓ»Рєњу┤ФРєњжЮњ</button>
          <button onclick="setBgPattern('stripes')">сѓ╣сЃѕсЃЕсѓцсЃЌ</button>
          <button onclick="setBgPattern('dots')">сЃЅсЃЃсЃѕ</button>
        </div>
        <div style="margin:16px 0;">сЃюсѓ┐сЃ│УЅ▓№╝џ
          <div>сѓ»сѓцсѓ║:
            <button onclick="setMenuBtnColor('quiz', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('quiz', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('quiz', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('quiz', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('quiz', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('quiz', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('quiz', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('quiz', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФ:
            <button onclick="setMenuBtnColor('sort', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('sort', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('sort', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('sort', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('sort', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('sort', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('sort', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('sort', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>тЁежЃйжЂЊт║юуюїСИдсЂ╣ТЏ┐сЂѕ:
            <button onclick="setMenuBtnColor('allsort', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('allsort', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('allsort', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('allsort', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('allsort', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('allsort', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('allsort', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('allsort', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>сѓ┐сѓцсЃасѓбсѓ┐сЃЃсѓ»:
            <button onclick="setMenuBtnColor('timeattack', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('timeattack', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('timeattack', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('timeattack', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('timeattack', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('timeattack', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('timeattack', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('timeattack', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>тю░тЏ│сЃЉсѓ║сЃФ:
            <button onclick="setMenuBtnColor('map', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('map', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('map', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('map', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('map', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('map', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('map', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('map', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>Тќ╣УеђсЃбсЃ╝сЃЅ:
            <button onclick="setMenuBtnColor('dialect', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('dialect', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('dialect', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('dialect', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('dialect', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('dialect', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('dialect', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('dialect', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>сЃъсѓ╣сѓ│сЃЃсЃѕсЃбсЃ╝сЃЅ:
            <button onclick="setMenuBtnColor('mascot', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
            <button onclick="setMenuBtnColor('mascot', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('mascot', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('mascot', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('mascot', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('mascot', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('mascot', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('mascot', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║:
            <button onclick="setMenuBtnColor('prefectures', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
            <button onclick="setMenuBtnColor('prefectures', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('prefectures', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('prefectures', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('prefectures', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('prefectures', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('prefectures', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('prefectures', '#E91E63')" style="background:#E91E63">сЃћсЃ│сѓ»</button>
          </div>
          <div>т▒▒тю░сЃ╗т▒▒Уёѕсѓ»сѓцсѓ║:
            <button onclick="setMenuBtnColor('mountains', '#795548')" style="background:#795548">УїХУЅ▓</button>
            <button onclick="setMenuBtnColor('mountains', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('mountains', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('mountains', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('mountains', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('mountains', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('mountains', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('mountains', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>тиЮсѓ»сѓцсѓ║:
            <button onclick="setMenuBtnColor('rivers', '#2196F3')" style="background:#2196F3">Т░┤УЅ▓</button>
            <button onclick="setMenuBtnColor('rivers', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('rivers', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('rivers', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('rivers', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('rivers', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('rivers', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('rivers', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
          <div>т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║:
            <button onclick="setMenuBtnColor('plains', '#8BC34A')" style="background:#8BC34A">УќёуиЉ</button>
            <button onclick="setMenuBtnColor('plains', '#4f8ef7')" style="background:#4f8ef7">жЮњ</button>
            <button onclick="setMenuBtnColor('plains', '#4CAF50')" style="background:#4CAF50">уиЉ</button>
            <button onclick="setMenuBtnColor('plains', '#F44336')" style="background:#F44336">Ухц</button>
            <button onclick="setMenuBtnColor('plains', '#FF9800')" style="background:#FF9800">сѓфсЃгсЃ│сѓИ</button>
            <button onclick="setMenuBtnColor('plains', '#9E9E9E')" style="background:#9E9E9E">сѓ░сЃгсЃ╝</button>
            <button onclick="setMenuBtnColor('plains', '#FFEB3B')" style="background:#FFEB3B;color:#222;">ж╗ёУЅ▓</button>
            <button onclick="setMenuBtnColor('plains', '#9C27B0')" style="background:#9C27B0">у┤Ф</button>
          </div>
        </div>
        <div style="margin:16px 0;">BGM№╝џ
          <button onclick="playBGM()">BGMтєЇућЪ</button>
          <button onclick="pauseBGM()">BGMтЂюТГб</button>
        </div>
        <div style="margin:16px 0;">ті╣ТъюжЪ│№╝џ
          <button onclick="toggleSE()" id="se-toggle-btn">ті╣ТъюжЪ│ON/OFF</button>
        </div>
        <div style="margin:16px 0;color:#c00;">Рђ╗BGMсѓёті╣ТъюжЪ│сЂїУЂъсЂЊсЂѕсЂфсЂёта┤тљѕсЂ»сђЂсЃюсѓ┐сЃ│сѓњТі╝сЂЌсЂдсЂІсѓЅтєЇућЪсЂЌсЂдсЂЈсЂасЂЋсЂё№╝ѕУЄфтІЋтєЇућЪтѕХжЎљт»ЙуГќ№╝Ѕ</div>
        <button id="back-btn">сЃѕсЃЃсЃЌсЂФТѕ╗сѓІ</button>
      `;
      applyMenuBtnColors();
      document.querySelectorAll('#back-btn').forEach(btn => btn.onclick = showTopMenu);
    }
    window.showCustomize = showCustomize;
    document.getElementById('customize-fab').addEventListener('click', showCustomize);

    window.setButtonColor = function(color) {
      document.querySelectorAll('button, .piece').forEach(btn => {
        btn.style.background = color;
        btn.style.color = (color === '#FFEB3B' || color === '#fff' || color === '#f8f8ff') ? '#222' : '#fff';
      });
    };
    window.setBgPattern = setBgPattern;
    window.playBGM = playBGM;
    window.pauseBGM = pauseBGM;

    function showTopMenu() {
      // сѓ┐сѓцсЃъсЃ╝сѓњсѓ»сЃфсѓб
      if (timeTimer) {
        clearInterval(timeTimer);
        timeTimer = null;
      }
      // сѓ╣сѓ│сѓбУАеуц║сѓњТЏ┤Тќ░
      updateTotalScore();
      
      const total = Object.values(bestScores).reduce((sum, score) => sum + score, 0);
      
      // сЃАсЃІсЃЦсЃ╝сѓњУАеуц║
      let menuHTML;
      if (learningModeEnabled) {
        menuHTML = `
          <div class="mode-btns">
            <button onclick="learningUI.showDashboard()">­ЪЊі сЃђсЃЃсѓисЃЦсЃюсЃ╝сЃЅ</button>
            <button id="btn-quiz" style="background:${menuBtnColors.quiz}">­ЪЊЮ сѓ»сѓцсѓ║сЂДтГду┐њ</button>
            <button id="btn-sort" style="background:${menuBtnColors.sort}">­ЪДЕ СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФ</button>
            <button onclick="showActiveRecall()">­ЪДа сѓбсѓ»сЃєсѓБсЃќсЃфсѓ│сЃ╝сЃФ</button>
            <button onclick="learningUI.startReview()">­ЪЊџ тЙЕу┐њ</button>
            <button onclick="learningUI.showBadges()">­ЪЈє сЃљсЃЃсѓИ</button>
            <button onclick="learningUI.showSettings()">РџЎ№ИЈ УеГт«џ</button>
          </div>
        `;
      } else {
        menuHTML = `
          <div class="mode-btns">
            <button id="btn-quiz" style="background:${menuBtnColors.quiz}">сѓ»сѓцсѓ║</button>
            <button id="btn-sort" style="background:${menuBtnColors.sort}">СИдсЂ╣ТЏ┐сЂѕсЃЉсѓ║сЃФ</button>
            <button id="btn-allsort" style="background:${menuBtnColors.allsort}">тЁежЃйжЂЊт║юуюїСИдсЂ╣ТЏ┐сЂѕ</button>
            <button id="btn-timeattack" style="background:${menuBtnColors.timeattack}">сѓ┐сѓцсЃасѓбсѓ┐сЃЃсѓ»</button>
            <button id="btn-map" style="background:${menuBtnColors.map}">тю░тЏ│сЃЉсѓ║сЃФ</button>
            <button id="btn-dialect" style="background:${menuBtnColors.dialect}">Тќ╣УеђсЃбсЃ╝сЃЅ</button>
            <button id="btn-mascot" style="background:${menuBtnColors.mascot}">сЃъсѓ╣сѓ│сЃЃсЃѕсЃбсЃ╝сЃЅ</button>
            <button id="btn-wrong-review" style="background:#FF6B6B">­Ъћё жќЊжЂЋсЂётЙЕу┐њ</button>
            <button id="btn-timed" style="background:#4ECDC4">РЈ▒№ИЈ ТЎѓжќЊтѕХжЎљсЃбсЃ╝сЃЅ</button>
            <button id="btn-analysis" style="background:#95E1D3">­ЪЊі тѕєжЄјтѕЦтѕєТъљ</button>
            <button id="btn-ai-notes" style="background:#B983FF">­ЪЊЮ AIсЂЙсЂесѓЂсЃјсЃ╝сЃѕ</button>
            <button id="btn-prefectures" style="background:${menuBtnColors.prefectures || '#9C27B0'}">уюїт║ЂТЅђтюетю░сѓ»сѓцсѓ║</button>
            <button id="btn-mountains" style="background:${menuBtnColors.mountains || '#795548'}">т▒▒тю░сЃ╗т▒▒Уёѕсѓ»сѓцсѓ║</button>
            <button id="btn-rivers" style="background:${menuBtnColors.rivers || '#2196F3'}">тиЮсѓ»сѓцсѓ║</button>
            <button id="btn-plains" style="background:${menuBtnColors.plains || '#8BC34A'}">т╣│тю░сЃ╗уЏєтю░сЃ╗тцДтю░сѓ»сѓцсѓ║</button>
            ${total >= 100 ? `<button id="btn-world" style="background:#ff5722">­ЪїЇ СИќуЋїтю░уљєсѓ»сѓцсѓ║</button>` : `<button disabled style="background:#ccc">­Ъћњ СИќуЋїтю░уљєсѓ»сѓцсѓ║<br>(тљѕУеѕ100уѓ╣сЂДУДБТћЙ)</button>`}
            <button id="btn-settings" style="background:#607D8B">РџЎ№ИЈ сѓ▓сЃ╝сЃаУеГт«џ</button>
          </div>
        `;
      }
      
      document.getElementById('main-area').innerHTML = menuHTML;
      // сЃюсѓ┐сЃ│сЂ«сѓцсЃЎсЃ│сЃѕУеГт«џ№╝ѕтГду┐њсЃбсЃ╝сЃЅсЂДсЂфсЂёсЃюсѓ┐сЃ│сЂ«сЂ┐№╝Ѕ
      if (!learningModeEnabled) {
        document.getElementById('btn-quiz').onclick = function() {
          quizIndex = 0;
          showQuiz();
        };
        document.getElementById('btn-sort').onclick = function() {
          sortIndex = 0;
          showSortPuzzle();
        };
        if (document.getElementById('btn-allsort')) {
          document.getElementById('btn-allsort').onclick = showAllPrefSort;
        }
        if (document.getElementById('btn-timeattack')) {
          document.getElementById('btn-timeattack').onclick = function() {
            timeIndex = 0;
            showTimeAttack();
          };
        }
        if (document.getElementById('btn-map')) {
          document.getElementById('btn-map').onclick = showMapPuzzle;
        }
        if (document.getElementById('btn-dialect')) {
          document.getElementById('btn-dialect').onclick = function() {
            dialectIndex = 0;
            showDialectMode();
          };
        }
        if (document.getElementById('btn-mascot')) {
          document.getElementById('btn-mascot').onclick = function() {
            mascotQuizIndex = 0;
            showMascotMode();
          };
        }
        
        // тГду┐њті╣ујЄсѓбсЃЃсЃЌТЕЪУЃйсЂ«сЃюсѓ┐сЃ│УеГт«џ
        if (document.getElementById('btn-wrong-review')) {
          document.getElementById('btn-wrong-review').onclick = function() {
            showWrongReview();
          };
        }
        if (document.getElementById('btn-timed')) {
          document.getElementById('btn-timed').onclick = function() {
            showTimedMode();
          };
        }
        if (document.getElementById('btn-analysis')) {
          document.getElementById('btn-analysis').onclick = function() {
            showCategoryAnalysis();
          };
        }
        if (document.getElementById('btn-ai-notes')) {
          document.getElementById('btn-ai-notes').onclick = function() {
            showAINotes();
          };
        }
        
        // Тќ░сЂЌсЂёсѓ»сѓцсѓ║сЃбсЃ╝сЃЅсЂ«сЃюсѓ┐сЃ│УеГт«џ
        if (document.getElementById('btn-prefectures')) {
          document.getElementById('btn-prefectures').onclick = function() {
            prefecturesQuizIndex = 0;
            showPrefecturesQuiz();
          };
        }
        if (document.getElementById('btn-mountains')) {
          document.getElementById('btn-mountains').onclick = function() {
            mountainsQuizIndex = 0;
            showMountainsQuiz();
          };
        }
        if (document.getElementById('btn-rivers')) {
          document.getElementById('btn-rivers').onclick = function() {
            riversQuizIndex = 0;
            showRiversQuiz();
          };
        }
        if (document.getElementById('btn-plains')) {
          document.getElementById('btn-plains').onclick = function() {
            plainsQuizIndex = 0;
            showPlainsQuiz();
          };
        }
        
        // СИќуЋїтю░уљєсѓ»сѓцсѓ║сЃюсѓ┐сЃ│сЂ«УеГт«џ
        if (total >= 100 && document.getElementById('btn-world')) {
          document.getElementById('btn-world').onclick = function() {
            worldQuizIndex = 0;
            showWorldQuiz();
          };
        }
        
        // УеГт«џсЃюсѓ┐сЃ│сЂ«сѓцсЃЎсЃ│сЃѕ
        if (document.getElementById('btn-settings')) {
          document.getElementById('btn-settings').onclick = showSettings;
        }
      } else {
        // тГду┐њсЃбсЃ╝сЃЅсЂДсѓѓСй┐сЂѕсѓІсЃюсѓ┐сЃ│сЂ«УеГт«џ
        document.getElementById('btn-quiz').onclick = function() {
          quizIndex = 0;
          showQuiz();
        };
        document.getElementById('btn-sort').onclick = function() {
          sortIndex = 0;
          showSortPuzzle();
        };
      }
    }

    // сѓФсѓ╣сѓ┐сЃъсѓцсѓ║ућ╗жЮбсЂ«УЅ▓тЈЇТўа
    function applyMenuBtnColors() {
      const btnMap = {
        'btn-quiz': 'quiz',
        'btn-sort': 'sort',
        'btn-allsort': 'allsort',
        'btn-timeattack': 'timeattack',
        'btn-map': 'map',
        'btn-dialect': 'dialect',
        'btn-mascot': 'mascot'
      };
      document.querySelectorAll('#main-area button').forEach(btn => {
        const key = btnMap[btn.id];
        if (key && menuBtnColors[key]) {
          btn.style.background = menuBtnColors[key];
          btn.style.color = (menuBtnColors[key] === '#FFEB3B' || menuBtnColors[key] === '#fff' || menuBtnColors[key] === '#f8f8ff') ? '#222' : '#fff';
          btn.disabled = false;
          btn.style.pointerEvents = 'auto';
        }
      });
    }

    // тГду┐њсЃбсЃ╝сЃЅтѕЄсѓіТЏ┐сЂѕ
    function toggleLearningMode() {
      learningModeEnabled = !learningModeEnabled;
      localStorage.setItem('learningModeEnabled', learningModeEnabled);
      
      const toggle = document.getElementById('learning-toggle');
      const streakDisplay = document.getElementById('streak-display');
      
      if (learningModeEnabled) {
        toggle.innerHTML = '­Ъј« сѓ▓сЃ╝сЃасЃбсЃ╝сЃЅ';
        streakDisplay.style.display = 'block';
        learningUI.updateStreakDisplay();
      } else {
        toggle.innerHTML = '­ЪЊі тГду┐њсЃбсЃ╝сЃЅ';
        streakDisplay.style.display = 'none';
      }
      
      showTopMenu();
    }
    
    // сѓбсѓ»сЃєсѓБсЃќсЃфсѓ│сЃ╝сЃФТЕЪУЃй
    function showActiveRecall() {
      const mainArea = document.getElementById('main-area');
      mainArea.innerHTML = `
        <div class="active-recall-modes">
          <h2>­ЪДа сѓбсѓ»сЃєсѓБсЃќсЃфсѓ│сЃ╝сЃФ</h2>
          <div class="mode-btns">
            <button onclick="startFillInBlank()">­ЪЊЮ уЕ┤тЪІсѓЂтЋЈжАї</button>
            <button onclick="startTableHide()">­ЪЊі УАесЂ«жџасЂЌсЃбсЃ╝сЃЅ</button>
            <button onclick="startStepLearning()">­ЪЊќ сѓ╣сЃєсЃЃсЃЌтГду┐њ</button>
            <button onclick="showDualExplanation()">­Ъћё С║їтѕђТхЂУДБУфг</button>
            <button onclick="showTopMenu()">­ЪћЎ сЃАсЃІсЃЦсЃ╝сЂФТѕ╗сѓІ</button>
          </div>
        </div>
      `;
    }
    
    function startFillInBlank() {
      const sampleTexts = [
        "ТЌЦТюгсЂ«ждќжЃйсЂ»ТЮ▒С║гжЃйсЂДсђЂС║║тЈБсЂ»у┤ё1400СИЄС║║сЂДсЂЎсђѓТЌЦТюгсЂДТюђсѓѓжЮбуЕЇсЂїт║ЃсЂёжЃйжЂЊт║юуюїсЂ»тїЌТхижЂЊсЂДсЂЎсђѓ",
        "т»їтБФт▒▒сЂ«ТеЎжФўсЂ»3776сЃАсЃ╝сЃѕсЃФсЂДсђЂжЮЎт▓АуюїсЂет▒▒ТбеуюїсЂФсЂЙсЂЪсЂїсЂБсЂдсЂёсЂЙсЂЎсђѓ",
        "ТЌЦТюгСИЅТЎ»сЂ»ТЮЙт│ХсђЂтцЕТЕІуФІсђЂт««т│ХсЂДсЂЎсђѓсЂЊсѓїсѓЅсЂ»Т▒ЪТѕИТЎѓС╗БсЂІсѓЅтљЇтІЮсЂесЂЌсЂдуЪЦсѓЅсѓїсЂдсЂёсЂЙсЂЎсђѓ"
      ];
      const randomText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
      activeRecallUI.showFillInBlankMode(randomText);
    }
    
    function startTableHide() {
      const tableData = [
        ['ТЮ▒С║гжЃй', 'ТЮ▒С║г', 'у┤ё1400СИЄС║║'],
        ['тцДжўфт║ю', 'тцДжўф', 'у┤ё880СИЄС║║'],
        ['ТёЏуЪЦуюї', 'тљЇтЈцт▒І', 'у┤ё750СИЄС║║'],
        ['удЈт▓Ауюї', 'удЈт▓А', 'у┤ё510СИЄС║║']
      ];
      const headers = ['жЃйжЂЊт║юуюї', 'уюїт║ЂТЅђтюетю░', 'С║║тЈБ'];
      activeRecallUI.showTableHideMode(tableData, headers);
    }
    
    function startStepLearning() {
      activeRecallUI.showStepLearning('ТЌЦТюгсЂ«тю░тйб', {
        explanation: 'ТЌЦТюгсЂ»т│ХтЏйсЂДсђЂ4сЂцсЂ«СИ╗УдЂсЂфт│ХсЂІсѓЅТДІТѕљсЂЋсѓїсЂдсЂёсЂЙсЂЎсђѓ',
        example: 'ТюгтиъсђЂтїЌТхижЂЊсђЂС╣ЮтиъсђЂтЏЏтЏйсЂїСИ╗УдЂсЂфт│ХсЂДсЂЎсђѓ',
        practice: 'сЂЮсѓїсЂъсѓїсЂ«т│ХсЂ«уЅ╣тЙ┤сѓњуГћсЂѕсЂдсЂЈсЂасЂЋсЂёсђѓ'
      });
    }
    
    function showDualExplanation() {
      const simple = "ТЌЦТюгсЂ»т│ХсЂ«тЏйсЂДсЂЎсђѓтцДсЂЇсЂфт│ХсЂї4сЂцсЂѓсѓісЂЙсЂЎсђѓт▒▒сЂїсЂЪсЂЈсЂЋсѓЊсЂѓсЂБсЂдсђЂсЂЙсѓЈсѓісЂ»ТхисЂДсЂЎсђѓ";
      const technical = "ТЌЦТюгсЂ»ТЮ▒сѓбсѓИсѓбсЂФСйЇуй«сЂЎсѓІт│ХтХ╝тЏйт«ХсЂДсђЂТюгтиъсЃ╗тїЌТхижЂЊсЃ╗С╣ЮтиъсЃ╗тЏЏтЏйсЂ«4сЂцсЂ«СИ╗УдЂт│ХсЂеу┤ё6,800сЂ«т░Јт│ХсЂІсѓЅТДІТѕљсЂЋсѓїсЂдсЂёсЂЙсЂЎсђѓтЏйтюЪсЂ«у┤ё73%сЂїт▒▒тю░сЂДсђЂуњ░тцфт╣│Т┤Іжђат▒▒тИ»сЂФт▒ъсЂЌсђЂуЂФт▒▒Т┤╗тІЋсЂїТ┤╗уЎ║сЂДсЂЎсђѓ";
      activeRecallUI.showDualExplanation('ТЌЦТюгсЂ«тю░уљєуџёуЅ╣тЙ┤', simple, technical);
    }
    
    // тѕЮТюЪУАеуц║
    loadScores();
    loadCustomQuizzes();
    
    // тГду┐њсЃбсЃ╝сЃЅсЂ«тѕЮТюЪУеГт«џ
    if (learningModeEnabled) {
      document.getElementById('learning-toggle').innerHTML = '­Ъј« сѓ▓сЃ╝сЃасЃбсЃ╝сЃЅ';
      document.getElementById('streak-display').style.display = 'block';
      learningUI.updateStreakDisplay();
    }
    
    // тГду┐њті╣ујЄсѓбсЃЃсЃЌТЕЪУЃйсЂ«т«ЪУБЁ
    let isReviewMode = false;
    
    // 1. жќЊжЂЋсЂётЙЕу┐њТЕЪУЃй
    function showWrongReview() {
      if (wrongQuestions.length === 0) {
        document.getElementById('main-area').innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <h2>жќЊжЂЋсЂѕсЂЪтЋЈжАїсЂїсЂѓсѓісЂЙсЂЏсѓЊ</h2>
            <p>сѓ»сѓцсѓ║сЂДжќЊжЂЋсЂѕсЂЪтЋЈжАїсЂїсЂЊсЂЊсЂФУАеуц║сЂЋсѓїсЂЙсЂЎ</p>
            <button onclick="showTopMenu()">сЃАсЃІсЃЦсЃ╝сЂФТѕ╗сѓІ</button>
          </div>
        `;
        return;
      }
      
      // жќЊжЂЋсЂѕсЂЪтЋЈжАїсЂДсѓ»сѓцсѓ║сѓњжќІтДІ
      quizIndex = 0;
      quizScore = 0;
      quizQuestions = [...wrongQuestions];
      isReviewMode = true;
      showQuiz();
    }
    
    // 2. ТЎѓжќЊтѕХжЎљсЃбсЃ╝сЃЅ
    function showTimedMode() {
      document.getElementById('main-area').innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <h2>РЈ▒№ИЈ ТЎѓжќЊтѕХжЎљсЃбсЃ╝сЃЅ</h2>
          <p>тљётЋЈжАїсЂФтѕХжЎљТЎѓжќЊсѓњУеГт«џсЂЌсЂдсѓ»сѓцсѓ║сЂФТїЉТѕд№╝Ђ</p>
          <div style="margin: 20px 0;">
            <label>тѕХжЎљТЎѓжќЊ№╝ѕуДњ№╝Ѕ: </label>
            <select id="time-limit-select" style="padding: 5px; font-size: 16px;">
              <option value="10">10уДњ</option>
              <option value="20">20уДњ</option>
              <option value="30" selected>30уДњ</option>
              <option value="60">60уДњ</option>
            </select>
          </div>
          <button onclick="startTimedQuiz()">жќІтДІ</button>
          <button onclick="showTopMenu()" style="background: #ccc;">Тѕ╗сѓІ</button>
        </div>
      `;
    }
    
    function startTimedQuiz() {
      timeLimit = parseInt(document.getElementById('time-limit-select').value);
      isTimedMode = true;
      quizIndex = 0;
      quizScore = 0;
      showQuiz();
    }
    
    // 3. тѕєжЄјтѕЦтѕєТъљ
    function showCategoryAnalysis() {
      // сѓФсЃєсѓ┤сЃфсЃ╝тѕЦсЂ«ух▒УеѕсѓњУеѕу«Ќ
      const categories = ['тю░уљє', 'ТГ┤тЈ▓', 'ТќЄтїќ', 'ућБТЦГ', 'Тќ╣Уеђ', 'сЂЮсЂ«С╗ќ'];
      let analysisHTML = `
        <div style="padding: 20px;">
          <h2>­ЪЊі тѕєжЄјтѕЦтѕєТъљ</h2>
          <div style="margin: 20px 0;">
      `;
      
      categories.forEach(category => {
        const stats = categoryScores[category] || { correct: 0, total: 0 };
        const percentage = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
        const barWidth = percentage + '%';
        
        analysisHTML += `
          <div style="margin: 15px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
              <span>${category}</span>
              <span>${stats.correct}/${stats.total} (${percentage}%)</span>
            </div>
            <div style="background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden;">
              <div style="background: ${percentage >= 80 ? '#4CAF50' : percentage >= 60 ? '#FFC107' : '#FF5722'}; 
                          width: ${barWidth}; height: 100%; transition: width 0.3s;"></div>
            </div>
          </div>
        `;
      });
      
      analysisHTML += `
          </div>
          <div style="text-align: center; margin-top: 30px;">
            <button onclick="showTopMenu()">сЃАсЃІсЃЦсЃ╝сЂФТѕ╗сѓІ</button>
          </div>
        </div>
      `;
      
      document.getElementById('main-area').innerHTML = analysisHTML;
    }
    
    // жќЊжЂЋсЂѕсЂЪтЋЈжАїсѓњУеўжї▓сЂЎсѓІжќбТЋ░
    function recordWrongAnswer(question) {
      // ТЌбсЂФУеўжї▓сЂЋсѓїсЂдсЂёсѓІсЂІсЃЂсѓДсЃЃсѓ»
      const exists = wrongQuestions.some(q => q.question === question.question);
      if (!exists) {
        wrongQuestions.push(question);
        localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
      }
    }
    
    // сѓФсЃєсѓ┤сЃфсЃ╝сѓ╣сѓ│сѓбсѓњТЏ┤Тќ░сЂЎсѓІжќбТЋ░
    function updateCategoryScore(category, isCorrect) {
      if (!categoryScores[category]) {
        categoryScores[category] = { correct: 0, total: 0 };
      }
      categoryScores[category].total++;
      if (isCorrect) {
        categoryScores[category].correct++;
      }
      localStorage.setItem('categoryScores', JSON.stringify(categoryScores));
    }
    
    // тГду┐њт▒ЦТГ┤сЂ«Уеўжї▓
    let learningHistory = JSON.parse(localStorage.getItem('learningHistory') || '[]');
    
    // AIсЂЙсЂесѓЂсЃјсЃ╝сЃѕТЕЪУЃй
    function showAINotes() {
      // тГду┐њт▒ЦТГ┤сЂІсѓЅсЂЙсЂесѓЂсѓњућЪТѕљ
      const summaryData = generateLearningSummary();
      
      document.getElementById('main-area').innerHTML = `
        <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 30px;">­ЪЊЮ AIсЂЙсЂесѓЂсЃјсЃ╝сЃѕ</h2>
          
          <!-- С╗іТЌЦсЂ«тГду┐њсѓхсЃъсЃфсЃ╝ -->
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
            <h3 style="margin: 0 0 10px 0;">­ЪЊі С╗іТЌЦсЂ«тГду┐њуіХТ│Ђ</h3>
            <div style="display: flex; justify-content: space-around; text-align: center;">
              <div>
                <div style="font-size: 2rem; font-weight: bold;">${summaryData.todayQuestions}</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">тЋЈжАїсЂФТїЉТѕд</div>
              </div>
              <div>
                <div style="font-size: 2rem; font-weight: bold;">${summaryData.todayAccuracy}%</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">ТГБуГћујЄ</div>
              </div>
              <div>
                <div style="font-size: 2rem; font-weight: bold;">${summaryData.todayMinutes}тѕє</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">тГду┐њТЎѓжќЊ</div>
              </div>
            </div>
          </div>
          
          <!-- жЄЇУдЂУфътЈЦ -->
          <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333;">­ЪћЉ С╗іТЌЦтГду┐њсЂЌсЂЪжЄЇУдЂУфътЈЦ</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
              ${summaryData.keyTerms.map(term => `
                <span style="background: #e3f2fd; color: #1976d2; padding: 8px 16px; border-radius: 20px; font-size: 0.95rem;">
                  ${term}
                </span>
              `).join('')}
            </div>
          </div>
          
          <!-- тГду┐њтєЁт«╣сЂ«сЂЙсЂесѓЂ -->
          <div style="background: #fff; border: 2px solid #e0e0e0; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333;">­ЪЊќ тГду┐њтєЁт«╣сЂ«сЂЙсЂесѓЂ</h3>
            ${summaryData.summaries.map(summary => `
              <div style="margin-bottom: 20px; padding: 15px; background: #fafafa; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; color: #4f8ef7;">${summary.category}</h4>
                <p style="margin: 0 0 10px 0; line-height: 1.6;">${summary.content}</p>
                <div style="font-size: 0.9rem; color: #666;">
                  ­ЪњА сЃЮсѓцсЃ│сЃѕ: ${summary.keyPoint}
                </div>
              </div>
            `).join('')}
          </div>
          
          <!-- УІдТЅІтѕєжЄјсЂ«тѕєТъљ -->
          <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #856404;">Рџа№ИЈ УдЂтЙЕу┐њсЃЮсѓцсЃ│сЃѕ</h3>
            ${summaryData.weakPoints.map(point => `
              <div style="margin-bottom: 10px; padding: 10px; background: #fff; border-radius: 6px;">
                <strong>${point.topic}</strong>: ${point.advice}
              </div>
            `).join('')}
          </div>
          
          <!-- сѓбсѓ»сѓисЃДсЃ│сЃюсѓ┐сЃ│ -->
          <div style="text-align: center; margin-top: 30px;">
            <button onclick="exportNotes()" style="background: #4CAF50; margin-right: 10px;">
              ­ЪњЙ сЃјсЃ╝сЃѕсѓњС┐ЮтГў
            </button>
            <button onclick="shareNotes()" style="background: #2196F3; margin-right: 10px;">
              ­ЪЊц тЁ▒ТюЅсЂЎсѓІ
            </button>
            <button onclick="showTopMenu()" style="background: #666;">
              Тѕ╗сѓІ
            </button>
          </div>
        </div>
      `;
    }
    
    // тГду┐њсѓхсЃъсЃфсЃ╝сѓњућЪТѕљ
    function generateLearningSummary() {
      const today = new Date().toDateString();
      const todayHistory = learningHistory.filter(h => new Date(h.timestamp).toDateString() === today);
      
      // С╗іТЌЦсЂ«ух▒Уеѕ
      const todayQuestions = todayHistory.length;
      const todayCorrect = todayHistory.filter(h => h.correct).length;
      const todayAccuracy = todayQuestions > 0 ? Math.round((todayCorrect / todayQuestions) * 100) : 0;
      const todayMinutes = Math.round(todayHistory.reduce((sum, h) => sum + (h.timeSpent || 0), 0) / 60);
      
      // жЄЇУдЂУфътЈЦсЂ«ТійтЄ║
      const keyTerms = extractKeyTerms(todayHistory);
      
      // сѓФсЃєсѓ┤сЃфсЃ╝тѕЦсЂ«сЂЙсЂесѓЂ
      const summaries = generateCategorySummaries(todayHistory);
      
      // УІдТЅІтѕєжЄјсЂ«тѕєТъљ
      const weakPoints = analyzeWeakPoints(todayHistory);
      
      return {
        todayQuestions,
        todayAccuracy,
        todayMinutes,
        keyTerms,
        summaries,
        weakPoints
      };
    }
    
    // жЄЇУдЂУфътЈЦсѓњТійтЄ║
    function extractKeyTerms(history) {
      const terms = new Set();
      const importantWords = [
        'уюїт║ЂТЅђтюетю░', 'т╣│жЄј', 'уЏєтю░', 'жФўтю░', 'т▒▒Уёѕ', 'Т▓│тиЮ', 'Т╣ќ',
        'С║║тЈБ', 'жЮбуЕЇ', 'ућБТЦГ', 'уЅ╣ућБтЊЂ', 'СИќуЋїжЂ║ућБ', 'тЏйуФІтЁгтюњ',
        'Т░ЌтђЎ', 'тю░тйб', 'тЇіт│Х', 'УФИт│Х', 'Тхит│А', 'Т╣Й'
      ];
      
      history.forEach(h => {
        if (h.question) {
          importantWords.forEach(word => {
            if (h.question.includes(word)) {
              terms.add(word);
            }
          });
          
          // жЃйжЂЊт║юуюїтљЇсѓѓТійтЄ║
          const prefectures = h.question.match(/[жЃйжЂЊт║юуюї]([жЃйжЂЊт║юуюї])/g);
          if (prefectures) {
            prefectures.forEach(p => terms.add(p));
          }
        }
      });
      
      return Array.from(terms).slice(0, 12); // ТюђтцД12тђІсЂЙсЂД
    }
    
    // сѓФсЃєсѓ┤сЃфсЃ╝тѕЦсѓхсЃъсЃфсЃ╝сѓњућЪТѕљ
    function generateCategorySummaries(history) {
      const categories = {
        'тю░уљє': {
          keywords: ['т╣│жЄј', 'уЏєтю░', 'т▒▒', 'тиЮ', 'Т╣ќ', 'Тхи', 'т│Х'],
          summary: 'ТЌЦТюгсЂ«тю░тйбсЂФсЂцсЂёсЂдтГду┐њсЂЌсЂЙсЂЌсЂЪсђѓ'
        },
        'ућБТЦГ': {
          keywords: ['УЙ▓ТЦГ', 'тиЦТЦГ', 'Т╝ЂТЦГ', 'ућБТЦГ', 'ућЪућБ', 'УБйжђа'],
          summary: 'тљёжЃйжЂЊт║юуюїсЂ«СИ╗УдЂућБТЦГсЂФсЂцсЂёсЂдтГду┐њсЂЌсЂЙсЂЌсЂЪсђѓ'
        },
        'ТќЄтїќ': {
          keywords: ['уЦГсѓі', 'С╝Юух▒', 'ТќЄтїќ', 'СИќуЋїжЂ║ућБ', 'тљЇТЅђ'],
          summary: 'ТЌЦТюгсЂ«ТќЄтїќсѓёУд│тЁЅтю░сЂФсЂцсЂёсЂдтГду┐њсЂЌсЂЙсЂЌсЂЪсђѓ'
        }
      };
      
      const summaries = [];
      
      Object.entries(categories).forEach(([category, data]) => {
        const relatedQuestions = history.filter(h => 
          data.keywords.some(keyword => h.question && h.question.includes(keyword))
        );
        
        if (relatedQuestions.length > 0) {
          const correctRate = Math.round((relatedQuestions.filter(q => q.correct).length / relatedQuestions.length) * 100);
          
          summaries.push({
            category,
            content: `${data.summary} ${relatedQuestions.length}тЋЈсЂФТїЉТѕдсЂЌсђЂТГБуГћујЄсЂ»${correctRate}%сЂДсЂЌсЂЪсђѓ`,
            keyPoint: relatedQuestions[0].question ? 
              `сђї${relatedQuestions[0].question.substring(0, 30)}...сђЇсЂфсЂЕсѓњтГду┐њсЂЌсЂЙсЂЌсЂЪсђѓ` : 
              'ТДўсђЁсЂфтЋЈжАїсЂФтЈќсѓіухёсЂ┐сЂЙсЂЌсЂЪсђѓ'
          });
        }
      });
      
      return summaries;
    }
    
    // УІдТЅІтѕєжЄјсѓњтѕєТъљ
    function analyzeWeakPoints(history) {
      const incorrectQuestions = history.filter(h => !h.correct);
      const weakPoints = [];
      
      // сѓФсЃєсѓ┤сЃфсЃ╝тѕЦсЂФжЏєУеѕ
      const categoryMistakes = {};
      incorrectQuestions.forEach(q => {
        const category = q.category || 'сЂЮсЂ«С╗ќ';
        categoryMistakes[category] = (categoryMistakes[category] || 0) + 1;
      });
      
      Object.entries(categoryMistakes).forEach(([category, count]) => {
        if (count >= 2) {
          weakPoints.push({
            topic: category,
            advice: `${count}тЋЈжќЊжЂЋсЂѕсЂЙсЂЌсЂЪсђѓсЂЊсЂ«тѕєжЄјсѓњжЄЇуѓ╣уџёсЂФтЙЕу┐њсЂЌсЂЙсЂЌсѓЄсЂєсђѓ`
          });
        }
      });
      
      return weakPoints.slice(0, 3); // ТюђтцД3сЂцсЂЙсЂД
    }
    
    // сЃјсЃ╝сЃѕсѓњсѓесѓ»сѓ╣сЃЮсЃ╝сЃѕ
    function exportNotes() {
      const summaryData = generateLearningSummary();
      const date = new Date().toLocaleDateString('ja-JP');
      
      let content = `ТЌЦТюгтю░уљєтГду┐њсЃјсЃ╝сЃѕ - ${date}\n\n`;
      content += `=== тГду┐њуіХТ│Ђ ===\n`;
      content += `тЋЈжАїТЋ░: ${summaryData.todayQuestions}тЋЈ\n`;
      content += `ТГБуГћујЄ: ${summaryData.todayAccuracy}%\n`;
      content += `тГду┐њТЎѓжќЊ: ${summaryData.todayMinutes}тѕє\n\n`;
      
      content += `=== жЄЇУдЂУфътЈЦ ===\n`;
      content += summaryData.keyTerms.join('сђЂ') + '\n\n';
      
      content += `=== тГду┐њтєЁт«╣ ===\n`;
      summaryData.summaries.forEach(s => {
        content += `сђљ${s.category}сђЉ\n${s.content}\n${s.keyPoint}\n\n`;
      });
      
      // сЃђсѓдсЃ│сЃГсЃ╝сЃЅ
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `тГду┐њсЃјсЃ╝сЃѕ_${date.replace(/\//g, '-')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('сЃјсЃ╝сЃѕсѓњС┐ЮтГўсЂЌсЂЙсЂЌсЂЪ№╝Ђ');
    }
    
    // сЃјсЃ╝сЃѕсѓњтЁ▒ТюЅ
    function shareNotes() {
      alert('SNSтЁ▒ТюЅТЕЪУЃйсЂ»Т║ќтѓЎСИГсЂДсЂЎ№╝Ђ');
    }
    
    // тГду┐њт▒ЦТГ┤сѓњУеўжї▓сЂЎсѓІжќбТЋ░№╝ѕТЌбтГўсЂ«сѓ»сѓцсѓ║ТЕЪУЃйсЂФУ┐йтіа№╝Ѕ
    function recordLearningHistory(question, correct, category, timeSpent) {
      const record = {
        question: question,
        correct: correct,
        category: category || 'сЂЮсЂ«С╗ќ',
        timeSpent: timeSpent || 0,
        timestamp: new Date().toISOString()
      };
      
      learningHistory.push(record);
      
      // ТюђТќ░100С╗ХсЂ«сЂ┐С┐ЮТїЂ
      if (learningHistory.length > 100) {
        learningHistory = learningHistory.slice(-100);
      }
      
      localStorage.setItem('learningHistory', JSON.stringify(learningHistory));
    }
    
    // AIУДБУфгсѓбсѓисѓ╣сЃѕТЕЪУЃй
    let aiAssistMode = false;
    const aiExplanations = {
      // тю░уљєућеУфъсЂ«УДБУфг
      'уюїт║ЂТЅђтюетю░': 'уюїт║ЂТЅђтюетю░сЂесЂ»сђЂжЃйжЂЊт║юуюїсЂ«УАїТћ┐сЂ«СИГт┐ЃсЂесЂфсѓІжЃйтИѓсЂ«сЂЊсЂесЂДсЂЎсђѓуюїт║Ђ№╝ѕжЃйжЂЊт║юуюїт║Ђ№╝ЅсЂїуй«сЂІсѓїсЂдсЂёсѓІтИѓућ║ТЮЉсѓњТїЄсЂЌсЂЙсЂЎсђѓ',
      'уЏєтю░': 'уЏєтю░сЂесЂ»сђЂтЉетЏ▓сѓњт▒▒сѓёСИўжЎхсЂФтЏ▓сЂЙсѓїсЂЪт╣│сѓЅсЂфтюЪтю░сЂ«сЂЊсЂесЂДсЂЎсђѓТЌЦТюгсЂДсЂ»ућ▓т║юуЏєтю░сђЂтЦѕУЅ»уЏєтю░сЂфсЂЕсЂїТюЅтљЇсЂДсЂЎсђѓ',
      'т╣│жЄј': 'т╣│жЄјсЂесЂ»сђЂт║ЃсЂЈт╣│сѓЅсЂфтюЪтю░сЂ«сЂЊсЂесЂДсЂЎсђѓжќбТЮ▒т╣│жЄјсЂ»ТЌЦТюгТюђтцДсЂ«т╣│жЄјсЂДсђЂТЮ▒С║гжЃйсѓётЪ╝ујЅуюїсЂфсЂЕсЂїтљФсЂЙсѓїсЂЙсЂЎсђѓ',
      'жФўтю░': 'жФўтю░сЂесЂ»сђЂТеЎжФўсЂ«жФўсЂёт╣│сѓЅсЂфтюЪтю░сЂ«сЂЊсЂесЂДсЂЎсђѓжЋижЄјуюїсЂ«УФЈУефжФўтјЪсЂфсЂЕсЂїС╗БУАеуџёсЂфСЙІсЂДсЂЎсђѓ',
      'ТхиТхЂ': 'ТхиТхЂсЂесЂ»сђЂТхисЂ«СИГсЂДСИђт«џсЂ«Тќ╣тљЉсЂФТхЂсѓїсѓІТ░┤сЂ«ТхЂсѓїсЂ«сЂЊсЂесЂДсЂЎсђѓТЌЦТюгУ┐ЉТхисЂДсЂ»ж╗њТй«№╝ѕТџќТхЂ№╝ЅсЂеУдфТй«№╝ѕт»њТхЂ№╝ЅсЂїТюЅтљЇсЂДсЂЎсђѓ',
      'Т░ЌтђЎ': 'Т░ЌтђЎсЂесЂ»сђЂсЂѓсѓІтю░тЪЪсЂ«жЋиТюЪжќЊсЂ«т╣│тЮЄуџёсЂфтцЕТ░ЌсЂ«уіХТЁІсЂ«сЂЊсЂесЂДсЂЎсђѓТЌЦТюгсЂ»ТИЕтИ»сЂФт▒ъсЂЌсђЂтЏЏтГБсЂїсЂ»сЂБсЂЇсѓісЂЌсЂдсЂёсЂЙсЂЎсђѓ',
      
      // жЃйжЂЊт║юуюїсЂ«уЅ╣тЙ┤
      'тїЌТхижЂЊ': 'ТЌЦТюгТюђтїЌуФ»сЂ«жЃйжЂЊт║юуюїсЂДсђЂжЮбуЕЇсЂїТюђсѓѓт║ЃсЂёсЂДсЂЎсђѓТюГт╣їтИѓсЂїжЂЊт║ЂТЅђтюетю░сЂДсђЂУЙ▓ТЦГсЃ╗Т╝ЂТЦГсЃ╗Уд│тЁЅТЦГсЂїуЏЏсѓЊсЂДсЂЎсђѓ',
      'ТЮ▒С║гжЃй': 'ТЌЦТюгсЂ«ждќжЃйсЂДсђЂТћ┐Т▓╗сЃ╗ухїТИѕсЃ╗ТќЄтїќсЂ«СИГт┐Ѓтю░сЂДсЂЎсђѓС║║тЈБсЂ»у┤ё1400СИЄС║║сЂДТЌЦТюгТюђтцДсЂ«жЃйтИѓтюЈсѓњтйбТѕљсЂЌсЂдсЂёсЂЙсЂЎсђѓ',
      'С║гжЃйт║ю': '794т╣┤сЂІсѓЅ1869т╣┤сЂЙсЂДТЌЦТюгсЂ«ждќжЃйсЂДсЂЌсЂЪсђѓтцџсЂЈсЂ«т»║уцЙС╗ЈжќБсЂїсЂѓсѓісђЂСИќуЋїжЂ║ућБсѓѓтцџТЋ░тГўтюесЂЌсЂЙсЂЎсђѓ',
      'Т▓ќуИёуюї': 'ТЌЦТюгТюђтЇЌуФ»сЂ«уюїсЂДсђЂС║юує▒тИ»Т░ЌтђЎсЂДсЂЎсђѓуљЅуљЃујІтЏйсЂ«ТГ┤тЈ▓сЂїсЂѓсѓісђЂуІгуЅ╣сЂ«ТќЄтїќсѓњТїЂсЂБсЂдсЂёсЂЙсЂЎсђѓ',
      
      // ућБТЦГсЃ╗уЅ╣ућБтЊЂ
      'сѓісѓЊсЂћ': 'жЮњТБ«уюїсЂїућЪућБжЄЈТЌЦТюгСИђсЂДсЂЎсђѓсђїсЂхсЂўсђЇсђїсЂцсЂїсѓІсђЇсЂфсЂЕсЂ«тЊЂуе«сЂїТюЅтљЇсЂДсђЂтЁетЏйућЪућБжЄЈсЂ«у┤ё60%сѓњтЇасѓЂсЂдсЂёсЂЙсЂЎсђѓ',
      'у▒│': 'Тќ░ТйЪуюїсЂ«сѓ│сѓисЃњсѓФсЃфсЂїуЅ╣сЂФТюЅтљЇсЂДсЂЎсђѓТЌЦТюгсЂ«СИ╗жБЪсЂесЂЌсЂджЄЇУдЂсЂфУЙ▓ућБуЅЕсЂДсЂЎсђѓ',
      'УЄфтІЋУ╗іућБТЦГ': 'ТёЏуЪЦуюїУ▒іућ░тИѓсѓњСИГт┐ЃсЂФуЎ║т▒ЋсЂЌсЂдсЂёсЂЙсЂЎсђѓсЃѕсЃесѓ┐УЄфтІЋУ╗ісЂ«ТюгуцЙсЂїсЂѓсѓісђЂжќбжђБС╝ЂТЦГсѓѓтцџТЋ░уФІтю░сЂЌсЂдсЂёсЂЙсЂЎсђѓ',
      
      // ТќЄтїќсЃ╗Тќ╣Уеђ
      'сЂасЂ╣': 'ТЮ▒тїЌтю░Тќ╣сЂ«Тќ╣УеђсЂДсђїсђюсЂДсЂЌсѓЄсЂєсђЇсЂесЂёсЂєТёЈтЉ│сЂДсЂЎсђѓжЮњТБ«уюїсђЂт▓ЕТЅІуюїсЂфсЂЕсЂДСй┐сѓЈсѓїсЂЙсЂЎсђѓ',
      'сѓёсЂГсѓЊ': 'жќбУЦ┐т╝ЂсЂДсђїсђюсЂасѓѕсђЇсЂесЂёсЂєТёЈтЉ│сЂДсЂЎсђѓтцДжўфт║юсђЂС║гжЃйт║юсђЂтЁхт║ФуюїсЂфсЂЕсЂДСй┐сѓЈсѓїсЂЙсЂЎсђѓ',
      'сЂ░сЂё': 'С╣Ютиътю░Тќ╣сЂ«Тќ╣УеђсЂДсђїсђюсЂасѓѕсђЇсЂесЂёсЂєТёЈтЉ│сЂДсЂЎсђѓудЈт▓АуюїсђЂуєіТюгуюїсЂфсЂЕсЂДСй┐сѓЈсѓїсЂЙсЂЎсђѓ'
    };
    
    // AIУДБУфгсѓбсѓисѓ╣сЃѕсЃюсѓ┐сЃ│сЂ«сѓцсЃЎсЃ│сЃѕ
    document.getElementById('ai-assist-btn').onclick = function() {
      aiAssistMode = !aiAssistMode;
      const btn = document.getElementById('ai-assist-btn');
      const container = document.getElementById('ai-assist-container');
      
      if (aiAssistMode) {
        btn.classList.add('active');
        container.classList.add('show');
        enableTextHighlight();
      } else {
        btn.classList.remove('active');
        container.classList.remove('show');
        disableTextHighlight();
      }
    };
    
    function closeAIAssist() {
      aiAssistMode = false;
      document.getElementById('ai-assist-btn').classList.remove('active');
      document.getElementById('ai-assist-container').classList.remove('show');
      disableTextHighlight();
    }
    
    // сЃєсѓГсѓ╣сЃѕсЂ«сЃЈсѓцсЃЕсѓцсЃѕТЕЪУЃй
    function enableTextHighlight() {
      // сѓ»сѓцсѓ║сЂ«тЋЈжАїТќЄсѓёжЂИТіъУѓбсЂФсЃЈсѓцсЃЕсѓцсЃѕТЕЪУЃйсѓњУ┐йтіа
      document.addEventListener('click', handleTextClick);
      
      // ТЌбтГўсЂ«сЃєсѓГсѓ╣сЃѕсЂФсЃЈсѓцсЃЕсѓцсЃѕтЈ»УЃйсЂфУдЂу┤асѓњУ┐йтіа
      const mainArea = document.getElementById('main-area');
      if (mainArea) {
        highlightKeywords(mainArea);
      }
    }
    
    function disableTextHighlight() {
      document.removeEventListener('click', handleTextClick);
    }
    
    function handleTextClick(e) {
      if (e.target.classList.contains('highlight-text')) {
        const keyword = e.target.textContent;
        showAIExplanation(keyword);
      }
    }
    
    function highlightKeywords(container) {
      const keywords = Object.keys(aiExplanations);
      const walker = document.createTreeWalker(
        container,
        NodeFilter.SHOW_TEXT,
        null,
        false
      );
      
      const textNodes = [];
      while (walker.nextNode()) {
        textNodes.push(walker.currentNode);
      }
      
      textNodes.forEach(node => {
        let text = node.textContent;
        let hasMatch = false;
        
        keywords.forEach(keyword => {
          if (text.includes(keyword)) {
            hasMatch = true;
            text = text.replace(new RegExp(keyword, 'g'), `<span class="highlight-text">${keyword}</span>`);
          }
        });
        
        if (hasMatch) {
          const span = document.createElement('span');
          span.innerHTML = text;
          node.parentNode.replaceChild(span, node);
        }
      });
    }
    
    function showAIExplanation(keyword) {
      const content = document.getElementById('ai-assist-content');
      const explanation = aiExplanations[keyword] || `сђї${keyword}сђЇсЂФсЂцсЂёсЂдсЂ«УЕ│сЂЌсЂёУДБУфгсЂ»Т║ќтѓЎСИГсЂДсЂЎсђѓ`;
      
      content.innerHTML = `
        <div style="margin-bottom: 12px;">
          <strong style="color: #4f8ef7;">сђї${keyword}сђЇсЂ«УДБУфг</strong>
        </div>
        <div>${explanation}</div>
        <div style="margin-top: 12px; font-size: 0.85rem; color: #999;">
          ­ЪњА С╗ќсЂ«УеђУЉЅсѓњсѓ»сЃфсЃЃсѓ»сЂЌсЂдУДБУфгсѓњУдІсѓІсЂЊсЂесѓѓсЂДсЂЇсЂЙсЂЎ
        </div>
      `;
      
      // УДБУфгсѓњУАеуц║
      const container = document.getElementById('ai-assist-container');
      if (!container.classList.contains('show')) {
        container.classList.add('show');
      }
    }
    
    // сѓ»сѓцсѓ║УАеуц║ТЎѓсЂФсЃЈсѓцсЃЕсѓцсЃѕТЕЪУЃйсѓњжЂЕуће
    const originalShowQuiz = showQuiz;
    showQuiz = function() {
      originalShowQuiz();
      if (aiAssistMode) {
        setTimeout(() => {
          const mainArea = document.getElementById('main-area');
          if (mainArea) {
            highlightKeywords(mainArea);
          }
        }, 100);
      }
    };
    
    showTopMenu();
  </script>
</body>
</html>